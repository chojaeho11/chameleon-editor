<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë§ˆì´ ìŠ¤íŠœë””ì˜¤ | ì¹´ë©œë ˆì˜¨</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="./style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>
    <script>
        // [í•µì‹¬] ì¸ë¼ì¸ ì‚¬ì´íŠ¸ ì½”ë“œ ê²°ì • â€” CDN ìºì‹œ ë¬´ê´€
        (function() {
            var h = window.location.hostname || '';
            var code = 'KR';
            if (h.indexOf('cafe0101') !== -1) code = 'JP';
            else if (h.indexOf('cafe3355') !== -1) code = 'US';
            window.__SITE_CODE = code;
        })();
    </script>
    <style>
        /* ë§ˆì´í˜ì´ì§€ ì „ìš© ë ˆì´ì•„ì›ƒ (style.cssì— ì¶”ê°€í•´ë„ ë¨) */
        body.mypage-body { background: #f8fafc; display: flex; height: 100vh; overflow: hidden; }
        .mp-sidebar { width: 250px; background: white; border-right: 1px solid #e2e8f0; display: flex; flex-direction: column; padding: 20px; }
        .mp-logo { font-size: 20px; font-weight: 800; color: #6366f1; margin-bottom: 40px; cursor: pointer; }
        .mp-nav-item { padding: 12px 15px; margin-bottom: 5px; border-radius: 8px; color: #64748b; font-weight: 600; cursor: pointer; transition: 0.2s; }
        .mp-nav-item:hover, .mp-nav-item.active { background: #eff6ff; color: #6366f1; }
        
        .mp-main { flex: 1; padding: 40px; overflow-y: auto; }
        .mp-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .mp-welcome h1 { font-size: 24px; margin: 0; color: #1e293b; }
        .mp-welcome p { color: #64748b; margin: 5px 0 0; }
        
        /* ëŒ€ì‹œë³´ë“œ ì¹´ë“œ (4ì¹¸ìœ¼ë¡œ ë³€ê²½) */
        .stat-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 40px; }
        .stat-card { background: white; padding: 25px; border-radius: 16px; border: 1px solid #e2e8f0; display: flex; align-items: center; gap: 20px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        .stat-icon { width: 50px; height: 50px; border-radius: 12px; background: #eff6ff; color: #6366f1; display: flex; align-items: center; justify-content: center; font-size: 24px; }
        .stat-info strong { font-size: 28px; color: #1e293b; display: block; }
        .stat-info span { font-size: 14px; color: #64748b; }
        .stat-info span[id$="Display"], .stat-info span[id$="Count"] { font-size: 24px; font-weight: 800; color: #1e293b; display: block; margin-bottom: 4px; }

        /* ì„¹ì…˜ ì»¨í…Œì´ë„ˆ */
        .mp-section { background: white; border-radius: 16px; border: 1px solid #e2e8f0; padding: 25px; margin-bottom: 30px; display: none; }
        .mp-section.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* í…Œì´ë¸” */
        .mp-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .mp-table th { text-align: left; padding: 15px; background: #f8fafc; color: #64748b; font-size: 13px; border-bottom: 1px solid #e2e8f0; }
        .mp-table td { padding: 15px; border-bottom: 1px solid #f1f5f9; color: #334155; font-size: 14px; }
        .status-badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .status-done { background: #dcfce7; color: #15803d; }
        .status-wait { background: #fef9c3; color: #a16207; }
        .status-cancel { background: #fee2e2; color: #b91c1c; }

        .btn-cancel-order { padding: 5px 10px; background: white; border: 1px solid #ef4444; color: #ef4444; border-radius: 6px; cursor: pointer; font-size: 12px; }
        .btn-cancel-order:hover { background: #ef4444; color: white; }
    </style>
</head>
<body class="mypage-body">

    <nav class="mp-sidebar">
        <div class="mp-logo" onclick="location.href='index.html'"><i class="fa-solid fa-palette"></i> Chameleon</div>
        
        <div class="mp-nav-item active" onclick="switchTab('dashboard')">
            <i class="fa-solid fa-chart-pie" style="width:20px;"></i> <span data-i18n="mp_menu_dashboard">Dashboard</span>
        </div>
        <div class="mp-nav-item" onclick="switchTab('designs')">
            <i class="fa-solid fa-layer-group" style="width:20px;"></i> <span data-i18n="mp_menu_designs">My Designs</span>
        </div>
        <div class="mp-nav-item" onclick="switchTab('sales')">
            <i class="fa-solid fa-store" style="width:20px;"></i> <span data-i18n="mp_menu_sales">On Sale</span>
        </div>
        <div class="mp-nav-item" onclick="switchTab('orders')">
            <i class="fa-solid fa-receipt" style="width:20px;"></i> <span data-i18n="mp_menu_orders">Orders</span>
        </div>
        <div class="mp-nav-item" onclick="switchTab('profit')">
            <i class="fa-solid fa-sack-dollar" style="width:20px;"></i> <span data-i18n="mp_menu_profit">Profit & Points</span>
        </div>
        
        <div style="margin-top: auto;">
            <div class="mp-nav-item" style="color:#ef4444;" onclick="logout()">
                <i class="fa-solid fa-right-from-bracket" style="width:20px;"></i> <span data-i18n="btn_logout">Logout</span>
            </div>
        </div>
    </nav>

    <main class="mp-main">
        <div class="mp-header">
            <div class="mp-welcome">
                <h1 id="userNameDisplay" data-i18n="mp_welcome_title">Welcome!</h1>
                <p data-i18n="mp_welcome_desc">Create amazing designs today.</p>
            </div>
            <button onclick="location.href='index.html'" class="btn-round primary" style="width:auto; padding:10px 20px;">
                <i class="fa-solid fa-pen-nib"></i> <span data-i18n="btn_back_to_editor">Back to Editor</span>
            </button>
        </div>

        <div id="tab-dashboard" class="mp-section active">
            <div class="stat-grid">
                <div class="stat-card">
                    <div class="stat-icon"><i class="fa-solid fa-won-sign"></i></div>
                    <div class="stat-info">
                        <span id="mileageDisplay">0 P</span>
                        <span data-i18n="mp_label_mileage">Mileage</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon" style="background:#fff7ed; color:#ea580c;">
                        <i class="fa-solid fa-money-bill-wave"></i>
                    </div>
                    <div class="stat-info">
                        <span id="totalSpendDisplay">0</span>
                        <span data-i18n="mp_label_total_spend">Total Spend</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background:#eff6ff; color:#2563eb;">
                        <i class="fa-solid fa-cloud-arrow-up"></i>
                    </div>
                    <div class="stat-info">
                        <span id="logoCountDisplay">0</span>
                        <span data-i18n="mp_label_logo_count">Shared Logos</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background:#f0fdf4; color:#16a34a;">
                        <i class="fa-solid fa-box-open"></i>
                    </div>
                    <div class="stat-info">
                        <span id="activeOrderCount">0</span>
                        <span data-i18n="mp_label_active_orders">Active Orders</span>
                    </div>
                </div>
            </div>
            
            <h3 data-i18n="mp_recent_logs">ğŸ“¢ ìµœê·¼ ìˆ˜ìµ ì•Œë¦¼</h3>
            <ul id="recentLogs" style="list-style:none; padding:0; margin-top:15px; color:#475569;">
                <li data-i18n="msg_loading">ë¡œë”© ì¤‘...</li>
            </ul>
        </div>

        <div id="tab-designs" class="mp-section">
            <h3 data-i18n="mp_saved_designs">ğŸ“‚ ì €ì¥ëœ ë””ìì¸</h3>
            <div id="designGrid" class="mp-grid"></div>
        </div>
        <div id="tab-sales" class="mp-section">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h3 data-i18n="mp_sales_title">ğŸ¨ íŒë§¤ì¤‘ì¸ ë””ìì¸ (ë‚´ê°€ ë“±ë¡í•œ í…œí”Œë¦¿)</h3>
                <div style="text-align:right;">
                    <span style="font-size:12px; color:#666;" data-i18n="mp_sales_total">ì˜ˆìƒ ìˆ˜ìµ í•©ê³„</span><br>
                    <strong style="color:#6366f1; font-size:18px;" id="totalSalesPoint">0 P</strong>
                </div>
            </div>
            <p style="font-size:13px; color:#64748b; background:#f1f5f9; padding:10px; border-radius:8px;" data-i18n="mp_sales_guide">
                <i class="fa-solid fa-circle-info"></i> í…œí”Œë¦¿ ë“±ë¡ ì‹œ <b>100P</b>, ë¡œê³  ë“±ë¡ ì‹œ <b>150P</b>ê°€ ì¦‰ì‹œ ì ë¦½ë©ë‹ˆë‹¤.<br>
                ë‹¤ë¥¸ ìœ ì €ê°€ ë‚´ ë””ìì¸ì„ êµ¬ë§¤(ì‚¬ìš©)í•˜ë©´ ê±´ë‹¹ <b>200P</b>ê°€ ì¶”ê°€ë¡œ ì ë¦½ë©ë‹ˆë‹¤.
            </p>
            <div id="mySalesGrid" class="mp-grid"></div>
        </div>

        <div id="tab-orders" class="mp-section">
            <h3 data-i18n="mp_order_history">ğŸ“¦ ì£¼ë¬¸ / ë°°ì†¡ ì¡°íšŒ</h3>
            <table class="mp-table">
                <thead>
                    <tr>
                        <th data-i18n="th_date">ì£¼ë¬¸ì¼</th>
                        <th data-i18n="th_product">ìƒí’ˆëª…</th>
                        <th data-i18n="th_amount">ê²°ì œê¸ˆì•¡</th>
                        <th data-i18n="th_status">ìƒíƒœ</th>
                        <th data-i18n="th_action">ê´€ë¦¬</th>
                    </tr>
                </thead>
                <tbody id="orderListBody"></tbody>
            </table>
        </div>

        <div id="tab-profit" class="mp-section">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                
                <div style="background: #1e293b; color: white; padding: 30px; border-radius: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                        <div>
                            <h3 style="margin: 0; font-size: 16px; opacity: 0.9; color: #94a3b8;" data-i18n="mp_deposit_title">ğŸ’° í†µí•© ì˜ˆì¹˜ê¸ˆ (ì¶œê¸ˆ/ì‚¬ìš©ê°€ëŠ¥)</h3>
                            <p style="margin: 5px 0 0 0; font-size: 12px; color: #64748b;" data-i18n="mp_deposit_desc">íŒë§¤ ìˆ˜ìµê¸ˆê³¼ ì¶©ì „í•œ ì˜ˆì¹˜ê¸ˆì´ í•©ì‚°ë©ë‹ˆë‹¤.</p>
                        </div>
                        <span style="background: #fbbf24; color: #1e293b; font-size: 11px; font-weight: 800; padding: 4px 8px; border-radius: 6px;">CASH</span>
                    </div>
                    
                    <div style="font-size: 36px; font-weight: 800; margin: 20px 0; letter-spacing: -1px; color: #fbbf24;">
                        <span id="displayTotalDeposit">0</span> <span id="depositCurrencyUnit" style="font-size: 20px; font-weight: normal; color:white;">ì›</span>
                    </div>

                    <div style="display: flex; gap: 10px;">
                        <button onclick="openWithdrawModal()" style="flex: 1; background: #4f46e5; border: none; color: white; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer;" data-i18n="mp_btn_withdraw">
                            ğŸ’¸ ì¶œê¸ˆ ì‹ ì²­
                        </button>
                        <button onclick="alert(window.t('mp_charge_notice','ê´€ë¦¬ì ê³„ì¢Œë¡œ ì…ê¸ˆ í›„ ê³ ê°ì„¼í„°ì— ë¬¸ì˜í•´ì£¼ì„¸ìš”.'))" style="flex: 1; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer;" data-i18n="mp_btn_charge">
                            ğŸ’³ ì¶©ì „í•˜ê¸°
                        </button>
                    </div>
                </div>

                <div style="background: #fff; border: 1px solid #e2e8f0; padding: 30px; border-radius: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                        <div>
                            <h3 style="margin: 0; font-size: 16px; color: #475569;" data-i18n="mp_mileage_title">â“‚ï¸ ë³´ìœ  ë§ˆì¼ë¦¬ì§€ (í¬ì¸íŠ¸)</h3>
                            <p style="margin: 5px 0 0 0; font-size: 12px; color: #94a3b8;" data-i18n="mp_mileage_desc">ì´ë²¤íŠ¸ ì°¸ì—¬ ë° í™œë™ ë³´ìƒ (ê²°ì œ ì‹œ ì‚¬ìš©ê°€ëŠ¥)</p>
                        </div>
                        <span style="background: #e0e7ff; color: #4338ca; font-size: 11px; font-weight: 800; padding: 4px 8px; border-radius: 6px;">POINT</span>
                    </div>

                    <div style="font-size: 36px; font-weight: 800; margin: 20px 0; color: #1e293b; letter-spacing: -1px;">
                        <span id="displayTotalMileage">0</span> <span style="font-size: 20px; font-weight: normal; color: #64748b;">P</span>
                    </div>

                    <div style="padding: 15px; background: #f8fafc; border-radius: 8px; font-size: 13px; color: #64748b;" data-i18n="mp_mileage_notice">
                        ğŸ’¡ ë§ˆì¼ë¦¬ì§€ëŠ” í˜„ê¸ˆìœ¼ë¡œ ì¶œê¸ˆí•  ìˆ˜ ì—†ìœ¼ë©°,<br>
                        ìƒí’ˆ êµ¬ë§¤ ì‹œ <strong>ìµœëŒ€ 10%</strong>ê¹Œì§€ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.
                    </div>
                </div>
            </div>
            
            <h4 data-i18n="mp_wallet_log_title">ğŸ“Š ì…ì¶œê¸ˆ ë‚´ì—­ (Wallet Log)</h4>
            <table class="mp-table">
                <thead>
                    <tr>
                        <th data-i18n="mp_th_datetime">ì¼ì‹œ</th>
                        <th data-i18n="mp_th_type">êµ¬ë¶„</th>
                        <th data-i18n="mp_th_desc">ë‚´ìš©</th>
                        <th style="text-align:right;" data-i18n="mp_th_amount">ê¸ˆì•¡</th>
                    </tr>
                </thead>
                <tbody id="walletListBody">
                    <tr><td colspan="4" style="text-align:center; padding:30px;" data-i18n="mp_no_records">ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>
                </tbody>
            </table>
        </div>

    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <script type="module" src="./mypage.js?v=123"></script>
    <div id="withdrawModal" class="modal-overlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:9999; justify-content:center; align-items:center;">
    <div class="modal-box" style="background:white; padding:25px; border-radius:12px; width:380px;">
        
        <div style="width:0; height:0; overflow:hidden; opacity:0;">
            <input type="text" name="fake_username_prevention" autocomplete="username">
            <input type="password" name="fake_password_prevention" autocomplete="new-password">
        </div>

        <h3 data-i18n="mp_wd_title">ğŸ’¸ í¬ì¸íŠ¸ ì¶œê¸ˆ ì‹ ì²­</h3>
        <p id="wdNotice" style="font-size:13px; color:#666; margin-bottom:20px;" data-i18n="mp_wd_notice">
            ë³´ìœ í•˜ì‹  ì˜ˆì¹˜ê¸ˆì„ í˜„ê¸ˆìœ¼ë¡œ ì¶œê¸ˆí•©ë‹ˆë‹¤.<br>
            <strong>ìµœì†Œ ì¶œê¸ˆ ê°€ëŠ¥ì•¡ì€ 1,000ì› ì…ë‹ˆë‹¤.</strong>
        </p>

        <div style="margin-bottom:10px;">
            <label style="font-size:12px; font-weight:bold;" data-i18n="mp_wd_amount">ì¶œê¸ˆí•  ê¸ˆì•¡</label>
            <input type="number" id="wdAmount" class="input-text" style="width:100%; padding:8px; border:1px solid #ddd;" data-i18n-placeholder="mp_wd_amount_ph" placeholder="1000 ì´ìƒ ì…ë ¥">
            <div style="font-size:11px; color:#6366f1; margin-top:4px;"><span data-i18n="mp_wd_balance">ë³´ìœ </span>: <span id="wdCurrentMileage">0</span> <span id="wdCurrencyLabel">ì›</span></div>
        </div>

        <div style="margin-bottom:10px;">
            <label style="font-size:12px; font-weight:bold;" data-i18n="mp_wd_bank">ì€í–‰ëª…</label>
            <input type="text" id="wdBank" name="wd_bank_name" class="input-text" autocomplete="off" style="width:100%; padding:8px; border:1px solid #ddd;">
        </div>
        <div style="margin-bottom:10px;">
            <label style="font-size:12px; font-weight:bold;" data-i18n="mp_wd_account">ê³„ì¢Œë²ˆí˜¸</label>
            <input type="text" id="wdAccount" name="wd_account_num" class="input-text" autocomplete="off" style="width:100%; padding:8px; border:1px solid #ddd;" data-i18n-placeholder="mp_wd_account_ph" placeholder="- ì—†ì´ ì…ë ¥">
        </div>
        <div style="margin-bottom:10px;">
            <label style="font-size:12px; font-weight:bold;" data-i18n="mp_wd_holder">ì˜ˆê¸ˆì£¼</label>
            <input type="text" id="wdHolder" name="wd_holder_name" class="input-text" autocomplete="off" style="width:100%; padding:8px; border:1px solid #ddd;">
        </div>

        <div style="margin-bottom:10px;">
            <label style="font-size:12px; font-weight:bold;" data-i18n="mp_wd_phone">ì—°ë½ì²˜</label>
            <input type="tel" id="wdPhone" name="wd_contact_phone" class="input-text" autocomplete="off" style="width:100%; padding:8px; border:1px solid #ddd;" placeholder="010-0000-0000">
        </div>

        <div id="wdRrnRow" style="margin-bottom:20px;">
            <label style="font-size:12px; font-weight:bold;" data-i18n="mp_wd_rrn">ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ (ì„¸ê¸ˆì‹ ê³ ìš©)</label>
            <input type="password" id="wdRRN" name="wd_rrn_code" class="input-text" autocomplete="new-password" style="width:100%; padding:8px; border:1px solid #ddd;" placeholder="123456-1234567" maxlength="14">
        </div>

        <div style="display:flex; gap:10px;">
            <button class="btn-round primary" style="flex:1; justify-content:center;" onclick="requestWithdrawal()" data-i18n="mp_wd_submit">ì‹ ì²­í•˜ê¸°</button>
            <button class="btn-round" style="flex:1; justify-content:center; background:#f1f5f9; color:#666;" onclick="document.getElementById('withdrawModal').style.display='none'" data-i18n="mp_wd_cancel">ì·¨ì†Œ</button>
        </div>
    </div>
</div>
</body>
</html>