<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì£¼ë¬¸ ì™„ë£Œ</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>
    <style>
        body { font-family: 'Pretendard', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; background: #f8fafc; }
        .success-box { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; max-width: 400px; width: 90%; }
        h1 { margin: 0 0 10px 0; color: #111; }
        p { color: #666; margin-bottom: 30px; }
        .btn { display: flex; align-items: center; justify-content: center; width: 100%; padding: 15px; margin-bottom: 10px; border-radius: 12px; border: 1px solid #e2e8f0; background: white; color: #333; font-weight: bold; cursor: pointer; text-decoration: none; box-sizing: border-box; transition: 0.2s; }
        .btn:hover { background: #f1f5f9; border-color: #cbd5e1; }
        .btn-primary { background: #6366f1; color: white; border: none; margin-top: 20px; }
        .btn-primary:hover { background: #4f46e5; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="success-box">
        <div style="font-size: 50px; margin-bottom: 20px;">ğŸ‰</div>
        <h1>ì£¼ë¬¸ ì™„ë£Œ!</h1>
        <p>ì£¼ë¬¸ì´ ì„±ê³µì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.</p>

        <div id="downloadArea">
            <a id="btnOrderSheet" class="btn hidden" target="_blank">ğŸ“„ ì‘ì—…ì§€ì‹œì„œ ë‹¤ìš´ë¡œë“œ</a>
            <a id="btnQuotation" class="btn hidden" target="_blank">ğŸ“‘ ê²¬ì ì„œ ë‹¤ìš´ë¡œë“œ</a>
        </div>

        <button onclick="location.href='/'" class="btn btn-primary">í™•ì¸ (í™ˆìœ¼ë¡œ)</button>
    </div>

    <script type="module">
        // config.jsì—ì„œ Supabase ì„¤ì • ê°€ì ¸ì˜¤ê¸°
        import { sb } from './config.js';

        async function init() {
            // URLì—ì„œ db_id ê°€ì ¸ì˜¤ê¸°
            const params = new URLSearchParams(window.location.search);
            const dbId = params.get('db_id');

            if (!dbId || !sb) return;

            // DBì—ì„œ íŒŒì¼ ì •ë³´ ì¡°íšŒ
            const { data, error } = await sb
                .from('orders')
                .select('files')
                .eq('id', dbId)
                .single();

            if (error || !data || !data.files) {
                console.error("íŒŒì¼ ì¡°íšŒ ì‹¤íŒ¨", error);
                return;
            }

            // íŒŒì¼ ë²„íŠ¼ í™œì„±í™”
            const files = data.files;
            
            // ì‘ì—…ì§€ì‹œì„œ ì°¾ê¸°
            const orderSheet = files.find(f => f.type === 'order_sheet');
            if (orderSheet) {
                const btn = document.getElementById('btnOrderSheet');
                btn.href = orderSheet.url;
                btn.download = orderSheet.name; // ë‹¤ìš´ë¡œë“œ ì†ì„± ì¶”ê°€
                btn.classList.remove('hidden');
            }

            // ê²¬ì ì„œ ì°¾ê¸°
            const quote = files.find(f => f.type === 'quotation');
            if (quote) {
                const btn = document.getElementById('btnQuotation');
                btn.href = quote.url;
                btn.download = quote.name;
                btn.classList.remove('hidden');
            }
        }

        init();
    </script>
</body>
</html>