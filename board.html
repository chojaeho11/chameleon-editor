<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="alternate" hreflang="ko" href="https://www.cafe2626.com/board.html" />
    <link rel="alternate" hreflang="ja" href="https://www.cafe0101.com/board.html" />
    <link rel="alternate" hreflang="en" href="https://www.cafe3355.com/board.html" />
    <link rel="alternate" hreflang="zh" href="https://www.cafe3355.com/board.html?lang=zh" />
    <link rel="alternate" hreflang="ar" href="https://www.cafe3355.com/board.html?lang=ar" />
    <link rel="alternate" hreflang="es" href="https://www.cafe3355.com/board.html?lang=es" />
    <link rel="alternate" hreflang="x-default" href="https://www.cafe2626.com/board.html" />
    
    <title>ì¹´ë©œë ˆì˜¨ ì»¤ë®¤ë‹ˆí‹° - ë¸”ë¡œê·¸ & í›„ê¸°</title>
    <meta name="description" content="ì¹´ë©œë ˆì˜¨í”„ë¦°íŒ… ê¸€ë¡œë²Œ ì»¤ë®¤ë‹ˆí‹°ì…ë‹ˆë‹¤. í•œêµ­/ì¼ë³¸/ë¯¸êµ­ ê³ ê°ì˜ ì œì‘ í›„ê¸°, ì¤‘ê³  ì¥ë¹„ ê±°ë˜, ë””ìì¸ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.">
    <meta name="keywords" content="ì¹´ë©œë ˆì˜¨í”„ë¦°íŒ…, í—ˆë‹ˆì½¤ë³´ë“œ, íŒì—…ìŠ¤í† ì–´, ì¸ì‡„í›„ê¸°, ì¤‘ê³ ì¸ì‡„ì¥ë¹„, ã‚«ãƒ¡ãƒ¬ã‚ªãƒ³å°åˆ·, ãƒãƒ‹ã‚«ãƒ ãƒœãƒ¼ãƒ‰, éŸ“å›½å°åˆ·">
    <meta name="robots" content="index, follow">

    <meta property="og:type" content="website">
    <meta property="og:site_name" content="ì¹´ë©œë ˆì˜¨í”„ë¦°íŒ… (Chameleon Printing)">
    <meta property="og:title" content="ì¹´ë©œë ˆì˜¨ ì»¤ë®¤ë‹ˆí‹°">
    <meta property="og:description" content="ì¸ì‡„/ë””ìì¸ ì •ë³´ ê³µìœ  ë° ê³ ê° í›„ê¸° ê²Œì‹œíŒ">
    <meta property="og:image" content="https://gdadmin.signmini.com/data/editor/policy/260105/6c9bc3b9b9a5903a01b44a7b36fc2cbe_191502.png">
    <meta property="og:url" content="https://www.cafe2626.com/board">
    <link rel="canonical" href="https://www.cafe2626.com/board">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="ì¹´ë©œë ˆì˜¨ ì»¤ë®¤ë‹ˆí‹°">
    <meta name="twitter:description" content="ì¸ì‡„/ë””ìì¸ ì •ë³´ ê³µìœ  ë° ê³ ê° í›„ê¸° ê²Œì‹œíŒ">
    <meta name="twitter:image" content="https://gdadmin.signmini.com/data/editor/policy/260105/6c9bc3b9b9a5903a01b44a7b36fc2cbe_191502.png">

    <script>
    // [SEO ë™ì  ì„¤ì •] board.htmlìš©
    (function(){
        var h = location.hostname;
        var lp = new URLSearchParams(location.search).get('lang');
        var cc = lp === 'zh' || lp === 'cn' ? 'CN' : lp === 'ar' ? 'AR' : lp === 'es' ? 'ES' : h.includes('cafe0101') ? 'JP' : h.includes('cafe3355') ? 'US' : 'KR';
        var domains = { KR:'https://www.cafe2626.com', JP:'https://www.cafe0101.com', US:'https://www.cafe3355.com', CN:'https://www.cafe3355.com', AR:'https://www.cafe3355.com', ES:'https://www.cafe3355.com' };
        var seoData = {
            KR: { title:'ì¹´ë©œë ˆì˜¨ ì»¤ë®¤ë‹ˆí‹° - ë¸”ë¡œê·¸ & í›„ê¸°', desc:'ì¹´ë©œë ˆì˜¨í”„ë¦°íŒ… ê¸€ë¡œë²Œ ì»¤ë®¤ë‹ˆí‹°ì…ë‹ˆë‹¤. ì œì‘ í›„ê¸°, ë””ìì¸ ì •ë³´, ì¸ì‡„ íŒì„ í™•ì¸í•˜ì„¸ìš”.', keywords:'ì¹´ë©œë ˆì˜¨í”„ë¦°íŒ…,ì¸ì‡„í›„ê¸°,ë””ìì¸ì •ë³´,íŒì—…ìŠ¤í† ì–´,í—ˆë‹ˆì½¤ë³´ë“œ,ì»¤ë®¤ë‹ˆí‹°', lang:'ko', siteName:'ì¹´ë©œë ˆì˜¨í”„ë¦°íŒ…' },
            JP: { title:'ã‚«ãƒ¡ãƒ¬ã‚ªãƒ³ ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ - ãƒ–ãƒ­ã‚° & ãƒ¬ãƒ“ãƒ¥ãƒ¼', desc:'ã‚«ãƒ¡ãƒ¬ã‚ªãƒ³ãƒ—ãƒªãƒ³ãƒ†ã‚£ãƒ³ã‚°ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã€‚åˆ¶ä½œãƒ¬ãƒ“ãƒ¥ãƒ¼ã€ãƒ‡ã‚¶ã‚¤ãƒ³æƒ…å ±ã€å°åˆ·ã®ãƒ’ãƒ³ãƒˆã‚’ã”è¦§ãã ã•ã„ã€‚', keywords:'ã‚«ãƒ¡ãƒ¬ã‚ªãƒ³ãƒ—ãƒªãƒ³ãƒ†ã‚£ãƒ³ã‚°,å°åˆ·ãƒ¬ãƒ“ãƒ¥ãƒ¼,ãƒ‡ã‚¶ã‚¤ãƒ³æƒ…å ±,ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚¹ãƒˆã‚¢,ãƒãƒ‹ã‚«ãƒ ãƒœãƒ¼ãƒ‰,ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£', lang:'ja', siteName:'ã‚«ãƒ¡ãƒ¬ã‚ªãƒ³ãƒ—ãƒªãƒ³ãƒ†ã‚£ãƒ³ã‚°' },
            US: { title:'Chameleon Community - Blog & Reviews', desc:'Chameleon Printing global community. Check out production reviews, design tips, and printing information.', keywords:'chameleon printing,printing reviews,design tips,pop-up store,honeycomb board,community', lang:'en', siteName:'Chameleon Printing' },
            CN: { title:'å˜è‰²é¾™ç¤¾åŒº - åšå®¢ & è¯„ä»·', desc:'å˜è‰²é¾™å°åˆ·å…¨çƒç¤¾åŒºã€‚æŸ¥çœ‹åˆ¶ä½œè¯„ä»·ã€è®¾è®¡ä¿¡æ¯å’Œå°åˆ·æŠ€å·§ã€‚', keywords:'å˜è‰²é¾™å°åˆ·,å°åˆ·è¯„ä»·,è®¾è®¡ä¿¡æ¯,å¿«é—ªåº—,èœ‚çªæ¿,ç¤¾åŒº', lang:'zh', siteName:'å˜è‰²é¾™å°åˆ·' },
            AR: { title:'Ù…Ø¬ØªÙ…Ø¹ ÙƒØ§Ù…ÙŠÙ„ÙŠÙˆÙ† - Ù…Ø¯ÙˆÙ†Ø© ÙˆÙ…Ø±Ø§Ø¬Ø¹Ø§Øª', desc:'Ù…Ø¬ØªÙ…Ø¹ ÙƒØ§Ù…ÙŠÙ„ÙŠÙˆÙ† Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ. Ø§Ø·Ù„Ø¹ Ø¹Ù„Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬ ÙˆÙ†ØµØ§Ø¦Ø­ Ø§Ù„ØªØµÙ…ÙŠÙ… ÙˆÙ…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©.', keywords:'Ø·Ø¨Ø§Ø¹Ø© ÙƒØ§Ù…ÙŠÙ„ÙŠÙˆÙ†,Ù…Ø±Ø§Ø¬Ø¹Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©,Ù†ØµØ§Ø¦Ø­ Ø§Ù„ØªØµÙ…ÙŠÙ…,Ù…ØªØ¬Ø± Ù…Ù†Ø¨Ø«Ù‚,Ù„ÙˆØ­ Ø§Ù„Ø¹Ø³Ù„,Ù…Ø¬ØªÙ…Ø¹', lang:'ar', siteName:'Ø·Ø¨Ø§Ø¹Ø© ÙƒØ§Ù…ÙŠÙ„ÙŠÙˆÙ†' },
            ES: { title:'Comunidad Chameleon - Blog y ReseÃ±as', desc:'Comunidad global de Chameleon Printing. Consulta reseÃ±as de producciÃ³n, consejos de diseÃ±o e informaciÃ³n sobre impresiÃ³n.', keywords:'chameleon printing,reseÃ±as de impresiÃ³n,consejos de diseÃ±o,tienda pop-up,panel honeycomb,comunidad', lang:'es', siteName:'Chameleon Printing' }
        };
        var s = seoData[cc]; if(!s) return;
        var d = domains[cc];
        document.documentElement.lang = s.lang;
        document.title = s.title;
        var mDesc = document.querySelector('meta[name="description"]'); if(mDesc) mDesc.content = s.desc;
        var mKey = document.querySelector('meta[name="keywords"]'); if(mKey) mKey.content = s.keywords;
        var langSuffix = { CN:'?lang=zh', AR:'?lang=ar', ES:'?lang=es' };
        var boardPath = '/board' + (langSuffix[cc] || '');
        var canon = document.querySelector('link[rel="canonical"]'); if(canon) canon.href = d + boardPath;
        var ogTitle = document.querySelector('meta[property="og:title"]'); if(ogTitle) ogTitle.content = s.title;
        var ogDesc = document.querySelector('meta[property="og:description"]'); if(ogDesc) ogDesc.content = s.desc;
        var ogUrl = document.querySelector('meta[property="og:url"]'); if(ogUrl) ogUrl.content = d + boardPath;
        var ogSite = document.querySelector('meta[property="og:site_name"]'); if(ogSite) ogSite.content = s.siteName;
        var twTitle = document.querySelector('meta[name="twitter:title"]'); if(twTitle) twTitle.content = s.title;
        var twDesc = document.querySelector('meta[name="twitter:description"]'); if(twDesc) twDesc.content = s.desc;

        var jsonld = document.createElement('script');
        jsonld.type = 'application/ld+json';
        jsonld.textContent = JSON.stringify({
            "@context":"https://schema.org",
            "@type":"WebPage",
            "name": s.title,
            "description": s.desc,
            "url": d + boardPath,
            "inLanguage": s.lang,
            "isPartOf": { "@type":"WebSite", "name": s.siteName, "url": d }
        });
        document.head.appendChild(jsonld);
    })();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    
    <link rel="stylesheet" href="./style.css">
    <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
    <style>
        /* =========================================
           ê¸°ë³¸ ë ˆì´ì•„ì›ƒ ë° ìŠ¤íƒ€ì¼
           ========================================= */
        body { 
            background: #f1f5f9; 
            padding-top: 80px; 
            font-family: 'Pretendard', sans-serif;
            overflow-y: auto !important;
            height: auto !important;
            color: #333;
        }

        /* ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë°” */
        .topbar {
            position: fixed; 
            top: 0; left: 0; right: 0; 
            z-index: 999;
            height: 60px;
            background: white;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            padding: 0 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.03);
        }
        .brand { 
            font-weight: 900; 
            font-size: 20px; 
            cursor: pointer;
            color: #111;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .board-container { 
            max-width: 1100px; 
            margin: 0 auto; 
            padding: 30px 20px; 
            padding-bottom: 100px;
        }
        
        /* ê²Œì‹œíŒ í—¤ë” (ì œëª©, í•„í„°, ê¸€ì“°ê¸° ë²„íŠ¼) */
        .board-header-wrap {
            background: white; 
            border-radius: 20px; 
            padding: 25px 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.03); 
            margin-bottom: 30px;
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .country-badge { 
            background: #eff6ff; 
            color: #6366f1; 
            padding: 5px 12px; 
            border-radius: 30px; 
            font-size: 13px; 
            font-weight: 700; 
            margin-bottom: 5px; 
            display: inline-block;
        }

        /* =========================================
           ê²Œì‹œê¸€ ëª©ë¡ (Grid System)
           ========================================= */
        .post-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); 
            gap: 25px; 
        }

        .post-card {
            background: white; 
            border-radius: 16px; 
            overflow: hidden; 
            border: 1px solid #e2e8f0;
            cursor: pointer; 
            transition: all 0.3s ease; 
            display: flex; 
            flex-direction: column;
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
            height: 100%;
        }

        .post-card:hover { 
            transform: translateY(-7px); 
            box-shadow: 0 15px 30px rgba(0,0,0,0.1); 
            border-color: #6366f1; 
        }
        
        /* ì¸ë„¤ì¼ ì˜ì—­ */
        .card-thumb { 
            width: 100%; 
            height: 180px; 
            background-color: #f8fafc; 
            overflow: hidden; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            border-bottom: 1px solid #f1f5f9;
        }
        
        .card-thumb img { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
            transition: transform 0.3s; 
        }
        
        .post-card:hover .card-thumb img { 
            transform: scale(1.05); 
        }
        
        .card-body { 
            padding: 20px; 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
        }
        
        .card-title { 
            font-size: 16px; 
            font-weight: 700; 
            color: #333; 
            margin: 0 0 10px 0; 
            line-height: 1.4; 
            flex: 1;
            /* ê¸´ ì œëª© ë§ì¤„ì„ ì²˜ë¦¬ */
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .card-meta { 
            font-size: 12px; 
            color: #94a3b8; 
            display: flex; 
            justify-content: space-between; 
            margin-top: auto; 
            padding-top: 15px;
            border-top: 1px solid #f8fafc;
        }

        /* =========================================
           ê²Œì‹œê¸€ ìƒì„¸ ë³´ê¸° (View)
           ========================================= */
        .view-wrap { 
            background: white; 
            padding: 40px; 
            border-radius: 20px; 
            box-shadow: 0 5px 20px rgba(0,0,0,0.05); 
            display: none; /* JSë¡œ ì œì–´ */
            position: relative; 
        }
        
        .view-title-row { 
            display: flex; 
            flex-direction: column; 
            gap: 10px; 
            margin-bottom: 20px; 
        }
        
        .view-title { 
            font-size: 32px; 
            font-weight: 900; 
            color: #111; 
            line-height: 1.3; 
            margin: 0; 
        }
        
        .view-meta-row { 
            display: flex; 
            gap: 20px; 
            border-bottom: 1px solid #eee; 
            padding-bottom: 20px; 
            margin-bottom: 40px; 
            color: #666; 
            font-size: 14px; 
        }

        /* ìƒì„¸ ë³¸ë¬¸ ì´ë¯¸ì§€ ê°•ì œ ë¦¬ì‚¬ì´ì§• (ë ˆì´ì•„ì›ƒ ê¹¨ì§ ë°©ì§€) */
        .view-content img { 
            max-width: 100% !important; 
            height: auto !important; 
            border-radius: 8px; 
            margin: 15px 0; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.1); 
        }
        
        .view-content { 
            font-size: 16px; 
            line-height: 1.8; 
            color: #333; 
            min-height: 200px; 
            margin-bottom: 50px; 
        }

        /* =========================================
           ë³„ì  (Star Rating) ìŠ¤íƒ€ì¼
           ========================================= */
        .star-display-lg { 
            color: #f59e0b; 
            font-size: 20px; 
            margin-bottom: 5px; 
        }
        
        .star-rating { 
            display: flex; 
            gap: 2px; 
            cursor: pointer; 
            margin-left: 10px; 
        }
        
        .star-rating i { 
            color: #cbd5e1; 
            font-size: 24px; 
            transition: color 0.2s; 
        }
        
        .star-rating i.active { 
            color: #f59e0b; 
        }

        /* =========================================
           ëŒ“ê¸€ ì˜ì—­
           ========================================= */
        .comment-section { 
            background: #f8fafc; 
            padding: 20px; 
            border-radius: 12px; 
            margin-top: 30px; 
        }
        
        .comment-header { 
            font-size: 18px; 
            font-weight: 800; 
            margin-bottom: 15px; 
            color: #333; 
        }
        
        .comment-list { 
            display: flex; 
            flex-direction: column; 
            gap: 15px; 
            margin-bottom: 20px; 
            max-height: 500px; 
            overflow-y: auto; 
        }
        
        .comment-item { 
            background: white; 
            padding: 15px; 
            border-radius: 10px; 
            border: 1px solid #e2e8f0; 
        }
        
        .comment-top { 
            display: flex; 
            justify-content: space-between; 
            margin-bottom: 5px; 
            font-size: 13px; 
        }
        
        .comment-author { 
            font-weight: 700; 
            color: #333; 
        }
        
        .comment-date { 
            color: #999; 
        }
        
        .comment-text { 
            font-size: 14px; 
            color: #555; 
            line-height: 1.5; 
        }

        /* ëŒ“ê¸€ ì‘ì„± í¼ */
        .comment-form { 
            display: flex; 
            gap: 10px; 
            background: white; 
            padding: 15px; 
            border-radius: 10px; 
            border: 1px solid #e2e8f0; 
        }

        /* =========================================
           ê¸€ì“°ê¸° ì—ë””í„° (Write)
           ========================================= */
        .write-wrap { 
            display: none; /* JSë¡œ ì œì–´ */
            background: white; 
            padding: 30px; 
            border-radius: 20px; 
            flex-direction: column; 
            gap: 20px; 
        }
        
        #editor-container { 
            height: 500px; 
            font-size: 16px; 
        } 

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        .btn:hover { background: #f8fafc; }
        
        .btn.primary {
            background: #2563eb;
            color: white;
            border: none;
        }
        .btn.primary:hover { background: #1d4ed8; }

        .btn-edit { 
            background: #dbeafe; 
            color: #2563eb; 
            border: none; 
            padding: 8px 15px; 
            border-radius: 8px; 
            font-weight: bold; 
            cursor: pointer; 
            margin-right: 5px; 
        }
        .btn-edit:hover { background: #bfdbfe; }
        
        .btn-delete { 
            background: #fee2e2; 
            color: #ef4444; 
            border: none; 
            padding: 8px 15px; 
            border-radius: 8px; 
            font-weight: bold; 
            cursor: pointer; 
        }
        .btn-delete:hover { background: #fecaca; }

        /* ì…ë ¥ì°½ ìŠ¤íƒ€ì¼ */
        .ai-input-pretty {
            width: 100%;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s;
        }
        .ai-input-pretty:focus {
            outline: none;
            border-color: #6366f1;
        }

        /* Quill íˆ´ë°” ì»¤ìŠ¤í…€ */
        .ql-toolbar.ql-snow { 
            border-top-left-radius: 10px; 
            border-top-right-radius: 10px; 
            border-color: #e2e8f0; 
            background: #f8fafc; 
        }
        .ql-container.ql-snow { 
            border-bottom-left-radius: 10px; 
            border-bottom-right-radius: 10px; 
            border-color: #e2e8f0; 
            font-family: 'Pretendard'; 
        }
    </style>
</head>
<body>

    <div class="topbar">
        <div class="brand" onclick="location.href='/'">
            <i class="fa-solid fa-palette"></i> Chameleon
        </div>
        <div style="flex:1;"></div>
    </div>

    <div class="board-container">
        
        <div class="board-header-wrap">
            <div class="board-title">
                <span class="country-badge" id="countryBadge">KR</span>
                <h1 id="pageTitle" style="margin:0; font-size:24px; font-weight:800;">Board</h1>
            </div>
            <div>
                <select id="countrySelect" class="ai-input-pretty" style="width:auto; display:inline-block; margin:0;">
                    <option value="KR">ğŸ‡°ğŸ‡· í•œêµ­</option>
                    <option value="US">ğŸ‡ºğŸ‡¸ ë¯¸êµ­</option>
                    <option value="JP">ğŸ‡¯ğŸ‡µ ì¼ë³¸</option>
                </select>
                <button id="btnWrite" class="btn primary" style="display:inline-block; margin-left:10px;" data-i18n="btn_write_post">âœï¸ ê¸€ì“°ê¸°</button>
            </div>
        </div>

        <div id="boardList" class="post-grid">Loading...</div>

        <div id="boardView" class="view-wrap">
            <div class="btn-close-yellow" onclick="goToList()" title="ë‹«ê¸°">
                <i class="fa-solid fa-xmark"></i>
            </div>
            
            <button onclick="goToList()" style="position:absolute; top:20px; right:20px; border:none; background:none; font-size:24px; cursor:pointer; color:#999;">&times;</button>
            
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; gap:10px;">
                <div style="display:flex; gap:10px;">
                    <button onclick="goToList()" class="btn">â† ëª©ë¡</button>
                    <button onclick="copyPostToLang('JP')" class="btn" style="background:#fff0f0; border-color:#ffccd5;">ğŸ‡¯ğŸ‡µ ì¼ë³¸ì–´ë¡œ ë³µì œ</button>
                    <button onclick="copyPostToLang('US')" class="btn" style="background:#f0f7ff; border-color:#cce3ff;">ğŸ‡ºğŸ‡¸ ì˜ì–´ë¡œ ë³µì œ</button>
                </div>
                <div id="btnGroupAuth" style="display:none;">
                    <button id="btnEditPost" class="btn-edit" onclick="editCurrentPost()"><i class="fa-solid fa-pen"></i> ìˆ˜ì •</button>
                    <button id="btnDeletePost" class="btn-delete" onclick="deleteCurrentPost()"><i class="fa-solid fa-trash"></i> ì‚­ì œ</button>
                </div>
            </div>
            
            <div class="view-title-row">
                <div id="viewRatingArea" class="star-display-lg" style="display:none;"></div>
                <h1 id="viewTitle" class="view-title"></h1>
            </div>

            <div class="view-meta-row">
                <span id="viewAuthor"><i class="fa-regular fa-user"></i> ì‘ì„±ì</span>
                <span id="viewDate"><i class="fa-regular fa-clock"></i> ë‚ ì§œ</span>
                <span id="viewCount"><i class="fa-regular fa-eye"></i> ì¡°íšŒìˆ˜</span>
            </div>
            
            <article id="viewContent" class="view-content"></article>
            
            <div class="comment-section">
                <div class="comment-header">ğŸ’¬ ëŒ“ê¸€</div>
                <div id="commentList" class="comment-list"></div>
                <div class="comment-form">
                    <textarea id="commentInput" class="ai-input-pretty" style="height:60px; margin:0; flex:1;" placeholder="ëŒ“ê¸€ì„ ë‚¨ê²¨ì£¼ì„¸ìš”..."></textarea>
                    <button id="btnSubmitComment" class="btn primary" style="height:60px;">ë“±ë¡</button>
                </div>
            </div>
        </div>

        <div id="boardWrite" class="write-wrap">
            <h2 style="margin:0;">âœ¨ ë©‹ì§„ ê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”</h2>
            
            <div style="display:flex; align-items:center; gap:10px;">
                <input id="inputTitle" class="ai-input-pretty" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" style="flex:1; margin:0;">
                
                <div id="ratingInputArea" style="display:none; align-items:center; background:#f8fafc; padding:8px 15px; border-radius:8px; border:1px solid #e2e8f0;">
                    <span style="font-size:13px; font-weight:bold; color:#666;">ë§Œì¡±ë„</span>
                    <div class="star-rating" id="starInput">
                        <i class="fa-solid fa-star active" data-score="1"></i>
                        <i class="fa-solid fa-star active" data-score="2"></i>
                        <i class="fa-solid fa-star active" data-score="3"></i>
                        <i class="fa-solid fa-star active" data-score="4"></i>
                        <i class="fa-solid fa-star active" data-score="5"></i>
                    </div>
                </div>
            </div>

            <div style="background:white;">
                <div id="editor-container"></div>
            </div>
            <div style="display:flex; justify-content:flex-end; gap:10px;">
                <button onclick="goToList()" class="btn">ì·¨ì†Œ</button>
                <button id="btnSubmitPost" class="btn primary">ë“±ë¡í•˜ê¸°</button>
            </div>
        </div>

    </div>

    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

    <script type="module">
    import { sb, initConfig, currentUser, isAdmin } from './config.js';

    const urlParams = new URLSearchParams(window.location.search);
    const category = urlParams.get('cat') || 'free';
    const currentCountry = (urlParams.get('country') || 'KR').toUpperCase();
    const postId = urlParams.get('id');
    
    const subCode = urlParams.get('sub_code'); 
    const subName = urlParams.get('sub_name'); 

    let quill; 
    let currentRating = 5; 
    let isEditMode = false;
    let currentPage = 0;
    const ITEMS_PER_PAGE = 12;
    let isLastPage = false;

    // [SEO]
    function updateBoardSEO(postTitle = null, postContent = null, postImage = null) {
        const catMap = {
            'KR': { 'blog': 'ë¸”ë¡œê·¸', 'review': 'ì œì‘í›„ê¸°', 'promo': 'í™ë³´', 'trade': 'ì¥ë¹„ê±°ë˜', 'job': 'êµ¬ì¸êµ¬ì§', 'free': 'ìë£Œì‹¤' },
            'JP': { 'blog': 'ãƒ–ãƒ­ã‚°', 'review': 'ãƒ¬ãƒ“ãƒ¥ãƒ¼', 'promo': 'PR', 'trade': 'ä¸­å¤æ©Ÿå™¨', 'job': 'æ±‚äºº', 'free': 'è³‡æ–™å®¤' },
            'US': { 'blog': 'Blog', 'review': 'Reviews', 'promo': 'Promo', 'trade': 'Market', 'job': 'Jobs', 'free': 'Files' }
        };
        const activeCatName = (catMap[currentCountry] || catMap['KR'])[category] || 'Board';
        const metaData = {
            'KR': { title: `ì¹´ë©œë ˆì˜¨ ${activeCatName}`, desc: "ì¹´ë©œë ˆì˜¨í”„ë¦°íŒ… ì»¤ë®¤ë‹ˆí‹°.", locale: "ko_KR" },
            'JP': { title: `ã‚«ãƒ¡ãƒ¬ã‚ªãƒ³ãƒ»${activeCatName}`, desc: "ã‚«ãƒ¡ãƒ¬ã‚ªãƒ³ãƒ—ãƒªãƒ³ãƒ†ã‚£ãƒ³ã‚°å…¬å¼ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã€‚", locale: "ja_JP" },
            'US': { title: `Chameleon ${activeCatName}`, desc: "Chameleon Printing Community.", locale: "en_US" }
        };
        const defaultData = metaData[currentCountry] || metaData['KR'];

        let finalTitle = defaultData.title;
        let finalDesc = defaultData.desc;
        let finalImage = "https://gdadmin.signmini.com/data/editor/policy/260105/6c9bc3b9b9a5903a01b44a7b36fc2cbe_191502.png"; 

        if (postTitle) {
            finalTitle = `${postTitle} | Chameleon`;
            if (postContent) finalDesc = postContent.replace(/<[^>]*>?/gm, '').substring(0, 120) + '...';
            if (postImage) finalImage = postImage;
        }

        document.title = finalTitle;
        document.documentElement.setAttribute('lang', currentCountry.toLowerCase());

        const setMeta = (selector, content) => {
            let element = document.querySelector(selector);
            if (!element) {
                element = document.createElement('meta');
                if (selector.startsWith('meta[property')) element.setAttribute('property', selector.replace('meta[property="', '').replace('"]', ''));
                else element.setAttribute('name', selector.replace('meta[name="', '').replace('"]', ''));
                document.head.appendChild(element);
            }
            element.setAttribute('content', content);
        };

        setMeta('meta[name="description"]', finalDesc);
        setMeta('meta[property="og:title"]', finalTitle);
        setMeta('meta[property="og:description"]', finalDesc);
        setMeta('meta[property="og:image"]', finalImage);
        setMeta('meta[property="og:url"]', window.location.href);
        setMeta('meta[property="og:locale"]', defaultData.locale);
    }

    window.goToList = function() {
        showSection('list');
        loadPostList();
    };

    async function init() {
        await initConfig();
        updateBoardSEO();

        const countrySelect = document.getElementById('countrySelect');
        countrySelect.value = currentCountry;
        countrySelect.onchange = (e) => location.href = `/board.html?cat=${category}&country=${e.target.value}`;
        document.getElementById('countryBadge').innerText = currentCountry;
        
        const titleMap = {
            'blog': { KR: 'ì¹´ë©œë ˆì˜¨ ë¸”ë¡œê·¸', US: 'Chameleon Blog', JP: 'ã‚«ãƒ¡ãƒ¬ã‚ªãƒ³ãƒ–ãƒ­ã‚°' },
            'review': { KR: 'ê³ ê° ì œì‘í›„ê¸°', US: 'Customer Reviews', JP: 'ãŠå®¢æ§˜ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼' },
            'promo': { KR: 'ì§€ì—­ê´‘ê³ ì‚¬ í™ë³´', US: 'Local Partners', JP: 'åœ°åŸŸåºƒå‘Šä¼šç¤¾' },
            'trade': { KR: 'ì¤‘ê³ ì¥ë¹„ ê±°ë˜', US: 'Used Equipment', JP: 'ä¸­å¤æ©Ÿå™¨å–å¼•' },
            'job': { KR: 'êµ¬ì¸êµ¬ì§', US: 'Job Market', JP: 'æ±‚äººãƒ»æ±‚è·' },
            'free': { KR: 'ì œí’ˆì„¤ëª…ì„œ', US: 'Product Description', JP: 'è£½å“èª¬æ˜æ›¸' }
        }[category] || { KR: 'ê²Œì‹œíŒ', US: 'Board', JP: 'æ²ç¤ºæ¿' };
        
        if (subName && category === 'review') {
            document.getElementById('pageTitle').innerText = `${subName} í›„ê¸°`;
            const badge = document.getElementById('countryBadge');
            badge.style.background = '#6366f1';
            badge.style.color = '#fff';
            badge.innerText = "PRODUCT";
        } else {
            document.getElementById('pageTitle').innerText = titleMap[currentCountry] || titleMap['KR'];
        }
        
        document.getElementById('btnWrite').style.display = 'inline-block';

        // [ìˆ˜ì •] 1. ì˜ìƒ ì—…ë¡œë“œ í•¸ë“¤ëŸ¬
        async function videoHandler() {
            const input = document.createElement('input');
            input.setAttribute('type', 'file');
            input.setAttribute('accept', 'video/mp4,video/webm');
            input.click();

            input.onchange = async () => {
                const file = input.files[0];
                if (!file) return;
                if (file.size > 50 * 1024 * 1024) return alert("50MB ì´í•˜ ì˜ìƒë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.");

                const fileExt = file.name.split('.').pop().toLowerCase();
                const filePath = `vid_${Date.now()}_${Math.random().toString(36).substring(2, 7)}.${fileExt}`;

                try {
                    // 'community' ë²„í‚·ì— ì˜ìƒ ì €ì¥ (ì—†ìœ¼ë©´ ë§Œë“¤ì–´ì•¼ í•¨)
                    const { error } = await sb.storage.from('community').upload(filePath, file);
                    if(error) throw error;
                    
                    const { data } = sb.storage.from('community').getPublicUrl(filePath);
                    const range = quill.getSelection();
                    quill.insertEmbed(range.index, 'video', data.publicUrl);
                } catch (err) {
                    console.error(err);
                    alert('ì˜ìƒ ì—…ë¡œë“œ ì‹¤íŒ¨. Supabaseì— "community" ë²„í‚·ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.');
                }
            };
        }

        // [ì‹ ê·œ] 2. ì´ë¯¸ì§€ ì—…ë¡œë“œ í•¸ë“¤ëŸ¬ (ì„œë²„ ì €ì¥ ê°•ì œ)
        async function imageHandler() {
            const input = document.createElement('input');
            input.setAttribute('type', 'file');
            input.setAttribute('accept', 'image/*');
            input.click();

            input.onchange = async () => {
                const file = input.files[0];
                if (!file) return;

                // í•œê¸€/íŠ¹ìˆ˜ë¬¸ì íŒŒì¼ëª… ì˜¤ë¥˜ ë°©ì§€
                const fileExt = file.name.split('.').pop().toLowerCase();
                const filePath = `img_${Date.now()}_${Math.random().toString(36).substring(2, 7)}.${fileExt}`;

                try {
                    // 'community' ë²„í‚·ì— ì´ë¯¸ì§€ ì €ì¥
                    const { error } = await sb.storage.from('community').upload(filePath, file);
                    if (error) throw error;

                    const { data } = sb.storage.from('community').getPublicUrl(filePath);
                    
                    // ì—ë””í„°ì— Base64 ëŒ€ì‹  ì§§ì€ URL ì‚½ì…
                    const range = quill.getSelection();
                    quill.insertEmbed(range.index, 'image', data.publicUrl);
                    
                } catch (err) {
                    console.error(err);
                    alert('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨. Supabase Storageì— "community" ë²„í‚·ì„ ë§Œë“¤ê³  ì •ì±…(Policy)ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.');
                }
            };
        }

        // [ìˆ˜ì •] 3. ì—ë””í„° ìƒì„± (ì´ë¯¸ì§€ í•¸ë“¤ëŸ¬ ì—°ê²°)
        quill = new Quill('#editor-container', {
            modules: {
                toolbar: {
                    container: [
                        [{ 'header': [1, 2, 3, false] }],
                        ['bold', 'italic', 'underline', 'strike'],
                        [{ 'color': [] }, { 'background': [] }],
                        [{ 'align': [] }],
                        ['image', 'video', 'link'], 
                        ['blockquote', 'code-block'],
                        [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                        ['clean']
                    ],
                    handlers: {
                        'video': videoHandler,
                        'image': imageHandler // â˜… í•µì‹¬: ì´ë¯¸ì§€ ë²„íŠ¼ì„ ê°€ë¡œì±„ì„œ ì„œë²„ë¡œ ë³´ëƒ„
                    }
                }
            },
            placeholder: 'ë‚´ìš©ì„ ì‘ì„±í•´ì£¼ì„¸ìš”...',
            theme: 'snow'
        });

        // [ì‹ ê·œ] 4. ë¶™ì—¬ë„£ê¸° ë°©ì§€ (Base64 ì°¨ë‹¨)
        quill.clipboard.addMatcher('img', (node, delta) => {
            let ops = delta.ops.map(op => {
                if (op.insert && op.insert.image && op.insert.image.startsWith('data:')) {
                    alert("ì´ë¯¸ì§€ëŠ” ë¶™ì—¬ë„£ê¸° ëŒ€ì‹  ìƒë‹¨ íˆ´ë°”ì˜ 'ì´ë¯¸ì§€ ì•„ì´ì½˜'ì„ ëˆŒëŸ¬ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.");
                    return { insert: '' }; // ì´ë¯¸ì§€ ì‚½ì… ë¬´íš¨í™”
                }
                return op;
            });
            return { ops: ops };
        });

        setupStarRating();

        if (postId) loadPostDetail(postId);
        else {
            createLoadMoreButton();
            loadPostList(); 
        }

        setupEventListeners();
    }

    function getResizedImage(url) {
        if (!url) return null;
        if (url.startsWith('data:image')) return url;
        if (url.includes('supabase.co')) {
            const baseUrl = url.split('?')[0];
            return `${baseUrl}?width=300&height=300&resize=cover&quality=50&format=webp`;
        }
        return `https://wsrv.nl/?url=${encodeURIComponent(url)}&w=300&q=50&output=webp`;
    }

    async function loadPostList(isAppend = false) {
        showSection('list');
        const listEl = document.getElementById('boardList');
        const loadMoreArea = document.getElementById('loadMoreArea');
        
        if (!isAppend) {
            listEl.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:50px;"><i class="fa-solid fa-spinner fa-spin fa-2x" style="color:#6366f1;"></i><br><br>ë¡œë”© ì¤‘...</div>';
            currentPage = 0;
            isLastPage = false;
        }

        try {
            const from = currentPage * ITEMS_PER_PAGE;
            const to = from + ITEMS_PER_PAGE - 1;

            let query = sb.from('community_posts')
                .select('id, title, author_name, created_at, view_count, thumbnail, rating') 
                .eq('category', category)
                .eq('country_code', currentCountry);

            if (subCode) {
                query = query.eq('target_code', subCode);
            }

            const { data, error } = await query
                .order('created_at', { ascending: false })
                .range(from, to);
            
            if (error) throw error;

            if (!isAppend) listEl.innerHTML = ''; 

            if (!data || data.length === 0) {
                if (!isAppend) listEl.innerHTML = `<div style="text-align:center; padding:100px; color:#999; grid-column:1/-1;">ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
                if(loadMoreArea) loadMoreArea.style.display = 'none';
                return;
            }

            if (data.length < ITEMS_PER_PAGE) {
                isLastPage = true;
                if(loadMoreArea) loadMoreArea.style.display = 'none';
            } else {
                if(loadMoreArea) loadMoreArea.style.display = 'block';
            }
            
            listEl.style.display = 'grid';

            data.forEach(post => {
                const thumbSrc = getResizedImage(post.thumbnail);
                let starHtml = '';
                if (category === 'review' && post.rating) {
                    starHtml = `<div style="color:#f59e0b; font-size:12px; margin-bottom:5px;">`;
                    for(let i=0; i<5; i++) starHtml += i < post.rating ? '<i class="fa-solid fa-star"></i>' : '<i class="fa-regular fa-star"></i>';
                    starHtml += `</div>`;
                }

                const card = document.createElement('div');
                card.className = 'post-card';
                card.innerHTML = `
                    <div class="card-thumb">
                        ${thumbSrc 
                            ? `<img src="${thumbSrc}" loading="lazy" alt="ì¸ë„¤ì¼" onerror="this.src='${post.thumbnail}'">` 
                            : `<i class="fa-regular fa-image" style="font-size:40px; color:#ddd;"></i>`}
                    </div>
                    <div class="card-body">
                        ${starHtml}
                        <div class="card-title">${post.title}</div>
                        <div class="card-meta">
                            <span>${post.author_name || 'ìµëª…'}</span>
                            <span>${new Date(post.created_at).toLocaleDateString()}</span>
                        </div>
                    </div>
                `;
                card.onclick = () => location.href = `/board.html?cat=${category}&country=${currentCountry}&id=${post.id}`;
                listEl.appendChild(card);
            });

        } catch (e) {
            console.error(e);
            if(!isAppend) {
                listEl.style.display = 'block';
                listEl.innerHTML = `<div style="text-align:center; padding:50px; color:#ef4444;">ì„œë²„ ì—°ê²° ì‹¤íŒ¨ (${e.message})</div>`;
            }
        }
    }

    async function loadPostDetail(id) {
        showSection('view');
        try {
            await sb.rpc('increment_view_count', { post_id: id });
            const { data: post, error } = await sb.from('community_posts').select('*').eq('id', id).single();
            if (error) throw error;
            // [ìˆ˜ì •] ë‹¤êµ­ì–´ ì ìš©
            if (!post) return alert(window.t ? window.t('msg_post_deleted') : 'Post deleted.'), goToList();

            updateBoardSEO(post.title, post.content, post.thumbnail);

            // SEO: BlogPosting JSON-LD êµ¬ì¡°í™” ë°ì´í„° ì¶”ê°€
            if (category === 'blog') {
                const existingLd = document.getElementById('blogPostingJsonLd');
                if (existingLd) existingLd.remove();

                const domainMap = { KR: 'https://www.cafe2626.com', JP: 'https://www.cafe0101.com', US: 'https://www.cafe3355.com' };
                const langMap = { KR: 'ko', JP: 'ja', US: 'en' };
                const siteNameMap = { KR: 'ì¹´ë©œë ˆì˜¨í”„ë¦°íŒ…', JP: 'ã‚«ãƒ¡ãƒ¬ã‚ªãƒ³ãƒ—ãƒªãƒ³ãƒ†ã‚£ãƒ³ã‚°', US: 'Chameleon Printing' };
                const cc = post.country_code || currentCountry;
                const baseDomain = domainMap[cc] || domainMap.KR;
                const postUrl = `${baseDomain}/board.html?cat=blog&country=${cc}&id=${post.id}`;
                const plainDesc = (post.content || '').replace(/<[^>]*>?/gm, '').substring(0, 160).trim();

                // markdown í•„ë“œì—ì„œ SEO ë©”íƒ€ ì¶”ì¶œ
                let seoMeta = {};
                try { seoMeta = JSON.parse(post.markdown || '{}'); } catch(e) {}
                const metaDesc = seoMeta.meta_description || plainDesc;
                const focusKw = seoMeta.focus_keyword || '';

                // meta description ì—…ë°ì´íŠ¸
                let descMeta = document.querySelector('meta[name="description"]');
                if (descMeta) descMeta.setAttribute('content', metaDesc);

                // focus keyword â†’ meta keywords
                if (focusKw) {
                    let kwMeta = document.querySelector('meta[name="keywords"]');
                    if (!kwMeta) { kwMeta = document.createElement('meta'); kwMeta.name = 'keywords'; document.head.appendChild(kwMeta); }
                    const kws = (seoMeta.hashtags || []).join(',') || focusKw;
                    kwMeta.setAttribute('content', kws);
                }

                // hreflang ë™ì  ì—…ë°ì´íŠ¸ (ê°™ì€ í¬ìŠ¤íŠ¸ì˜ ë‹¤ë¥¸ ì–¸ì–´ ë²„ì „ì€ ì—†ì§€ë§Œ, ì¹´í…Œê³ ë¦¬ í˜ì´ì§€ hreflang)
                document.querySelectorAll('link[rel="alternate"][hreflang]').forEach(link => {
                    const hl = link.getAttribute('hreflang');
                    const hlMap = { ko: 'KR', ja: 'JP', en: 'US', 'x-default': 'KR' };
                    const hlCC = hlMap[hl] || 'KR';
                    link.href = `${domainMap[hlCC]}/board.html?cat=blog&country=${hlCC}`;
                });

                // canonical URL
                let canonical = document.querySelector('link[rel="canonical"]');
                if (canonical) canonical.href = postUrl;

                // BlogPosting JSON-LD
                const jsonLd = document.createElement('script');
                jsonLd.type = 'application/ld+json';
                jsonLd.id = 'blogPostingJsonLd';
                jsonLd.textContent = JSON.stringify({
                    "@context": "https://schema.org",
                    "@type": "BlogPosting",
                    "headline": post.title,
                    "description": metaDesc,
                    "image": post.thumbnail || '',
                    "author": {
                        "@type": "Organization",
                        "name": siteNameMap[cc] || 'ì¹´ë©œë ˆì˜¨í”„ë¦°íŒ…',
                        "url": baseDomain
                    },
                    "publisher": {
                        "@type": "Organization",
                        "name": siteNameMap[cc] || 'ì¹´ë©œë ˆì˜¨í”„ë¦°íŒ…',
                        "url": baseDomain,
                        "logo": { "@type": "ImageObject", "url": baseDomain + "/img/logo.png" }
                    },
                    "datePublished": post.created_at,
                    "dateModified": post.created_at,
                    "url": postUrl,
                    "inLanguage": langMap[cc] || 'ko',
                    "keywords": focusKw || (seoMeta.hashtags || []).join(', '),
                    "mainEntityOfPage": { "@type": "WebPage", "@id": postUrl }
                });
                document.head.appendChild(jsonLd);
            }

            const ratingArea = document.getElementById('viewRatingArea');
            if (category === 'review' && post.rating) {
                let starHtml = '';
                for(let i=0; i<5; i++) starHtml += i < post.rating ? '<i class="fa-solid fa-star"></i>' : '<i class="fa-regular fa-star"></i>';
                ratingArea.innerHTML = starHtml;
                ratingArea.style.display = 'block';
            } else ratingArea.style.display = 'none';

            document.getElementById('viewTitle').innerText = post.title;
            document.getElementById('viewAuthor').innerHTML = `<i class="fa-regular fa-user"></i> ${post.author_name}`;
            document.getElementById('viewDate').innerHTML = `<i class="fa-regular fa-clock"></i> ${new Date(post.created_at).toLocaleString()}`;
            document.getElementById('viewCount').innerHTML = `<i class="fa-regular fa-eye"></i> ${post.view_count}`;
            document.getElementById('viewContent').innerHTML = post.content;
            // ì—…ë¡œë“œëœ MP4 ì£¼ì†Œë¥¼ ì‹¤ì œ ì¬ìƒ ê°€ëŠ¥í•œ <video> íƒœê·¸ë¡œ ë³€í™˜
            // [ìˆ˜ì •] ìë™ ì¬ìƒ ë° ì—¬ë°± ì œê±° ì„¤ì •
            const videoElements = document.querySelectorAll('#viewContent .ql-video, #viewContent video');
            videoElements.forEach(el => {
                const src = el.getAttribute('src') || el.src;
                if (src && (src.includes('supabase.co') || src.endsWith('.mp4'))) {
                    const videoTag = document.createElement('video');
                    videoTag.src = src;
                    
                    // ìë™ ì¬ìƒì„ ìœ„í•´ ë°˜ë“œì‹œ muted(ìŒì†Œê±°)ê°€ í•„ìš”í•©ë‹ˆë‹¤.
                    videoTag.autoplay = true; 
                    videoTag.muted = true;    
                    videoTag.loop = true;     // ë°˜ë³µ ì¬ìƒ
                    videoTag.playsInline = true; 
                    videoTag.controls = true; // ì»¨íŠ¸ë¡¤ë°” ìœ ì§€
                    
                    // ê²€ì€ ì˜†ë¶€ë¶„ ì œê±° ìŠ¤íƒ€ì¼
                    videoTag.style.width = "100%";
                    videoTag.style.aspectRatio = "16 / 9"; // ì¼ë°˜ì ì¸ ì˜ìƒ ë¹„ìœ¨ ìœ ì§€
                    videoTag.style.objectFit = "cover";    // ì—¬ë°± ì—†ì´ ê½‰ ì±„ì›€
                    videoTag.style.display = "block";
                    videoTag.style.margin = "15px 0";
                    videoTag.style.borderRadius = "8px";
                    
                    el.parentNode.replaceChild(videoTag, el);
                }
            });

            const btnGroup = document.getElementById('btnGroupAuth');
            if (currentUser && (isAdmin || currentUser.id === post.author_id)) btnGroup.style.display = 'block';
            else btnGroup.style.display = 'none';
            
            loadComments(id);
        } catch(e) {
            console.error(e);
            alert("ê¸€ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
            goToList();
        }
    }

    // [ìˆ˜ì •] ëŒ“ê¸€ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° (ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ í¬í•¨)
    async function loadComments(postId) {
        const listDiv = document.getElementById('commentList');
        listDiv.innerHTML = 'ëŒ“ê¸€ ë¡œë”© ì¤‘...';
        
        try {
            const { data: comments, error } = await sb
                .from('community_comments')
                .select('*')
                .eq('post_id', postId)
                .order('created_at', { ascending: true });

            if (error) throw error;
            
            listDiv.innerHTML = '';
            
            if (!comments || comments.length === 0) { 
                listDiv.innerHTML = '<p style="color:#999; text-align:center; padding:20px;">ì²« ë²ˆì§¸ ëŒ“ê¸€ì„ ë‚¨ê²¨ì£¼ì„¸ìš”!</p>'; 
                return; 
            }

            comments.forEach(cmt => {
                const item = document.createElement('div');
                item.className = 'comment-item';
                item.id = `comment-${cmt.id}`; 

                const safeName = cmt.author_name ? cmt.author_name.replace(/</g, "&lt;") : "ìµëª…";
                const safeContent = cmt.content ? cmt.content.replace(/</g, "&lt;").replace(/\n/g, '<br>') : "";

                const btnHtml = `
                    <div style="margin-left:auto; font-size:12px; display:flex; gap:8px;">
                        <span onclick="window.enableEditComment(${cmt.id})" style="cursor:pointer; color:#6366f1; font-weight:bold;">ìˆ˜ì •</span>
                        <span onclick="window.deleteComment(${cmt.id})" style="cursor:pointer; color:#ef4444; font-weight:bold;">ì‚­ì œ</span>
                    </div>
                `;

                item.innerHTML = `
                    <div class="comment-top" style="display:flex; align-items:center;">
                        <span class="comment-author" id="author-${cmt.id}" style="font-weight:bold; margin-right:10px;">${safeName}</span>
                        <span class="comment-date" style="font-size:12px; color:#999;">${new Date(cmt.created_at).toLocaleDateString()}</span>
                        ${btnHtml}
                    </div>
                    <div class="comment-text" id="content-${cmt.id}" style="margin-top:5px; line-height:1.5;">${safeContent}</div>
                `;
                listDiv.appendChild(item);
            });

        } catch(e) { 
            console.error(e);
            listDiv.innerHTML = '<p style="color:red; text-align:center;">ëŒ“ê¸€ ë¡œë”© ì‹¤íŒ¨</p>'; 
        }
    }

    // [ê¸°ëŠ¥] ëŒ“ê¸€ ìˆ˜ì • ëª¨ë“œ
    window.enableEditComment = function(cmtId) {
        const itemDiv = document.getElementById(`comment-${cmtId}`);
        const authorSpan = document.getElementById(`author-${cmtId}`);
        const contentDiv = document.getElementById(`content-${cmtId}`);

        const currentName = authorSpan ? authorSpan.innerText : "";
        const currentContent = contentDiv ? contentDiv.innerHTML.replace(/<br\s*\/?>/gi, "\n").replace(/&lt;/g, "<").replace(/&gt;/g, ">") : "";

        itemDiv.innerHTML = `
            <div style="background:#f8fafc; padding:10px; border-radius:8px; border:1px solid #e2e8f0;">
                <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                    <input id="edit-name-${cmtId}" class="ai-input-pretty" value="${currentName}" style="width:120px; padding:5px; font-size:13px;" placeholder="ì´ë¦„">
                    <div style="display:flex; gap:5px;">
                        <button onclick="window.saveComment(${cmtId})" class="btn primary" style="padding:4px 10px; font-size:12px;">ì €ì¥</button>
                        <button onclick="loadComments('${postId}')" class="btn" style="padding:4px 10px; font-size:12px; background:white; border:1px solid #ddd; color:#333;">ì·¨ì†Œ</button>
                    </div>
                </div>
                <textarea id="edit-content-${cmtId}" class="ai-input-pretty" style="width:100%; height:60px; padding:5px; font-size:14px;">${currentContent}</textarea>
            </div>
        `;
    };

    // [ê¸°ëŠ¥] ëŒ“ê¸€ ì €ì¥
    window.saveComment = async function(cmtId) {
        const newName = document.getElementById(`edit-name-${cmtId}`).value;
        const newContent = document.getElementById(`edit-content-${cmtId}`).value;

        if (!newName.trim() || !newContent.trim()) return alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        if(!confirm("ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

        try {
            const { error } = await sb.from('community_comments').update({ author_name: newName, content: newContent }).eq('id', cmtId);
            if (error) throw error;
            loadComments(postId);
        } catch (e) {
            console.error(e);
            alert("ìˆ˜ì • ì‹¤íŒ¨: " + e.message);
        }
    };

    // [ê¸°ëŠ¥] ëŒ“ê¸€ ì‚­ì œ
    window.deleteComment = async function(cmtId) {
        if (!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
        try {
            const { error } = await sb.from('community_comments').delete().eq('id', cmtId);
            if (error) throw error;
            loadComments(postId);
        } catch (e) {
            console.error(e);
            alert("ì‚­ì œ ì‹¤íŒ¨: " + e.message);
        }
    };

    function createLoadMoreButton() {
        const listContainer = document.querySelector('.board-container');
        const oldBtn = document.getElementById('loadMoreArea');
        if(oldBtn) oldBtn.remove();

        const btnDiv = document.createElement('div');
        btnDiv.id = 'loadMoreArea';
        btnDiv.style.textAlign = 'center';
        btnDiv.style.marginTop = '20px';
        btnDiv.style.display = 'none';
        btnDiv.innerHTML = `<button id="btnLoadMore" class="btn" style="width:200px; padding:10px;">ë” ë³´ê¸° (+)</button>`;
        listContainer.appendChild(btnDiv);
        document.getElementById('btnLoadMore').onclick = () => { currentPage++; loadPostList(true); };
    }

    function showSection(sec) {
        document.getElementById('boardList').style.display = sec === 'list' ? 'grid' : 'none';
        document.getElementById('boardView').style.display = sec === 'view' ? 'block' : 'none';
        document.getElementById('boardWrite').style.display = sec === 'write' ? 'flex' : 'none';
        const btnWrite = document.getElementById('btnWrite');
        const loadMore = document.getElementById('loadMoreArea');
        if (sec === 'list') {
            btnWrite.style.display = 'inline-block';
            if(loadMore && !isLastPage) loadMore.style.display = 'block';
        } else {
            btnWrite.style.display = 'none';
            if(loadMore) loadMore.style.display = 'none';
        }
    }

    window.editCurrentPost = function() {
        if(!confirm("ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
        isEditMode = true; 
        document.getElementById('inputTitle').value = document.getElementById('viewTitle').innerText;
        
        // [ìˆ˜ì •] ì—ë””í„° ì§„ì… ì‹œ video íƒœê·¸ë¥¼ Quillì´ ì¸ì‹í•˜ëŠ” iframeìœ¼ë¡œ ì¼ì‹œ ë³€í™˜
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = document.getElementById('viewContent').innerHTML;
        tempDiv.querySelectorAll('video').forEach(v => {
            const iframe = document.createElement('iframe');
            iframe.setAttribute('class', 'ql-video');
            iframe.setAttribute('src', v.src);
            v.parentNode.replaceChild(iframe, v);
        });
        quill.root.innerHTML = tempDiv.innerHTML;
        if (category === 'review') document.getElementById('ratingInputArea').style.display = 'flex';
        showSection('write');
    };

    window.deleteCurrentPost = async function() {
        if(!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤)")) return;
        const btn = document.getElementById('btnDeletePost');
        if(btn) btn.disabled = true;

        try {
            const { error: cmtError } = await sb.from('community_comments').delete().eq('post_id', postId);
            if (cmtError) console.warn("ëŒ“ê¸€ ì‚­ì œ ê²½ê³ :", cmtError.message);

            const { error: postError } = await sb.from('community_posts').delete().eq('id', postId);
            if (postError) throw postError;

            alert("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
            window.goToList(); 

        } catch(e) { 
            console.error(e);
            alert("ì‚­ì œ ì‹¤íŒ¨: " + e.message);
            if(btn) btn.disabled = false;
        }
    };

    function setupStarRating() {
        const stars = document.querySelectorAll('#starInput i');
        stars.forEach(star => {
            star.onclick = function() {
                currentRating = parseInt(this.getAttribute('data-score'));
                stars.forEach(s => {
                    if(parseInt(s.getAttribute('data-score')) <= currentRating) s.classList.add('active');
                    else s.classList.remove('active');
                });
            };
        });
    }

    function setupEventListeners() {
        document.getElementById('btnWrite').onclick = () => {
            isEditMode = false; 
            document.getElementById('inputTitle').value = "";
            quill.setContents([]);
            if (category === 'review') {
                document.getElementById('ratingInputArea').style.display = 'flex';
                currentRating = 5; 
                document.querySelectorAll('#starInput i').forEach(s => s.classList.add('active'));
            } else document.getElementById('ratingInputArea').style.display = 'none';
            showSection('write');
        };

        document.getElementById('btnSubmitPost').onclick = async () => {
            const btn = document.getElementById('btnSubmitPost');
            const title = document.getElementById('inputTitle').value;
            
            // [ìˆ˜ì •] ì €ì¥ ì „ ë¹„ë””ì˜¤ íƒœê·¸ ë³€í™˜
            const tempSaveDiv = document.createElement('div');
            tempSaveDiv.innerHTML = quill.root.innerHTML;
            const qlVideos = tempSaveDiv.querySelectorAll('.ql-video');
            qlVideos.forEach(el => {
                const src = el.getAttribute('src');
                if (src && src.includes('supabase.co')) {
                    const videoTag = document.createElement('video');
                    videoTag.src = src;
                    videoTag.controls = true; videoTag.autoplay = true; videoTag.muted = true; videoTag.loop = true;
                    videoTag.style.width = "100%"; videoTag.style.objectFit = "cover"; videoTag.style.aspectRatio = "16/9";
                    el.parentNode.replaceChild(videoTag, el);
                }
            });
            const content = tempSaveDiv.innerHTML;
            // [ìˆ˜ì •] ë‹¤êµ­ì–´ ì ìš©
            if (!title) return alert(window.t ? window.t('msg_enter_title') : 'Please enter title.');

            const originalText = btn.innerText;
            btn.innerText = window.t ? window.t('msg_processing') : "Processing...";
            btn.disabled = true;

            try {
                let thumbUrl = null;
                const parser = new DOMParser();
                const doc = parser.parseFromString(content, 'text/html');
                const firstImg = doc.querySelector('img');
                if (firstImg) thumbUrl = firstImg.src;

                const ratingValue = (category === 'review') ? currentRating : null;
                const authorId = currentUser ? currentUser.id : null; 
                const authorName = currentUser ? (currentUser.user_metadata.full_name || currentUser.email.split('@')[0]) : 'ìµëª…(Guest)';
                const authorEmail = currentUser ? currentUser.email : '';
                
                const payload = { 
                    title, 
                    content, 
                    rating: ratingValue, 
                    thumbnail: thumbUrl 
                };

                if (isEditMode) {
                    if (!currentUser) throw new Error("ìˆ˜ì • ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");
                    const { error } = await sb.from('community_posts').update(payload).eq('id', postId);
                    if (error) throw error;
                    alert("ìˆ˜ì • ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
                    location.reload();
                } else {
                    payload.category = category;
                    payload.country_code = currentCountry;
                    payload.author_id = authorId;
                    payload.author_name = authorName;
                    payload.author_email = authorEmail;
                    
                    if (subCode) {
                        payload.target_code = subCode;
                        if (!payload.title.includes(`[${subName}]`)) {
                            payload.title = `[${subName}] ` + payload.title;
                        }
                    }
                    
                    const { error } = await sb.from('community_posts').insert(payload);
                    if (error) throw error;
                    
                    alert('ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    window.goToList(); 
                }
            } catch (e) {
                console.error(e);
                alert("ì²˜ë¦¬ ì‹¤íŒ¨: " + e.message);
                btn.innerText = originalText;
                btn.disabled = false;
            }
        };

        document.getElementById('btnSubmitComment').onclick = async () => {
            const txt = document.getElementById('commentInput').value;
            if(!txt.trim()) return alert('ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.');
            const cmtAuthorId = currentUser ? currentUser.id : null;
            const cmtAuthorName = currentUser ? (currentUser.user_metadata.full_name || currentUser.email.split('@')[0]) : 'ìµëª…(Guest)';
            const { error } = await sb.from('community_comments').insert({ post_id: postId, author_id: cmtAuthorId, author_name: cmtAuthorName, content: txt });
            if(error) alert("ì‹¤íŒ¨"); else { document.getElementById('commentInput').value = ''; loadComments(postId); }
        };
    }
// ê²Œì‹œê¸€ ë‹¤ë¥¸ ì–¸ì–´ë¡œ ë³µì œ ê¸°ëŠ¥ (DeepL/Google ë²ˆì—­ ì—°ë™ ëŒ€ì‹  êµ¬ì¡° ë³µì œ)
    // [ì—…ê·¸ë ˆì´ë“œ] ìë™ ë²ˆì—­ ê¸°ëŠ¥ì„ í¬í•¨í•œ ê²Œì‹œê¸€ ë³µì œ
    // [ê°œì„ í˜•] ê¸´ ë³¸ë¬¸ë„ ë²ˆì—­ ê°€ëŠ¥í•œ ìë™ ë²ˆì—­ ë³µì œ í•¨ìˆ˜
    // [ìµœì¢… ê°œì„ ] êµµì€ ê¸€ì”¨(íƒœê·¸ ë‚´ë¶€)ê¹Œì§€ ëª¨ë‘ ë²ˆì—­í•˜ëŠ” ë³µì œ í•¨ìˆ˜
    window.copyPostToLang = async function(targetLang) {
        if(!confirm(`${targetLang === 'JP' ? 'ì¼ë³¸ì–´' : 'ì˜ì–´'}ë¡œ ë²ˆì—­í•˜ì—¬ ë³µì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
        
        const langMap = { 'JP': 'ja', 'US': 'en' };
        const targetTag = langMap[targetLang];

        try {
            const { data: post } = await sb.from('community_posts').select('*').eq('id', postId).single();
            alert("íƒ€ì´í‹€ê³¼ ë³¸ë¬¸ì„ ì •ë°€ ë²ˆì—­ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”...");

            async function translateSafe(text, target) {
                if(!text || text.trim().length === 0) return text;
                try {
                    const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${target}&dt=t&q=${encodeURIComponent(text)}`;
                    const res = await fetch(url);
                    const json = await res.json();
                    return json[0].map(item => item[0]).join('');
                } catch (e) {
                    return text; 
                }
            }

            // 1. ì œëª© ë²ˆì—­
            const translatedTitle = await translateSafe(post.title, targetTag);

            // 2. ë³¸ë¬¸ ë²ˆì—­ (ëª¨ë“  ìì‹ ë…¸ë“œë¥¼ íƒìƒ‰í•˜ì—¬ í…ìŠ¤íŠ¸ë§Œ ì¶”ì¶œ ë²ˆì—­)
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = post.content;
            
            async function translateNode(node) {
                for (let child of node.childNodes) {
                    if (child.nodeType === 3 && child.nodeValue.trim().length > 0) {
                        // í…ìŠ¤íŠ¸ ë…¸ë“œì¸ ê²½ìš°ë§Œ ë²ˆì—­í•˜ì—¬ ê°’ êµì²´
                        child.nodeValue = await translateSafe(child.nodeValue, targetTag);
                    } else if (child.nodeType === 1) {
                        // strong, b, span ë“± íƒœê·¸ì¸ ê²½ìš° ë‚´ë¶€ë¡œ ë” ë“¤ì–´ê° (ì¬ê·€)
                        await translateNode(child);
                    }
                }
            }
            await translateNode(tempDiv);

            // 3. ìƒˆ ê²Œì‹œê¸€ ìƒì„± ë° ì €ì¥
            const newPost = {
                ...post,
                id: undefined,
                title: translatedTitle,
                content: tempDiv.innerHTML,
                country_code: targetLang,
                view_count: 0,
                created_at: new Date()
            };
            delete newPost.id;

            const { data, error } = await sb.from('community_posts').insert(newPost).select().single();
            if (error) throw error;
            
            if(confirm("ë²ˆì—­ ë³µì œ ì™„ë£Œ! ìƒˆ ê²Œì‹œë¬¼ë¡œ ì´ë™í• ê¹Œìš”?")) {
                location.href = `board.html?cat=${post.category}&country=${targetLang}&id=${data.id}`;
            }
        } catch (e) {
            alert("ì˜¤ë¥˜ ë°œìƒ: " + e.message);
        }
    };
    init();
</script>
<script type="module">
    // 1. config.jsì—ì„œ sbì™€ initConfigë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
    import { sb, initConfig } from './config.js?v=123';

    // [ìœ ì… ê²½ë¡œ ìƒì„¸ ë¶„ì„ í•¨ìˆ˜]
    function getTrafficSource() {
        const params = new URLSearchParams(window.location.search);
        const referrer = document.referrer;
        
        // 1. [ê´‘ê³  ì²´í¬]
        if (params.has('gclid') || params.get('utm_medium') === 'cpc' || params.get('utm_source') === 'ad') {
            return 'Google Ads (ê´‘ê³ )';
        }
        
        // 2. [ì§ì ‘ ì ‘ì†]
        if (!referrer || referrer.trim() === '') {
            return 'Direct (ì¦ê²¨ì°¾ê¸°/ì£¼ì†Œì…ë ¥)';
        }

        // 3. [ì‚¬ì´íŠ¸ ë¶„ì„]
        try {
            const refUrl = new URL(referrer);
            const hostname = refUrl.hostname.toLowerCase();

            // ë‚´ë¶€ ì´ë™ (ë©”ì¸ -> ë¸”ë¡œê·¸ ë“±)
            if (hostname.includes(window.location.hostname)) return 'Internal (ë‚´ë¶€ì´ë™)';

            if (hostname.includes('google.')) return 'Google Search (ìì—°ê²€ìƒ‰)';
            if (hostname.includes('naver.')) return 'Naver Search (ìì—°ê²€ìƒ‰)';
            if (hostname.includes('daum.') || hostname.includes('kakao.')) return 'Daum/Kakao';
            if (hostname.includes('instagram.')) return 'Instagram';
            if (hostname.includes('facebook.') || hostname.includes('fb.com')) return 'Facebook';
            if (hostname.includes('youtube.')) return 'Youtube';
            
            return hostname;
        } catch (e) {
            return 'Other Websites';
        }
    }

    async function trackVisit() {
        // â˜… [í•µì‹¬ ìˆ˜ì •] DB(sb)ê°€ ì•„ì§ ì¤€ë¹„ ì•ˆ ëìœ¼ë©´(nullì´ë©´), ê°•ì œë¡œ ì—°ê²°ì„ ì‹œë„í•˜ê³  ê¸°ë‹¤ë¦½ë‹ˆë‹¤.
        if (!sb || !sb.from) {
            console.log("â³ DB ì—°ê²° ëŒ€ê¸° ì¤‘..."); 
            if(typeof initConfig === 'function') await initConfig();
        }

        try {
            // ìƒì„¸ ë¶„ì„ëœ ìœ ì… ê²½ë¡œ ê°€ì ¸ì˜¤ê¸°
            const sourceName = getTrafficSource();
            // ë¸”ë¡œê·¸ ìœ ì…ì„ì„ í‘œì‹œí•˜ê¸° ìœ„í•´ [Blog] íƒœê·¸ ì¶”ê°€
            const finalReferrer = `[Blog] ${sourceName}`; 

            // íƒ€ì„ì¡´ ê¸°ë°˜ ì‹¤ì œ êµ­ê°€ ê°ì§€
            function _detectCountry() {
                try {
                    const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || '';
                    if (tz.includes('Seoul') || tz.includes('Korea')) return 'KR';
                    if (tz.includes('Tokyo') || tz.includes('Japan')) return 'JP';
                    if (tz.includes('Taipei')) return 'TW';
                    if (tz.includes('Shanghai') || tz.includes('Hong_Kong') || tz.includes('Chongqing') || tz.includes('Urumqi') || tz.includes('Macau')) return 'CN';
                    if (tz.includes('Kolkata') || tz.includes('Calcutta') || tz.includes('Mumbai') || tz.includes('Delhi') || tz.includes('Asia/Colombo')) return 'IN';
                    if (tz.includes('Bangkok') || tz.includes('Ho_Chi_Minh') || tz.includes('Singapore') || tz.includes('Jakarta') || tz.includes('Manila') || tz.includes('Kuala_Lumpur') || tz.includes('Phnom_Penh') || tz.includes('Yangon') || tz.includes('Vientiane')) return 'SEA';
                    if (tz.includes('Riyadh') || tz.includes('Arabia') || tz.includes('Kuwait') || tz.includes('Dubai') || tz.includes('Qatar') || tz.includes('Bahrain') || tz.includes('Muscat') || tz.includes('Baghdad') || tz.includes('Tehran') || tz.includes('Istanbul') || tz.includes('Beirut') || tz.includes('Jerusalem') || tz.includes('Amman')) return 'ME';
                    if (tz.includes('Australia') || tz.includes('Auckland') || tz.includes('Pacific/Fiji')) return 'AU';
                    if (tz.includes('Moscow') || tz.includes('Vladivostok') || tz.includes('Novosibirsk') || tz.includes('Yekaterinburg') || tz.includes('Kamchatka') || tz.includes('Irkutsk') || tz.includes('Krasnoyarsk') || tz.includes('Magadan') || tz.includes('Sakhalin')) return 'RU';
                    if (tz.includes('Mexico') || tz.includes('Buenos_Aires') || tz.includes('Bogota') || tz.includes('Lima') || tz.includes('Santiago') || tz.includes('Sao_Paulo') || tz.includes('Caracas') || tz.includes('Havana') || tz.includes('Argentina') || tz.includes('Brazil') || tz.includes('Colombia')) return 'LATAM';
                    if (tz.includes('America') || tz.includes('US/') || tz.includes('Canada') || tz.includes('Pacific/Honolulu')) return 'US';
                    if (tz.includes('Africa') || tz.includes('Cairo') || tz.includes('Lagos') || tz.includes('Nairobi') || tz.includes('Johannesburg') || tz.includes('Casablanca')) return 'AF';
                    if (tz.includes('Europe') || tz.includes('London') || tz.includes('Berlin') || tz.includes('Paris') || tz.includes('Madrid') || tz.includes('Rome') || tz.includes('Amsterdam') || tz.includes('Warsaw')) return 'EU';
                    return 'OTHER';
                } catch(e) { return 'KR'; }
            }

            const { data, error } = await sb
                .from('page_views')
                .insert([{
                    referrer: finalReferrer,
                    duration: 0,
                    site: _detectCountry()
                }])
                .select()
                .single();

            if (error) throw error;

            console.log("âœ… ë¸”ë¡œê·¸ ë°©ë¬¸ ê¸°ë¡ ì„±ê³µ:", finalReferrer);

            // ì²´ë¥˜ì‹œê°„ ì—…ë°ì´íŠ¸ (5ì´ˆ ê°„ê²©)
            const visitId = data.id;
            const startTime = Date.now();
            
            setInterval(() => {
                const durationSec = Math.floor((Date.now() - startTime) / 1000);
                sb.from('page_views')
                  .update({ duration: durationSec })
                  .eq('id', visitId)
                  .then(() => {});
            }, 5000);

        } catch (e) {
            console.warn("Tracking skipped:", e.message);
        }
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
    trackVisit();
</script>

</body>
</html>