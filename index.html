<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>카멜레온 무료에디터 카프 : Expert Studio (Full Version)</title>
<title>카멜레온 카프 : Expert Studio</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/svg2pdf.js@2.2.4/dist/svg2pdf.umd.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/plugins/svg.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/kilobtye/potrace@master/potrace.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/opentype.js@latest/dist/opentype.min.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/GmarketSans/build/GmarketSans.css">
<link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700;800&family=Nanum+Myeongjo:wght@400;700;800&family=Do+Hyeon&family=Jua&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
    :root { 
        --primary: #6366f1; --primary-dark: #4f46e5;
        --text-main: #111827; --text-sub: #4b5563;
        --bg-sidebar: #ffffff; 
        --bg-stage: #2b2b2b; /* 포토샵 스타일 진한 회색 배경 */
        --border: #e5e7eb;
    }
    * { box-sizing: border-box; outline: none; user-select: none; -webkit-tap-highlight-color: transparent; }
    
    body { 
        margin: 0; height: 100vh; height: 100dvh; overflow: hidden; 
        background: var(--bg-sidebar); 
        font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, 'Nanum Gothic', sans-serif; 
        color: var(--text-main);
    }
    
    button, input, textarea, select { font-family: inherit; }
    .canvas-container { margin: auto !important; }

    #loading { position:fixed; inset:0; background:rgba(255,255,255,0.95); z-index:20000; display:none; justify-content:center; align-items:center; flex-direction:column; backdrop-filter: blur(5px); }
    .loading-spin { width:50px; height:50px; border:5px solid #e5e7eb; border-top:5px solid var(--primary); border-radius:50%; animation:spin 1s infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    /* =========================================
       [시작 화면 스타일]
       ========================================= */
    #startScreen { 
        position: fixed; inset: 0; 
        background: #fff; 
        z-index: 9999; 
        display: flex; flex-direction: column; align-items: center; justify-content: flex-start; 
        overflow-y: auto; 
        padding-bottom: 80px;
    }

    /* 장바구니 이미지 강제 축소 스타일 */
.cart-item img {
    width: 80px !important;
    height: 80px !important;
    object-fit: contain !important; /* 비율 유지하며 안에 맞춤 */
    background-color: #f8fafc;
    border: 1px solid #e2e8f0;
}
    /* =========================================
    [우클릭 메뉴 스타일 추가]
    ========================================= */
#contextMenu {
    display: none; /* 기본적으로 숨김 */
    position: fixed;
    z-index: 99999;
    background: #fff;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.15);
    padding: 6px 0;
    width: 160px;
    font-size: 13px;
    color: #333;
}
.ctx-item {
    padding: 8px 15px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: background 0.1s;
}
.ctx-item:hover {
    background: #f3f4f6;
    color: var(--primary);
}
.ctx-divider {
    height: 1px;
    background: #e5e7eb;
    margin: 5px 0;
}
    /* 1. 히어로 섹션 */
    .hero-section {
        width: 100%;
        padding: 50px 20px 30px;
        text-align: center;
        background: #fff;
        margin-bottom: 10px;
    }
    .hero-title { 
        font-size: 54px; 
        font-weight: 900; color: #111; 
        letter-spacing: -0.04em; line-height: 1.1; margin-bottom: 15px; 
    }
    .hero-title span { 
        background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }
    .hero-desc { 
        font-size: 18px; color: #6b7280; font-weight: 500; 
        background: #f3f4f6; padding: 10px 24px; border-radius: 30px; display: inline-block; 
    }

    /* 2. 제품 선택 (Quick Menu) - 8열 (2줄) */
    .quick-menu-wrapper {
        width: 98%;
        max-width: 1200px;
        margin-bottom: 40px;
        padding: 0 10px;
    }
    .quick-menu-label {
        font-size: 15px; font-weight: 800; color: #374151;
        margin-bottom: 15px; text-align: center; text-transform: uppercase; letter-spacing: 0.05em;
    }
    
    .quick-menu-track {
        display: grid;
        grid-template-columns: repeat(8, 1fr); 
        gap: 12px; 
        justify-content: center;
    }

    .quick-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%; 
        cursor: pointer;
        transition: transform 0.2s;
        margin-bottom: 5px;
        background: #f9fafb;
        border-radius: 16px;
        padding: 12px 5px; 
        border: 1px solid transparent;
    }
    .quick-item:hover { 
        transform: translateY(-5px); 
        background: #fff; 
        border-color: var(--primary);
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);
    }
    
    .quick-icon {
        width: 60px; height: 60px; 
        background: #1f2937; 
        border-radius: 18px; 
        display: flex; align-items: center; justify-content: center;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        font-size: 26px; 
        color: white;
        margin-bottom: 8px;
        transition: all 0.2s;
    }
    .quick-item:hover .quick-icon {
        background: var(--primary);
        box-shadow: 0 8px 16px rgba(99, 102, 241, 0.4);
    }
    .quick-text {
        font-size: 13px; 
        color: #374151;
        font-weight: 700;
        text-align: center;
        letter-spacing: -0.02em;
        white-space: nowrap;
    }

    /* 3. 템플릿 갤러리 */
    .gallery-section { width: 96%; max-width: 1600px; margin-top: 10px; }
    .gallery-header { 
        text-align: center; margin-bottom: 30px; 
        font-size: 16px; font-weight: 800; color: #474747; 
        display: flex; align-items: center; justify-content: center; gap: 15px;
    }
    .gallery-header::before, .gallery-header::after { content: ''; height: 2px; width: 40px; background: #e5e7eb; }
    
    .template-grid-start {
        column-count: 5; 
        column-gap: 20px;
        width: 100%;
    }
    .tpl-card-start {
        display: inline-block; 
        width: 100%;
        background: #fff;
        border-radius: 16px;
        overflow: hidden;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        margin-bottom: 15px; 
        break-inside: avoid; 
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        border: 1px solid #e5e7eb;
    }
    .tpl-card-start:hover { 
        transform: translateY(-5px); 
        box-shadow: 0 15px 30px rgba(0,0,0,0.1); 
        border-color: var(--primary);
        z-index: 10;
    }
    .tpl-card-img { 
        width: 100%; 
        height: auto; 
        display: block; 
        background: #f9fafb;
    }
    .tpl-card-overlay {
        position: absolute; inset: 0;
        background: rgba(0,0,0,0.05);
        opacity: 0; transition: 0.2s;
        pointer-events: none;
    }
    .tpl-card-start:hover .tpl-card-overlay { opacity: 1; }

    /* 메인 에디터 레이아웃 */
    #mainEditor { display: none; width: 100vw; height: 100vh; height: 100dvh; flex-direction: column; }
    .topbar { height: 60px; display: flex; align-items: center; padding: 0 25px; background: #fff; border-bottom: 1px solid var(--border); gap: 10px; z-index: 100; justify-content: space-between; overflow-x: auto; white-space: nowrap; }
    .topbar::-webkit-scrollbar { display: none; }
    .brand { font-weight: 800; font-size: 22px; color: var(--primary); cursor: pointer; flex-shrink: 0; }
    .template-tabs { display: flex; gap: 5px; }
    .tpl-tab { padding: 8px 16px; border-radius: 8px; background: #f8fafc; color: var(--text-sub); font-size: 13px; font-weight: 600; cursor: pointer; border: 1px solid transparent; transition: 0.2s; white-space: nowrap; }
    .tpl-tab:hover { background: #eff6ff; color: var(--primary); }
    #btnMobileTemplateOpen { display: none; padding: 8px 12px; border-radius: 8px; background: #eff6ff; color: var(--primary); font-size: 13px; font-weight: 700; border: 1px solid var(--primary); cursor: pointer; }

    .btn { padding: 9px 18px; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; transition: 0.2s; border: 1px solid transparent; white-space: nowrap; flex-shrink: 0; }
    .btn.primary { background: var(--primary); color: white; box-shadow: 0 4px 6px rgba(99, 102, 241, 0.2); }
    .btn:hover:not(.primary) { background: #f1f5f9; }
    .btn-save-top { background: #741e9c; color: white; display: flex; align-items: center; gap: 6px; }
    #btnOpenSaveModal { background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); color: white; border: none; font-weight: 800; box-shadow: 0 4px 10px rgba(99, 102, 241, 0.3); }

    .editor-wrap { display: grid; grid-template-columns: 280px 1fr; height: calc(100vh - 60px); width: 100vw; overflow: hidden; }
    .side { background: #fff; border-right: 1px solid var(--border); padding: 20px; overflow-y: auto; z-index: 20; display: flex; flex-direction: column; gap: 15px; }
    .stage { background: var(--bg-stage); width: 100%; height: 100%; position: relative; overflow: hidden; display: flex; justify-content: center; align-items: center; touch-action: none; }

    #wallHeightControls { position: absolute; top: 85px; left: 50%; transform: translateX(-50%); background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(8px); padding: 8px 15px; border-radius: 50px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.12); display: none; align-items: center; gap: 12px; z-index: 40; border: 1px solid rgba(0,0,0,0.1); white-space: nowrap; }
    .wall-label { font-size: 13px; font-weight: 700; color: #475569; display: flex; align-items: center; gap: 6px; }
    .height-btn { padding: 6px 16px; border-radius: 20px; border: 1px solid #e2e8f0; background: #fff; color: #64748b; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s; white-space: nowrap; }
    .height-btn.active { background: var(--primary); color: #fff; border-color: var(--primary); }

    .section-title { font-size: 13px; font-weight: 700; color: #333; margin-top: 10px; text-transform: uppercase; letter-spacing: 0.05em; }
    .btn-round { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid var(--border); background: #fff; font-weight: 600; cursor: pointer; font-size: 13px; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; color: var(--text-main); }
    .btn-round.primary { background: var(--primary); color: #fff; border: none; }
    .btn-round.ai-red { background: linear-gradient(135deg, #f43f5e 0%, #fb7185 100%); color: white; border: none; }
    .shape-panel { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
    .shape-btn { height: 40px; border: 1px solid var(--border); border-radius: 8px; cursor: pointer; background: #fff; font-size: 16px; color: #64748b; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
    .shape-btn:hover { border-color: var(--primary); color: var(--primary); background: #eff6ff; }
    .upload-box { border: 2px dashed #cbd5e1; border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; background: #f8fafc; color: #64748b; font-size: 13px; display: flex; flex-direction: column; align-items: center; transition: 0.2s; }
    .upload-box:hover { border-color: var(--primary); background: #eff6ff; color: var(--primary); }

    .right-stack { position: absolute; right: 20px; top: 20px; bottom: 20px; width: 260px; display: flex; flex-direction: column; gap: 15px; overflow-y: auto; z-index: 50; pointer-events: auto; }
    .right-stack::-webkit-scrollbar { width: 6px; }
    .right-stack::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 3px; }
    .panel-box { background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); border-radius: 16px; padding: 15px; box-shadow: var(--shadow); border: 2px solid transparent; flex-shrink: 0; }
    .tool-btn { flex: 1; min-width: 0; padding: 8px; margin-top: 5px; border-radius: 8px; border: 1px solid #eee; background: #fff; color: #333; font-size: 12px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; }
    .tool-btn:hover { border-color: var(--primary); color: var(--primary); background: #f8fafc; }
    .ai-tool-stack { display: flex; flex-direction: column; gap: 5px; width: 100%; }
    #btnCutout { background: #fff9c4; color: #5d4037; border: 1px solid #fbc02d; }
    #btnCutout:hover { background: #fff59d; transform: translateY(-1px); }
    .align-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; margin-top: 10px; }
    .align-btn { padding: 8px 0; border: 1px solid #eee; border-radius: 8px; background: #fff; cursor: pointer; color: #555; display: flex; align-items: center; justify-content: center; transition: 0.2s; font-size: 14px; }
    .align-btn:hover { background: #f8fafc; color: var(--primary); border-color: var(--primary); }
    .color-group { display: flex; align-items: center; justify-content: space-between; margin-top: 5px; border: 1px solid #e2e8f0; padding: 5px 10px; border-radius: 8px; font-size: 12px; color: #666; }
    .color-picker { -webkit-appearance: none; appearance: none; width: 32px; height: 32px; border: 1px solid #e2e8f0; background: none; cursor: pointer; padding: 0; border-radius: 50%; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: transform 0.2s; box-sizing: border-box; }
    .color-picker::-webkit-color-swatch-wrapper { padding: 0; border: none; }
    .color-picker::-webkit-color-swatch { border: none; border-radius: 50%; padding: 0; }
    .color-picker:hover { transform: scale(1.1); }
    .bottom-dock { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); background: #fff; padding: 8px 20px; border-radius: 50px; box-shadow: var(--shadow); display: flex; align-items: center; gap: 15px; z-index: 100; white-space: nowrap; }
    .zoom-btn { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px; cursor: pointer; color: #555; background: #f1f5f9; border:none; }
    .zoom-btn:hover { background: #e2e8f0; color: #000; }
    .divider { width: 1px; height: 16px; background: #ddd; }
    #guideToggle.active { background: var(--primary); color: white; }
    .help-text { font-size: 12px; color: #666; margin-left: 10px; font-weight: 500; white-space: nowrap; }

    /* 모달 및 기타 */
    .modal-bg { position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); display: none; justify-content: center; align-items: center; z-index: 10000; }
    .modal-box { background: #fff; padding: 30px; border-radius: 20px; width: 400px; text-align: center; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); max-height: 90vh; overflow-y: auto; }
    .ai-input-pretty { width: 100%; padding: 12px 15px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 14px; background: #f9f9f9; margin-bottom: 10px; outline: none; }
    .ai-input-pretty:focus { border-color: var(--primary); background: #fff; }
    .ai-drawer { position: fixed; top: 60px; right: 0; width: 360px; height: calc(100vh - 60px); background: #fff; border-left: 1px solid #e2e8f0; padding: 25px; z-index: 9000; transform: translateX(100%); transition: 0.3s; box-shadow: -5px 0 15px rgba(0,0,0,0.05); overflow-y: auto; }
    .ai-drawer.open { transform: translateX(0); }
    #templateOverlay { position: fixed; inset: 0; background: rgba(255,255,255,0.6); backdrop-filter: blur(15px); z-index: 9999; display: none; justify-content: center; align-items: center; }
    .tpl-modal-box { width: 90%; max-width: 1200px; height: 85%; background: #fff; border-radius: 24px; box-shadow: 0 20px 60px rgba(0,0,0,0.15); border: 1px solid rgba(255,255,255,0.5); display: flex; overflow: hidden; }
    .tpl-sidebar { width: 240px; background: #f8fafc; border-right: 1px solid #e2e8f0; padding: 30px 20px; display: flex; flex-direction: column; gap: 10px; }
    .tpl-cate-btn { text-align: left; padding: 12px 16px; border-radius: 12px; font-size: 14px; font-weight: 600; color: #64748b; cursor: pointer; transition: 0.2s; border: none; background: transparent; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
    .tpl-cate-btn:hover { background: #e2e8f0; color: var(--text-main); }
    .tpl-cate-btn.active { background: #fff; color: var(--primary); box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
    .tpl-content { flex: 1; display: flex; flex-direction: column; background: #fff; }
    .tpl-grid { display: block !important; column-count: 3 !important; column-gap: 20px; width: 100%; padding: 20px; box-sizing: border-box; height: auto !important; flex: 1; overflow-y: auto !important; overflow-x: hidden; scrollbar-width: thin; background-color: #f1f5f9; }
    .tpl-item { position: relative; background-color: #ffffff; border-radius: 16px; overflow: hidden; cursor: pointer; border: none !important; padding: 0 !important; margin-bottom: 20px; break-inside: avoid; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
    .tpl-item-img { width: 100%; height: auto !important; object-fit: contain; display: block; background-color: #fff; margin: 0 !important; padding: 0 !important; }
    .tpl-item.selected { box-shadow: 0 0 0 3px var(--primary); }
    .tpl-item div:not(:has(img)) { display: none !important; }
   /* =========================================
   [★ NEW ★ 장바구니 PC/모바일 반응형 스타일]
   이 코드를 <style> 태그 안쪽, 맨 아래에 붙여넣으세요.
   ========================================= */
#cartPage { z-index: 120000; padding-top: 40px; }
#cartListArea { overflow-y: auto; max-height: 70vh; }

/* PC 버전: 좌측(정보) + 우측(옵션) 2단 그리드 레이아웃 */
/* [수정 위치 1] PC 레이아웃 설정 */
.cart-item {
    display: grid;
    /* 좌측은 남은 공간 전부(1fr), 우측은 340px 고정 → 자연스럽게 우측 끝 배치됨 */
    grid-template-columns: 1fr 340px; 
    gap: 30px; /* 좌우 사이 간격 */
    
    background: #fff;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    align-items: start; /* 위쪽 라인 맞춤 */
}

.cart-left-col {
    display: flex;
    gap: 20px;
}

.cart-thumb {
    width: 100px;
    height: 100px;
    object-fit: cover;
    border-radius: 10px;
    border: 1px solid #f1f5f9;
    flex-shrink: 0;
}

.cart-info-box {
    flex: 1;
    min-width: 0; /* 텍스트 말줄임/줄바꿈을 위해 필수 */
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}
/* =========================================
   [작업 방식 선택 모달 - 반응형 레이아웃]
   ========================================= */
.choice-layout {
    display: flex;
    gap: 30px;
    text-align: left;
}

/* 왼쪽 (텍스트 + 버튼) */
.choice-left {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

/* 오른쪽 (제품 이미지) */
.choice-right {
    width: 350px; /* PC에서 이미지 영역 너비 */
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f8fafc;
    border-radius: 12px;
    border: 1px solid #e2e8f0;
    padding: 10px;
    flex-shrink: 0;
}

.choice-right img {
    width: 100%;
    height: 100%;
    object-fit: contain; /* 비율 유지하며 꽉 채우기 */
    max-height: 300px;   /* 이미지 최대 높이 제한 */
}

/* 모바일 화면 (768px 이하) */
@media (max-width: 768px) {
    .choice-layout {
        flex-direction: column; /* 세로 정렬로 변경 */
    }
    
    .choice-right {
        width: 100%; /* 너비 꽉 채우기 */
        height: 250px; /* 모바일에서 높이 지정 */
        margin-top: 20px;
        order: 2; /* 아래로 내리기 (혹은 HTML 구조상 아래면 생략 가능) */
    }
    
    .choice-left {
        order: 1;
    }

    /* 모바일에서 버튼 높이 살짝 줄이기 */
    .choice-left button.btn-round {
        height: 100px !important; 
    }
}
/* 뱃지 및 텍스트 스타일 */
.cart-badges { margin-bottom: 8px; display: flex; flex-wrap: wrap; gap: 5px; align-items: center; }
.cart-badge { font-size: 11px; padding: 3px 6px; border-radius: 4px; font-weight: 600; }
.badge-design { background: #e0e7ff; color: #4338ca; }
.badge-file { background: #f1f5f9; color: #475569; }

.cart-title { font-size: 17px; font-weight: 700; color: #1e293b; margin: 0 0 5px 0; line-height: 1.35; word-break: keep-all; }
.cart-filename { font-size: 13px; color: #64748b; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block;}
.cart-price { font-size: 16px; font-weight: 800; color: #6366f1; margin-bottom: 12px; }

/* 수량/삭제 버튼 행 */
.cart-ctrl-row { display: flex; align-items: center; gap: 10px; }
.qty-wrapper { display: flex; align-items: center; border: 1px solid #e2e8f0; border-radius: 6px; background: #fff; overflow: hidden; }
.qty-btn { width: 32px; height: 32px; border: none; background: #fff; cursor: pointer; color: #64748b; display: flex; align-items: center; justify-content: center; }
.qty-btn:hover { background: #f8fafc; color: #333; }
.qty-val { width: 40px; text-align: center; font-size: 14px; font-weight: 700; border-left: 1px solid #f1f5f9; border-right: 1px solid #f1f5f9; line-height: 32px; }
.del-btn { width: 34px; height: 34px; border-radius: 6px; border: 1px solid #fee2e2; background: #fff; color: #ef4444; cursor: pointer; display: flex; align-items: center; justify-content: center; }
.del-btn:hover { background: #fee2e2; }

/* 우측 옵션 영역 스타일 */
.cart-right-col {
    background: #f9fafb;
    border: 1px solid #eee;
    border-radius: 10px;
    padding: 15px;
    min-height: 100px;
}
.opt-header { font-size: 13px; font-weight: 800; color: #475569; margin-bottom: 10px; display: block; }
.opt-select { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 13px; margin-bottom: 15px; outline: none; background: #fff; }
.opt-chk-group { display: flex; flex-direction: column; gap: 8px; }
.opt-chk-label { display: flex; align-items: center; padding: 10px; background: #fff; border: 1px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: 0.2s; }
.opt-chk-label:hover { border-color: #6366f1; }
.opt-chk-label input { accent-color: #6366f1; width: 16px; height: 16px; margin-right: 10px; flex-shrink: 0; }
.opt-name { flex: 1; font-size: 13px; color: #334155; font-weight: 500; word-break: keep-all; line-height: 1.3;}
.opt-price { font-size: 13px; font-weight: 700; color: #6366f1; white-space: nowrap; margin-left: 5px; }

/* 모바일 화면 최적화 (768px 이하) */
/* =========================================
   [모바일 UI 최종 수정: 로고 숨김 + 버튼 위치 조정]
   ========================================= */
@media (max-width: 768px) {
    /* 1. 상단 로고 숨기기 (공간 확보) */
    .brand { display: none !important; }
    
    /* 2. 에디터 영역 확장 */
    .editor-wrap {
        height: calc(100vh - 50px) !important;
        position: relative !important;
        width: 100vw !important;
    }
    
    /* 3. 캔버스 영역 */
    .stage {
        width: 100% !important;
        height: 100% !important;
        position: absolute !important;
        top: 0; left: 0;
        z-index: 1;
        background: #e5e5e5;
    }

    /* 4. 좌측 패널 (평소 숨김) */
    .side {
        position: fixed !important;
        top: 50px; bottom: 0; left: 0;
        width: 85% !important;
        max-width: 320px;
        background: #fff !important;
        z-index: 10000 !important;
        border-right: 1px solid #ddd;
        box-shadow: 5px 0 15px rgba(0,0,0,0.1);
        transform: translateX(-120%);
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex !important;
        flex-direction: column;
    }
    .side.open { transform: translateX(0); }

    /* 5. 우측 패널 (평소 숨김) */
    .right-stack {
        display: flex !important;
        position: fixed !important;
        top: 50px; bottom: 0; right: 0;
        width: 85% !important;
        max-width: 320px;
        background: #fff !important;
        z-index: 10000 !important;
        border-left: 1px solid #ddd;
        box-shadow: -5px 0 15px rgba(0,0,0,0.1);
        transform: translateX(120%);
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        padding: 20px !important;
        pointer-events: auto !important;
    }
    .right-stack.open { transform: translateX(0); }

    /* 6. 플로팅 버튼 (위치 조정됨) */
    #mobileControlDock {
        display: flex;
        position: fixed;
        /* ★★★ 수정됨: 채널톡 버튼 위로 올리기 위해 bottom 값을 20px -> 90px로 변경 */
        bottom: 90px; 
        left: 0; right: 0;
        justify-content: space-between;
        padding: 0 20px;
        z-index: 9000;
        pointer-events: none;
    }
    .mobile-fab {
        pointer-events: auto;
        width: 55px; height: 55px; /* 크기 살짝 줄임 */
        border-radius: 50%;
        border: none;
        color: white;
        font-size: 18px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        cursor: pointer;
        transition: transform 0.1s;
    }
    .mobile-fab:active { transform: scale(0.95); }
    .mobile-fab span { font-size: 10px; margin-top: 2px; font-weight: bold; }
    
    .mobile-fab.left { background: #6366f1; } 
    .mobile-fab.right { background: #111827; } 

    .panel-box { box-shadow: none !important; border: 1px solid #eee !important; }
}


    /* =========================================
       [푸터/회사정보 스타일 추가]
       ========================================= */
    .footer-wrap {
        width: 100%;
        background: #f9fafb;
        border-top: 1px solid #e5e7eb;
        padding: 40px 20px;
        margin-top: 50px;
        color: #4b5563;
        font-size: 13px;
    }
    .footer-inner {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        flex-wrap: wrap;
        gap: 30px;
        justify-content: space-between;
    }
    .foot-menu ul {
        list-style: none; padding: 0; margin: 0 0 20px 0; display: flex; gap: 20px;
    }
    .foot-menu a { text-decoration: none; color: #374151; font-weight: 600; }
    .foot-menu a:hover { color: var(--primary); }
    
    .foot-info dl { display: flex; flex-wrap: wrap; margin: 5px 0; gap: 5px; }
    .foot-info dt { font-weight: 700; color: #111; }
    .foot-info dd { color: #666; margin: 0; margin-right: 10px; }
    .copyright { margin-top: 15px; color: #9ca3af; font-size: 12px; }
    
    .cs-center h3 { margin: 0 0 10px 0; font-size: 16px; color: #111; }
    .cs-center strong { font-size: 24px; color: var(--primary); display: block; margin-bottom: 5px; }
    .cs-center p { margin: 0; line-height: 1.5; color: #666; }

    @media (max-width: 768px) {
        .footer-inner { flex-direction: column; gap: 20px; }
        .foot-menu ul { flex-wrap: wrap; gap: 10px; }
    }
    /* =========================================
   [입력창 터치/선택 오류 방지]
   ========================================= */
input, textarea, select {
    user-select: text !important;        /* 텍스트 선택 허용 */
    -webkit-user-select: text !important; /* 사파리/크롬 호환 */
    touch-action: manipulation !important; /* 터치 동작 최적화 */
}
/* =========================================
   [모바일 최적화 최종 완성본 (V3)]
   기존 media query 전체를 이 코드로 덮어씌우세요.
   ========================================= */
@media (max-width: 768px) {

    /* [1] 상단 메뉴바 (Topbar) - 버튼 복구 및 가로 스크롤 */
    .topbar {
        display: flex !important;
        align-items: center !important;
        justify-content: flex-start !important; /* 왼쪽부터 정렬 */
        gap: 8px !important;
        padding: 0 10px !important;
        overflow-x: auto !important; /* 버튼 많으면 스크롤 */
        white-space: nowrap !important;
        height: 50px !important;
        background: #fff !important;
    }
    .topbar::-webkit-scrollbar { display: none; } /* 스크롤바 숨김 */

    /* 1. 로고 */
    .brand { 
        order: 1 !important; 
        margin-right: 5px !important; 
        flex-shrink: 0 !important;
    }

    /* 3. 로그인 버튼 */
    #btnLoginBtn { 
        order: 3 !important; 
        flex-shrink: 0 !important; 
        padding: 8px 12px !important;
    }

    /* 4. [해결] 템플릿 버튼 (컨테이너 및 버튼 강제 표시) */
    .template-tabs {
        order: 4 !important;
        display: flex !important;
        flex-shrink: 0 !important;
        margin: 0 5px !important;
        opacity: 1 !important;
        visibility: visible !important;
    }
    /* 모바일용 템플릿 버튼 디자인 */
    #btnMobileTemplateOpen {
        display: flex !important;
        align-items: center !important;
        height: 34px !important;
        padding: 0 12px !important;
        background: #eff6ff !important;
        color: #6366f1 !important;
        border: 1px solid #6366f1 !important;
        border-radius: 8px !important;
        font-weight: 700 !important;
        font-size: 13px !important;
        white-space: nowrap !important;
    }
    .tpl-tab { display: none !important; } /* PC용 탭 숨김 */

    /* 5. 주문하기 & 저장하기 */
    #btnOrderTop { order: 5 !important; flex-shrink: 0 !important; }
    .btn-save-top { order: 6 !important; flex-shrink: 0 !important; }

    /* 빈 공간 채우기용 div 숨김 */
    .topbar > div[style*="flex:1"] { display: none !important; }


    /* [2] 에디터 화면 (좌우 패널 정리) */
    .editor-wrap {
        display: flex !important;
        flex-direction: column !important;
        width: 100vw !important;
        height: calc(100vh - 50px) !important;
        overflow: hidden !important;
    }
    .stage {
        order: 1 !important;
        width: 100% !important;
        height: 50% !important;
        border-bottom: 2px solid #ddd;
        position: relative !important;
    }
    .right-stack { display: none !important; } 
    .side {
        order: 2 !important;
        width: 100% !important;
        height: 50% !important;
        padding: 15px !important;
        overflow-y: auto !important;
        background: #fff !important;
        border-right: none !important;
    }

    /* [3] 템플릿 화면 (카테고리 잘림 해결) */
    .tpl-modal-box {
        width: 100% !important; height: 100% !important;
        border-radius: 0 !important; flex-direction: column !important;
        display: flex !important; overflow: hidden !important;
    }
    .tpl-sidebar {
        flex-direction: row !important; height: auto !important;
        padding: 10px 10px 10px 15px !important; 
        padding-right: 40px !important; /* 우측 여백 */
        overflow-x: auto !important; white-space: nowrap !important;
        border-right: none !important; border-bottom: 1px solid #eee;
        flex-shrink: 0 !important; width: 100% !important;
        box-sizing: border-box !important;
    }
    .tpl-cate-btn {
        margin-right: 10px !important; flex: 0 0 auto !important;
        background: #f1f5f9; padding: 8px 15px !important; border-radius: 20px !important;
    }
    .tpl-content { display: flex !important; flex-direction: column !important; height: 100% !important; overflow: hidden !important; }
    .tpl-content > div:first-child { display: flex !important; align-items: center !important; padding: 10px 15px !important; flex-shrink: 0 !important; }
    #tplSearchInput { width: auto !important; flex: 1 !important; margin-bottom: 0 !important; }
    .tpl-grid { flex: 1 !important; overflow-y: auto !important; column-count: 2 !important; padding: 10px !important; }
    .tpl-content > div:last-child { flex-shrink: 0 !important; padding: 15px !important; background: #fff; border-top: 1px solid #e2e8f0; z-index: 20 !important; }
    #btnUseTpl { width: 100% !important; height: 50px !important; font-size: 16px !important; font-weight: bold !important; }

    /* [4] 장바구니 화면 (가격 텍스트 위치 조정) */
    #cartPage { padding-top: 50px !important; background: #f1f5f9 !important; }
    #cartPage > div { display: flex !important; flex-direction: column !important; padding: 0 !important; height: 100% !important; }
    #cartPage > div > div { display: block !important; height: 100% !important; }
    #cartListArea { height: auto !important; max-height: none !important; padding: 15px 15px 280px 15px !important; overflow-y: auto !important; }

    .cart-item {
        display: flex !important; flex-direction: column !important;
        padding: 20px !important; background: #fff !important;
        border-radius: 16px !important; margin-bottom: 20px !important;
        position: relative !important;
    }
    .cart-item > div:nth-child(2) { order: 1 !important; margin-bottom: 20px !important; width: 100% !important; }
    .cart-item > div:nth-child(2) > div:first-child { display: block !important; width: 100% !important; margin-bottom: 10px !important; text-align: left !important; }
    
    .cart-item > div:first-child {
        order: 2 !important; margin-bottom: 15px !important;
        padding-top: 15px !important; border-top: 1px solid #f3f4f6;
        display: flex !important; align-items: flex-start !important;
    }
    .cart-item > div:first-child > div { display: flex !important; flex-direction: column !important; justify-content: flex-start !important; padding-left: 5px !important; }
    .cart-item > div:first-child > div > div:last-child { margin-top: 15px !important; font-size: 16px !important; display: block !important; }
    
    .cart-item > div:last-child { order: 3 !important; width: 100% !important; }
    #cartPage > div > div > div:last-child { position: fixed !important; bottom: 0 !important; left: 0 !important; width: 100% !important; background: #fff !important; padding: 20px !important; z-index: 12500 !important; border-radius: 20px 20px 0 0 !important; box-shadow: 0 -5px 10px rgba(0,0,0,0.05) !important; }

    
    /* 기타 */
    .hero-title { font-size: 26px !important; word-break: keep-all; }
    .quick-menu-track { grid-template-columns: repeat(2, 1fr) !important; }
    .template-grid-start { column-count: 2 !important; }
    #startScreen { padding-top: 20px !important; }
    .bottom-dock { display: none !important; }
}
/* =========================================
   [모바일 텍스트 에디터 스타일]
   ========================================= */
#mobileTextEditor {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 140px; /* 키보드 위 공간 확보 */
    background: #fff;
    z-index: 999999; /* 최상위 노출 */
    padding: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
    gap: 10px;
}
.m-text-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: bold;
    color: #333;
}
#mobileTextInput {
    width: 100%;
    flex: 1;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 10px;
    font-size: 16px;
    outline: none;
    resize: none;
    font-family: inherit;
}
#mobileTextInput:focus {
    border-color: #6366f1;
}
/* =========================================
   [NEW] 예쁜 로고 업로드 모달 스타일
   ========================================= */
.upload-drop-zone {
    width: 100%;
    height: 150px;
    border: 2px dashed #cbd5e1;
    border-radius: 12px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background: #f8fafc;
    color: #64748b;
    cursor: pointer;
    transition: all 0.2s;
    margin-bottom: 20px;
    position: relative;
    overflow: hidden;
}
.upload-drop-zone:hover, .upload-drop-zone.dragover {
    border-color: #6366f1;
    background: #eff6ff;
    color: #6366f1;
}
.upload-icon { font-size: 32px; margin-bottom: 10px; }
.upload-text { font-size: 14px; font-weight: 600; }
.upload-sub { font-size: 12px; opacity: 0.7; margin-top: 4px; }

/* 업로드된 이미지 미리보기 */
#previewImage {
    display: none;
    max-height: 100%;
    max-width: 100%;
    object-fit: contain;
    position: absolute;
    inset: 0;
    margin: auto;
    padding: 10px;
    background: #fff;
    z-index: 10;
}
#removeFileBtn {
    display: none;
    position: absolute;
    top: 10px; right: 10px;
    background: rgba(0,0,0,0.6);
    color: white;
    border-radius: 50%;
    width: 24px; height: 24px;
    align-items: center; justify-content: center;
    cursor: pointer;
    z-index: 20;
    font-size: 12px;
}
/* =========================================
   [모바일 UI 대수선: 슬라이드 패널 & 플로팅 버튼]
   ========================================= */
#mobileControlDock { display: none; } /* PC에서는 숨김 */

@media (max-width: 768px) {
    /* 1. 에디터 영역을 화면 전체로 확장 */
    .editor-wrap {
        height: calc(100vh - 50px) !important;
        position: relative !important;
        width: 100vw !important;
    }
    
    /* 2. 캔버스 영역 (Stage) */
    .stage {
        width: 100% !important;
        height: 100% !important; /* 화면 꽉 채우기 */
        position: absolute !important;
        top: 0; left: 0;
        z-index: 1; /* 맨 아래 */
        background: #e5e5e5; /* 배경색 구분 */
    }

    /* 3. 좌측 패널 (#toolsPanel) - 평소엔 숨김 */
    .side {
        position: fixed !important;
        top: 50px; bottom: 0; left: 0;
        width: 85% !important; /* 화면의 85% 차지 */
        max-width: 320px;
        background: #fff !important;
        z-index: 10000 !important;
        border-right: 1px solid #ddd;
        box-shadow: 5px 0 15px rgba(0,0,0,0.1);
        transform: translateX(-120%); /* 화면 왼쪽으로 숨김 */
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex !important; /* flex 유지 */
        flex-direction: column;
    }
    .side.open { transform: translateX(0); } /* 열렸을 때 */

    /* 4. 우측 패널 (.right-stack) - 평소엔 숨김 */
    .right-stack {
        display: flex !important; /* 강제로 보이게 설정 (기존 none 덮어쓰기) */
        position: fixed !important;
        top: 50px; bottom: 0; right: 0;
        width: 85% !important;
        max-width: 320px;
        background: #fff !important; /* 배경색 추가 */
        z-index: 10000 !important;
        border-left: 1px solid #ddd;
        box-shadow: -5px 0 15px rgba(0,0,0,0.1);
        transform: translateX(120%); /* 화면 오른쪽으로 숨김 */
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        padding: 20px !important;
        pointer-events: auto !important;
    }
    .right-stack.open { transform: translateX(0); } /* 열렸을 때 */

    /* 5. 플로팅 버튼 (FAB) 디자인 */
    #mobileControlDock {
        display: flex;
        position: fixed;
        bottom: 20px;
        left: 0; right: 0;
        justify-content: space-between;
        padding: 0 20px;
        z-index: 9000;
        pointer-events: none; /* 버튼 사이 빈 공간은 터치 통과 */
    }
    .mobile-fab {
        pointer-events: auto;
        width: 60px; height: 60px;
        border-radius: 50%;
        border: none;
        color: white;
        font-size: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        cursor: pointer;
        transition: transform 0.1s;
    }
    .mobile-fab:active { transform: scale(0.95); }
    .mobile-fab span { font-size: 10px; margin-top: 2px; font-weight: bold; }
    
    .mobile-fab.left { background: #6366f1; } /* 좌측: 보라색 */
    .mobile-fab.right { background: #111827; } /* 우측: 검정색 */

    /* 패널 내부 스크롤바 확보 */
    .panel-box { box-shadow: none !important; border: 1px solid #eee !important; }
}
/* [추가] 심플 제품 카드 스타일 */
.simple-prod-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: #fff;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    padding: 15px;
    cursor: pointer;
    transition: all 0.2s;
    position: relative; /* 팝업 위치 기준 */
}
.simple-prod-card:hover {
    border-color: #6366f1;
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.1);
    transform: translateY(-2px);
}

/* 아이콘 스타일 */
.prod-icon-box {
    width: 50px;
    height: 50px;
    background: #f8fafc;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: #475569;
    margin-bottom: 10px;
}

/* 텍스트 스타일 */
.prod-title { font-size: 14px; font-weight: bold; color: #333; margin-bottom: 4px; text-align: center; }
.prod-dim { font-size: 11px; color: #888; margin-bottom: 10px; }

/* [초록색 상세보기 버튼] */
.btn-detail-green {
    padding: 5px 12px;
    background: #22c55e; /* 초록색 */
    color: white;
    font-size: 11px;
    font-weight: bold;
    border-radius: 20px;
    border: none;
    cursor: help; /* 마우스 커서 변경 */
    transition: 0.2s;
}
.btn-detail-green:hover {
    background: #16a34a;
}

/* [이미지 팝업] - 평소엔 숨김 */
.hover-img-popup {
    display: none; /* 기본 숨김 */
    position: absolute;
    bottom: 100%; /* 카드 위쪽으로 뜸 */
    left: 50%;
    transform: translateX(-50%);
    width: 200px; /* 팝업 크기 */
    height: 200px;
    background: white;
    border: 1px solid #ddd;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    border-radius: 12px;
    z-index: 9999;
    padding: 5px;
    margin-bottom: 10px;
}
/* 화살표 모양 만들기 */
.hover-img-popup::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    margin-left: -8px;
    border-width: 8px;
    border-style: solid;
    border-color: white transparent transparent transparent;
}
.hover-img-popup img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    background: #f8fafc;
    border-radius: 8px;
}
/* =========================================
   [1단계] 제품 리스트 & 이미지 팝업 스타일
   ========================================= */
/* 제품 카드 (심플하게 변경) */
.simple-prod-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: #fff;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.2s;
    position: relative; /* 팝업 위치 기준점 */
    min-height: 160px;
}
.simple-prod-card:hover {
    border-color: #6366f1;
    box-shadow: 0 8px 20px rgba(99, 102, 241, 0.15);
    transform: translateY(-3px);
}

/* 아이콘 박스 */
.prod-icon-box {
    width: 50px; height: 50px;
    background: #f1f5f9;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 24px; color: #475569;
    margin-bottom: 10px;
}

/* 텍스트 정보 */
.prod-title { font-size: 15px; font-weight: bold; color: #333; margin-bottom: 5px; text-align: center; }
.prod-desc { font-size: 12px; color: #888; margin-bottom: 12px; text-align: center; }
.prod-price { font-size: 14px; font-weight: 800; color: #6366f1; margin-bottom: 10px; }

/* [초록색 상세보기 버튼] */
.btn-detail-green {
    padding: 6px 14px;
    background: #22c55e; /* 초록색 */
    color: white;
    font-size: 12px; font-weight: bold;
    border-radius: 20px; border: none;
    cursor: help; /* 물음표 커서 */
    transition: 0.2s;
    display: flex; align-items: center; gap: 5px;
}
.btn-detail-green:hover { background: #16a34a; }

/* [이미지 팝업] - 평소엔 안 보임 */
.hover-img-popup {
    display: none; /* 숨김 */
    position: absolute;
    bottom: 80%; /* 카드 위쪽으로 뜸 */
    left: 50%;
    transform: translateX(-50%);
    width: 220px; /* 팝업 크기 (크게) */
    height: 220px;
    background: white;
    border: 2px solid #6366f1;
    box-shadow: 0 15px 30px rgba(0,0,0,0.3);
    border-radius: 12px;
    z-index: 9999;
    padding: 5px;
}
.hover-img-popup img {
    width: 100%; height: 100%;
    object-fit: contain;
    border-radius: 8px;
    background: #f8fafc;
}
/* [장바구니 옵션 박스 스타일] */
.cart-opt-box {
    background: #fff;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 15px;
    margin-top: 10px;
    position: relative;
}
/* 필수 항목 강조 테두리 (선택 안했을 때 빨갛게 변하게 할 수도 있음) */
.cart-opt-box.required {
    border-left: 4px solid #6366f1; /* 왼쪽에 보라색 포인트 */
}
.cart-opt-box.optional {
    border-left: 4px solid #94a3b8; /* 회색 포인트 */
}

.opt-box-title {
    font-size: 13px;
    font-weight: 800;
    color: #334155;
    margin-bottom: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.badge-req {
    font-size: 10px;
    background: #fee2e2;
    color: #ef4444;
    padding: 2px 6px;
    border-radius: 4px;
    font-weight: bold;
}
.badge-opt {
    font-size: 10px;
    background: #f1f5f9;
    color: #64748b;
    padding: 2px 6px;
    border-radius: 4px;
}
/* [장바구니 옵션 박스 스타일] */
.cart-opt-box {
    background: #fff;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 15px;
    margin-top: 10px;
    position: relative;
}
/* 필수 항목 강조 (왼쪽에 색상 띠) */
.cart-opt-box.required { border-left: 4px solid #6366f1; }
.cart-opt-box.optional { border-left: 4px solid #94a3b8; }

.opt-box-title {
    font-size: 13px; font-weight: 800; color: #334155;
    margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;
}
.badge-req { font-size: 10px; background: #fee2e2; color: #ef4444; padding: 2px 6px; border-radius: 4px; }
.badge-opt { font-size: 10px; background: #f1f5f9; color: #64748b; padding: 2px 6px; border-radius: 4px; }
/* [장바구니 3단 박스 디자인] */
.cart-opt-group {
    background: #fff;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 15px;
    margin-top: 12px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}
/* 필수 항목은 왼쪽에 보라색 띠 */
.cart-opt-group.required-group { border-left: 4px solid #6366f1; }
/* 선택 항목은 왼쪽에 회색 띠 */
.cart-opt-group.optional-group { border-left: 4px solid #94a3b8; }

.opt-group-header {
    font-size: 13px; font-weight: 800; color: #334155;
    margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between;
}
.badge-req { background: #fee2e2; color: #ef4444; font-size: 11px; padding: 2px 6px; border-radius: 4px; }
.badge-sel { background: #f1f5f9; color: #64748b; font-size: 11px; padding: 2px 6px; border-radius: 4px; }

/* 옵션 선택창 스타일 */
.opt-select-box {
    width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 13px;
    background-color: #fff;
}
.opt-checkbox-grid {
    display: grid; grid-template-columns: 1fr 1fr; gap: 8px;
}
.opt-checkbox-label {
    display: flex; align-items: center; font-size: 12px; cursor: pointer;
    padding: 8px; border: 1px solid #eee; border-radius: 6px; background: #fff;
}
.opt-checkbox-label:hover { border-color: #6366f1; }
/* [달력 스타일] */
.calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr); /* 7열 (일~토) */
    gap: 5px;
    margin-top: 10px;
}
.cal-day-header {
    text-align: center; font-weight: bold; font-size: 12px; color: #64748b; padding-bottom: 5px;
}
.cal-day {
    aspect-ratio: 1/1; /* 정사각형 */
    display: flex; align-items: center; justify-content: center;
    border-radius: 50%;
    cursor: pointer;
    font-size: 13px;
    transition: 0.2s;
}
.cal-day:hover:not(.disabled) { background: #eff6ff; color: #6366f1; }
.cal-day.selected { background: #6366f1; color: white !important; font-weight: bold; box-shadow: 0 2px 5px rgba(99,102,241,0.4); }
.cal-day.disabled { color: #cbd5e1; cursor: not-allowed; }
</style>
</head>

<body>
<div id="loading"><div class="loading-spin"></div><p style="margin-top:15px; font-weight:600;">로딩 중입니다...</p></div>

<div id="contextMenu">
    <div class="ctx-item" id="ctxUndo"><i class="fa-solid fa-rotate-left"></i> 실행 취소</div>
    <div class="ctx-item" id="ctxRedo"><i class="fa-solid fa-rotate-right"></i> 다시 실행</div>
    <div class="ctx-divider"></div>
    <div class="ctx-item" id="ctxCopy"><i class="fa-regular fa-copy"></i> 복사하기</div>
    <div class="ctx-item" id="ctxPaste"><i class="fa-regular fa-paste"></i> 붙여넣기</div>
    <div class="ctx-item" id="ctxDelete" style="color:#ef4444;"><i class="fa-solid fa-trash"></i> 삭제하기</div>
    <div class="ctx-divider"></div>
    <div class="ctx-item" id="ctxFront"><i class="fa-solid fa-arrow-up-from-bracket"></i> 맨 앞으로</div>
    <div class="ctx-item" id="ctxBack"><i class="fa-solid fa-arrow-down-from-bracket"></i> 맨 뒤로</div>
    <div class="ctx-divider"></div>
    <div class="ctx-item" id="ctxLock"><i class="fa-solid fa-lock"></i> 잠금 (Lock)</div>
</div>

<div id="startScreen">
    <div class="hero-section">
        <h1 class="hero-title">행사 준비하세요? <br><span>카멜레온</span>과 함께해요.</h1>
        <p class="hero-desc">행사 팝업스토어 기획자를 위한 도매쇼핑몰, 유저가 함께 만드는 무료에디터</p>
    </div>

    <div class="quick-menu-wrapper">
        <div class="quick-menu-label">맞춤형 디자인 시작하기</div>
        <div class="quick-menu-track" id="quickMenuContainer">
            </div>
    </div>
    
    <div class="gallery-section">
        <div class="gallery-header">함께 만드는 무료 에디터 - 카프</div>
        <div id="startTemplateGrid" class="template-grid-start"></div>
    </div>
    <div class="footer-wrap">
        <div class="footer-inner">
            <div class="foot-left">
                <div class="foot-menu">
                    <ul>
                        <li><a href="#">회사소개</a></li>
                        <li><a href="#">공지사항</a></li>
                        <li><a href="#">이용약관</a></li>
                        <li><a href="#"><strong>개인정보처리방침</strong></a></li>
                    </ul>
                </div>
                <div class="foot-info">
                    <dl>
                        <dt>상호명 :</dt><dd>(주)카멜레온프린팅</dd>
                        <dt>대표 :</dt><dd>조재호</dd>
                    </dl>
                    <dl>
                        <dt>주소 :</dt><dd>경기도 화성시 우정읍 한말길 72-2</dd>
                    </dl>
                    <dl>
                        <dt>사업자등록번호 :</dt><dd>470-81-02808</dd>
                        <dt>통신판매업신고번호 :</dt><dd>2025-화성우정-0033</dd>
                    </dl>
                    <dl>
                        <dt>개인정보관리자 :</dt><dd>변지웅</dd>
                    </dl>
                    <p class="copyright">Copyright © <strong>Chameleon Canvas</strong>. all rights reserved.</p>
                </div>
            </div>

            <div class="cs-center">
                <h3>고객센터 (CS CENTER)</h3>
                <strong>031-366-1984</strong>
                <p>
                    평일 09:00 ~ 18:00 <br>
                    점심 12:00 ~ 13:00 <br>
                    <span>* 주말 및 공휴일 휴무</span>
                </p>
            </div>
        </div>
    </div>
    </div>
</div>

<div id="mainEditor">
    <div class="topbar">
    <div class="brand" onclick="location.reload()"><i class="fa-solid fa-palette"></i> Chameleon</div>
    
    <div class="template-tabs">
        <button id="btnMobileTemplateOpen" onclick="document.getElementById('templateOverlay').style.display='flex'">🎨 템플릿</button>
        <button class="tpl-tab" data-tpl="vector">배경</button>
        <button class="tpl-tab" data-tpl="graphic">백터</button>
        <button class="tpl-tab" data-tpl="photo-bg">사진</button>
        <button class="tpl-tab" data-tpl="transparent-graphic">패턴</button>
        <button class="tpl-tab" data-tpl="logo">로고</button>
    </div>
    
    <div style="flex:1;"></div>

    <button class="btn" id="btnViewCart" onclick="document.getElementById('cartPage').style.display='block'" style="margin-right:5px; background:white; border:1px solid #ddd; color:#333; padding:8px 12px;">
        🛒 <span class="pc-only">장바구니</span>
    </button>

    <button class="btn primary" id="btnOrderTop" onclick="window.addToCartAndGo()" style="background:var(--primary); color:white; font-weight:bold; box-shadow:0 4px 12px rgba(99,102,241,0.4);">
        🚀 주문하기
    </button>
    
    <button class="btn" id="btnLoginBtn" style="margin-left:5px;">로그인</button>
</div>

    <div id="wallHeightControls">
        <div class="wall-label"><i class="fa-solid fa-ruler-vertical"></i> 가벽 높이선택</div>
        <button class="height-btn active" onclick="window.setWallHeight(2200, this)">220cm</button>
        <button class="height-btn" onclick="window.setWallHeight(2400, this)">240cm</button>
        <button class="height-btn" onclick="window.setWallHeight(3000, this)">300cm</button>
    </div>
    <div id="logoUploadModal" class="modal-bg">
    <div class="modal-box" style="width: 400px;">
        <h3 style="margin-top:0;">☁️ 로고 업로드</h3>
        <p style="color:#666; font-size:13px; margin-bottom:20px;">배경이 투명한 PNG 파일을 권장합니다.</p>
        
        <div class="upload-drop-zone" id="dropZone" onclick="document.getElementById('logoFileInput').click()">
            <i class="fa-solid fa-cloud-arrow-up upload-icon"></i>
            <span class="upload-text">클릭하여 파일 선택</span>
            <span class="upload-sub">또는 파일을 여기로 드래그하세요</span>
            
            <img id="previewImage">
            <div id="removeFileBtn" onclick="window.resetUpload(event)">✕</div>
        </div>

        <input type="file" id="logoFileInput" accept="image/png, image/jpeg, image/svg+xml" style="display:none;" onchange="window.handleFileSelect(this)">
        
        <div style="text-align:left; font-size:13px; font-weight:700; color:#333; margin-bottom:5px;">검색 태그</div>
        <input type="text" id="logoKeywordInput" class="ai-input-pretty" placeholder="예: 삼성, 로고, 심플 (쉼표로 구분)">
        
        <div style="display:flex; gap:10px; margin-top:10px;">
            <button onclick="window.uploadUserLogo()" class="btn-round primary" style="flex:2;">업로드하기</button>
            <button onclick="document.getElementById('logoUploadModal').style.display='none'" class="btn-round" style="flex:1;">취소</button>
        </div>
    </div>
</div>


    <div class="editor-wrap">
        <div class="side" id="toolsPanel">
            <div style="display:flex; gap:5px; margin-bottom:10px;">
                <button id="btnRotateCanvas" class="btn-round" style="flex:1;"><i class="fa-solid fa-rotate"></i> 캔버스 회전</button>
            </div>
            <div id="sizeTogglePanel" style="display:none; grid-template-columns: 1fr; gap:5px; margin-bottom:15px; padding:10px; background:#f8fafc; border-radius:10px; border:1px solid #e2e8f0;"></div>
            
            <div class="section-title">CANVAS TOOLS</div>
            <div style="display:flex; gap:5px; margin-bottom:10px;">
                <button id="btnFitScreen" class="btn-round" title="화면에 맞추기"><i class="fa-solid fa-compress"></i> 화면 맞춤</button>
                <button id="btnLockSelection" class="btn-round" onclick="window.toggleLockSelection()"><i class="fa-solid fa-lock"></i> 선택 잠금</button>
            </div>

            <div class="section-title">AI TOOLS</div>
            <button class="btn-round ai-red" id="btnAIBox"><i class="fa-solid fa-wand-magic-sparkles"></i> AI 이미지 생성</button>
            <button class="btn-round primary" id="btnRegisterTemplate" style="margin-top:5px; display:none;">👑 디자인 등록</button>
            <button class="btn-round" id="btnOpenSaveModal" style="margin-top:5px;">💾 디자인 저장</button>
            <button class="btn-round" onclick="document.getElementById('logoUploadModal').style.display='flex'" style="margin-top: 5px; margin-bottom: 20px; width: 100%; justify-content: center; background: #f8fafc; border: 1px solid #6366f1; color: #6366f1; font-weight: 800; flex-direction: column; height: auto; padding: 15px; gap: 5px;">
    <span style="font-size: 15px;"><i class="fa-solid fa-cloud-arrow-up"></i> 유저 로고 공유방</span>
    <span style="font-size: 11px; font-weight: normal; color: #64748b;">(배경없는 로고 3개 등록하면 등업)</span>
</button>
            
            <div class="section-title">BASIC TOOLS</div>
            <button class="btn-round" id="btnAddText">+ 텍스트 추가</button>
            <button class="btn-round" id="btnFontSelect" style="margin-top:5px;">🅰️ 폰트 변경</button>
            <div class="color-group"><span>면 색상</span><input id="fillColor" type="color" class="color-picker" value="#000000"></div>
            <div class="color-group" style="margin-top:5px;"><span>선 색상</span><input id="strokeColor" type="color" class="color-picker" value="#000000"></div>
            
            <div class="section-title">SHAPES</div>
            <div class="shape-panel">
                <button class="shape-btn" data-shape="rect">■</button>
                <button class="shape-btn" data-shape="circle">●</button>
                <button class="shape-btn" data-shape="triangle">▲</button>
                <button class="shape-btn" data-shape="star">★</button>
                <button class="shape-btn" data-shape="heart">♥</button>
                <button class="shape-btn" data-shape="arrow">➡</button>
                <button class="shape-btn" data-shape="round">▢</button>
                <button class="shape-btn" data-shape="line">━</button>
            </div>
            
            <div class="section-title">UPLOAD</div>
            <label class="upload-box" for="imgUpload"><span style="font-size:24px; margin-bottom:5px;"><i class="fa-solid fa-cloud-arrow-up"></i></span>이미지 / PDF 업로드</label>
            <input id="imgUpload" type="file" accept="image/*,.svg,.pdf" style="display:none;">
        </div>
        
        <div class="stage" id="stage">
            <div class="bottom-dock">
                <button id="btnZoomOut" class="zoom-btn"><i class="fa-solid fa-minus"></i></button>
                <button id="btnZoomIn" class="zoom-btn"><i class="fa-solid fa-plus"></i></button>
                <div class="divider"></div>
                <button id="guideToggle" class="zoom-btn" style="width:auto; padding:0 15px; border-radius:20px; font-size:12px;">가이드 켜기</button>
                <span class="help-text">Space: 화면이동 / 휠: 크기조절 / 방향키: 미세이동</span>
            </div>
            
            <div class="right-stack" id="rightStackPanel">
                <div class="panel-box" id="panelEdit">
                    <div class="section-title" style="margin-top:0;">편집 & 레이어</div>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px; margin-bottom:5px;">
                        <button class="tool-btn" id="btnUndo"><i class="fa-solid fa-rotate-left"></i> 실행취소</button>
                        <button class="tool-btn" id="btnRedo"><i class="fa-solid fa-rotate-right"></i> 다시실행</button>
                        <button class="tool-btn" id="btnCopy"><i class="fa-regular fa-copy"></i> 복사</button>
                        <button class="tool-btn" id="btnPaste"><i class="fa-regular fa-paste"></i> 붙여넣기</button>
                    </div>
                    
                    <div style="display:flex; gap:5px; margin-bottom:5px;">
                        <button class="tool-btn" id="btnRotateLeft15"><i class="fa-solid fa-rotate-left"></i> -15°</button>
                        <button class="tool-btn" id="btnRotateRight15"><i class="fa-solid fa-rotate-right"></i> +15°</button>
                    </div>

                    <div style="display:flex; gap:5px; margin-bottom:5px;">
                        <button class="tool-btn" id="btnFront">맨앞</button>
                        <button class="tool-btn" id="btnBack">맨뒤</button>
                        <button class="tool-btn" id="btnDel" style="color:red;">삭제</button>
                    </div>
                    
                    <div class="section-title" style="margin-top:10px;">객체 정렬</div>
                    <div class="align-grid">
                        <button class="align-btn" id="btnAlignLeft"><i class="fa-solid fa-align-left"></i></button>
                        <button class="align-btn" id="btnAlignCenterH"><i class="fa-solid fa-arrows-left-right-to-line"></i></button>
                        <button class="align-btn" id="btnAlignRight"><i class="fa-solid fa-align-right"></i></button>
                        <button class="align-btn" id="btnAlignTop"><i class="fa-solid fa-align-left" style="transform:rotate(90deg)"></i></button>
                        <button class="align-btn" id="btnAlignMiddle"><i class="fa-solid fa-arrows-up-down-left-right"></i></button>
                        <button class="align-btn" id="btnAlignBottom"><i class="fa-solid fa-align-right" style="transform:rotate(90deg)"></i></button>
                    </div>
                    <button class="btn-round" id="btnCenterObject" onclick="window.alignObject('center')" style="margin-top:5px;">🎯 정중앙 정렬</button>
                    <button class="btn-round" onclick="window.setAsBackground()" style="margin-top:5px;">🖼 배경으로 꽉 채우기</button>
                </div>
                        <button id="btn-create-outline" style="padding: 10px; cursor: pointer;">✂️ 칼선/외곽선 만들기</button>
                <div class="panel-box" id="panelText">
                    <div class="section-title" style="margin-top:0;">텍스트 설정</div>
                    <div style="display:flex; gap:5px; margin-bottom:10px;">
                        <button class="tool-btn" id="btnAlignLeftText"><i class="fa-solid fa-align-left"></i></button>
                        <button class="tool-btn" id="btnAlignCenterText"><i class="fa-solid fa-align-center"></i></button>
                        <button class="tool-btn" id="btnAlignRightText"><i class="fa-solid fa-align-right"></i></button>
                    </div>
                    <div style="display:grid; grid-template-columns: 35px 1fr; gap:10px; align-items:center; margin-bottom:5px;">
                        <span style="font-size:12px; color:#666;">크기</span><input type="range" id="textSize" min="10" max="200" value="50" style="width:100%;">
                    </div>
                    <div style="display:grid; grid-template-columns: 35px 1fr; gap:10px; align-items:center; margin-bottom:5px;">
                        <span style="font-size:12px; color:#666;">자간</span><input type="range" id="textCharSpacing" min="-100" max="500" value="50" style="width:100%;">
                    </div>
                    <div style="display:grid; grid-template-columns: 35px 1fr; gap:10px; align-items:center;">
                        <span style="font-size:12px; color:#666;">행간</span><input type="range" id="textLineHeight" min="0.5" max="3.0" step="0.1" value="1.2" style="width:100%;">
                    </div>
                </div>
                
                <div class="panel-box">
                    <div class="section-title" style="margin-top:0; color:#333;">AI 이미지 도구</div>
                    <div class="ai-tool-stack">
                        <button class="tool-btn" id="btnCutout">✂️ 배경 제거</button>
                        <button class="tool-btn" id="btnEnhance">✨ 밝게 보정</button>
                        <button class="tool-btn" id="btnOutline">🔲 글자 테두리</button>
                    </div>
                    <div class="section-title">선 설정</div>
                    <input type="range" id="globalStroke" min="0" max="30" value="2" style="width:100%;">
                    
                    <div style="display:flex; gap:5px; margin-top:5px;">
                        <button class="tool-btn" id="btnStrokeMiter" title="각지게"><i class="fa-solid fa-square"></i> 각지게</button>
                        <button class="tool-btn" id="btnStrokeRound" title="부드럽게"><i class="fa-solid fa-circle"></i> 둥글게</button>
                    </div>

                    <div class="section-title">투명도</div><input type="range" id="opacitySlider" min="0" max="100" value="100" style="width:100%;">
                </div>
            </div>
            <canvas id="designCanvas"></canvas>
        </div>
    </div>
</div>
<div id="mobileTextEditor" style="display:none;">
    <div class="m-text-header">
        <span style="color:#6366f1; font-weight:bold;"><i class="fa-solid fa-pen"></i> 텍스트 수정</span>
        
        <div style="display:flex; gap:5px;">
            <button onclick="window.deleteMobileObject()" style="background:#ef4444; color:white; border:none; padding:6px 12px; border-radius:6px; font-weight:bold; font-size:13px;">
                <i class="fa-solid fa-trash"></i> 삭제
            </button>
            
            <button onclick="window.closeMobileTextEditor()" style="background:#6366f1; color:white; border:none; padding:6px 12px; border-radius:6px; font-weight:bold; font-size:13px;">
                완료
            </button>
        </div>
    </div>
    <textarea id="mobileTextInput" placeholder="여기에 내용을 입력하세요..."></textarea>
</div>
<div id="templateActionModal" class="modal-bg" style="z-index: 20000;">
    <div class="modal-box" style="width: 500px; max-width: 90%;">
        <h3 style="margin-top:0; font-size: 20px;">🎨 템플릿 불러오기</h3>
        <p style="color:#666; font-size:15px; margin-bottom:30px; line-height: 1.5;">
            현재 작업 중인 디자인이 있습니다.<br>
            선택한 템플릿을 어떻게 적용하시겠습니까?
        </p>
        
        <div style="display:flex; gap:15px;">
            <button id="btnActionAdd" class="btn-round" style="flex:1; height:120px; flex-direction:column; justify-content:center; gap:10px; background:#f1f5f9; border:1px solid #cbd5e1; color:#334155;">
                <i class="fa-solid fa-layer-group" style="font-size:32px; color:#6366f1;"></i>
                <span style="font-size:16px; font-weight:bold;">현재 작업에 추가</span>
                <span style="font-size:12px; font-weight:normal; opacity:0.8;">기존 디자인 위에 겹치기</span>
            </button>

            <button id="btnActionReplace" class="btn-round ai-red" style="flex:1; height:120px; flex-direction:column; justify-content:center; gap:10px; border:none;">
                <i class="fa-solid fa-file-circle-check" style="font-size:32px;"></i>
                <span style="font-size:16px; font-weight:bold;">새 작업 시작</span>
                <span style="font-size:12px; font-weight:normal; opacity:0.8;">기존 내용 지우고 덮어쓰기</span>
            </button>
        </div>

        <button onclick="document.getElementById('templateActionModal').style.display='none'" class="btn-round" style="margin-top:20px; border:none; color:#999;">
            취소하고 돌아가기
        </button>
    </div>
</div>
<div id="sizeSelectModal" class="modal-bg" style="z-index: 15000;">
    <div class="modal-box" style="width: 800px; max-width: 95%;">
        <h3>📏 어떤 크기로 만드시겠습니까?</h3>
        <p style="margin-bottom:20px; color:#666;">선택한 제품 크기에 맞춰 템플릿이 자동으로 조절됩니다.</p>
        
        <div id="productSelectGrid" class="quick-menu-track" style="grid-template-columns: repeat(4, 1fr);"></div>
        
        <button onclick="document.getElementById('sizeSelectModal').style.display='none'" class="btn-round" style="margin-top:20px;">취소</button>
    </div>
</div>
<div id="aiDrawer" class="ai-drawer"><h3>✨ AI 이미지 생성</h3><p class="label">설명 (Prompt)</p><textarea id="aiPrompt" class="ai-input-pretty" placeholder="예: 숲속에 앉아있는 귀여운 갈색 토끼" style="height:100px;"></textarea><button id="aiGenerateBtn" class="btn-round primary" style="margin-top:10px;">생성하기</button><div id="aiResultArea" style="min-height:200px; background:#f9f9f9; margin-top:20px; display:flex; justify-content:center; align-items:center;"><span style="color:#ccc;">결과 대기 중</span></div><button id="aiUseBtn" class="btn-round" style="display:none; margin-top:10px;">캔버스에 넣기</button><button onclick="document.getElementById('aiDrawer').classList.remove('open')" class="btn-round" style="margin-top:10px;">닫기</button></div>
<div id="templateOverlay">
    <div class="tpl-modal-box">
        <div class="tpl-sidebar">
    <button class="tpl-cate-btn active" onclick="window.filterTpl('vector', this)"><span>배경</span></button>
    <button class="tpl-cate-btn" onclick="window.filterTpl('photo-bg', this)"><span>사진</span></button>
    <button class="tpl-cate-btn" onclick="window.filterTpl('graphic', this)"><span>백터</span></button>
    <button class="tpl-cate-btn" onclick="window.filterTpl('transparent-graphic', this)"><span>패턴</span></button>
    <button class="tpl-cate-btn" onclick="window.filterTpl('logo', this)"><span>로고</span></button>
</div>
        <div class="tpl-content">
            <div style="padding: 20px 30px; border-bottom: 1px solid #f1f5f9; display: flex; align-items: center; justify-content: space-between;">
                <h2 style="margin:0;">검색</h2>
                <input type="text" id="tplSearchInput" class="ai-input-pretty" style="width:300px; margin-bottom:0;" placeholder="검색어 입력...">
                <button onclick="document.getElementById('templateOverlay').style.display='none'" style="border:none; background:none; cursor:pointer;">
                    <i class="fa-solid fa-xmark fa-2x"></i>
                </button>
            </div>
            <div id="tplGrid" class="tpl-grid"></div>
            <div style="padding:15px; text-align:right; border-top:1px solid #eee;">
                <button id="btnUseTpl" class="btn primary">선택한 템플릿 적용</button>
            </div> 
        </div>
    </div>
</div>
<div id="libraryModal" class="modal-bg" style="z-index: 11000;"><div class="modal-box" style="width: 800px; max-width: 90%; height: 80%; display: flex; flex-direction: column;"><div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;"><h3 style="margin:0;">📂 내 디자인 보관함</h3><button onclick="document.getElementById('libraryModal').style.display='none'" style="border:none; background:none; cursor:pointer; font-size:20px;">✕</button></div><div id="myDesignGrid" style="flex:1; overflow-y:auto; display:grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap:20px; padding:10px;"></div></div></div>
<div id="saveDesignModal" class="modal-bg" style="z-index: 11001;"><div class="modal-box"><h3>💾 디자인 저장하기</h3><p style="font-size:13px; color:#666;">보관함에 저장하여 나중에 다시 불러올 수 있습니다.</p><input id="saveDesignTitle" class="ai-input-pretty" placeholder="디자인 제목을 입력하세요 (예: 여름 이벤트 배너)"><div style="display:flex; gap:10px; margin-top:20px;"><button id="btnConfirmSave" class="btn-round primary">저장하기</button><button onclick="document.getElementById('saveDesignModal').style.display='none'" class="btn-round">취소</button></div></div></div>
<div id="loadModeModal" class="modal-bg" style="z-index: 10001;"><div class="modal-box" style="width: 450px;"><h3>🎨 템플릿 불러오기</h3><p style="color:#666; font-size:14px; margin-bottom:20px;">현재 캔버스 내용이 있습니다.</p><div style="display:flex; gap:10px;"><button id="btnLoadReplace" class="btn-round ai-red" style="height:100px;">새 작업으로<br>(기존 삭제)</button><button id="btnLoadAdd" class="btn-round primary" style="height:100px;">현재 작업에<br>추가하기</button></div><button onclick="document.getElementById('loadModeModal').style.display='none'" class="btn-round" style="margin-top:15px;">취소</button></div></div>
<div id="loginModal" class="modal-bg" style="z-index: 10002;"><div class="modal-box" style="width: 400px;"><h3 id="authTitle" style="margin-top:0;">로그인</h3><div style="display:flex; flex-direction:column; gap:10px; margin-bottom:15px;"><input id="loginId" class="ai-input-pretty" placeholder="이메일 주소" style="margin:0;"><input id="loginPw" class="ai-input-pretty" type="password" placeholder="비밀번호" style="margin:0;"><input id="loginPwConfirm" class="ai-input-pretty" type="password" placeholder="비밀번호 확인" style="margin:0; display:none;"></div><button class="btn-round primary" id="btnAuthAction" style="width:100%; justify-content:center; height:45px; font-size:15px;">로그인</button><div style="margin-top:15px; font-size:13px; color:#666;"><span id="authSwitchText">계정이 없으신가요?</span><span id="btnSwitchAuthMode" style="color:var(--primary); font-weight:bold; cursor:pointer; margin-left:5px; text-decoration:underline;">회원가입</span></div><hr style="margin:20px 0; border:0; border-top:1px solid #eee;"><div style="display:flex; flex-direction:column; gap:8px;"><button id="btnGoogleLogin" class="btn-round" style="border-color:#ddd; justify-content:center;"><i class="fa-brands fa-google" style="color:#DB4437; margin-right:8px;"></i> Google로 시작하기</button><button id="btnKakaoLogin" class="btn-round" style="border-color:#FEE500; background:#FEE500; color:#3C1E1E; justify-content:center;"><i class="fa-solid fa-comment" style="margin-right:8px;"></i> 카카오로 시작하기</button></div><button onclick="document.getElementById('loginModal').style.display='none'" class="btn-round" style="margin-top:15px; border:none; color:#888; width:100%;">닫기</button></div></div>
<div id="productDetailModal" class="modal-bg" style="z-index: 11000;"><div class="modal-box" style="width: 900px; max-width: 95%; display: flex; text-align: left; padding:0; overflow:hidden;"><div style="width: 45%; background: #f8fafc; display: flex; align-items: center; justify-content: center; padding: 20px;"><img id="pdpImage" src="" style="max-width: 100%; max-height: 300px; object-fit: contain;"></div><div style="width: 55%; padding: 40px; display: flex; flex-direction: column;"><h2 id="pdpTitle" style="margin: 0 0 10px 0;">상품명</h2><h3 id="pdpPrice" style="color: var(--primary); margin: 0 0 20px 0;">0원</h3><button id="btnActionDesign" class="btn-round primary" style="height: 50px;">🎨 직접 디자인하기</button><div style="margin-top:10px;"><input type="file" id="pdpFileUpload" style="display: none;"><button onclick="document.getElementById('pdpFileUpload').click()" class="btn-round">📂 파일 업로드 주문</button></div><button onclick="document.getElementById('productDetailModal').style.display='none'" style="margin-top: auto; border:none; background:none; cursor:pointer;">닫기</button></div></div></div>
<div id="cartPage" style="display:none; position:fixed; inset:0; background:#f1f5f9; z-index: 12000; overflow-y:auto; padding-top: 40px;">
    <div style="max-width: 1000px; margin: 0 auto; padding-bottom: 60px;">
        <div style="display:flex; justify-content:space-between; align-items:center; padding:0 20px;">
            <h1>🛒 장바구니 <span id="cartCount">(0)</span></h1>
            <button onclick="document.getElementById('cartPage').style.display='none'" class="btn-round" style="width:auto;">닫기</button>
        </div>

        <div style="display: flex; flex-direction: column; gap: 20px; padding: 0 20px;">
            
            <div id="cartListArea" style="width: 100%;"></div>
            
            <div style="width: 100%;">
                <div style="background:white; padding:20px; border-radius:12px;">
                    <h3>결제 금액</h3>
                    <div style="display:flex; justify-content:space-between;"><span>상품</span><span id="summaryItemPrice">0원</span></div>
                    <div style="display:flex; justify-content:space-between;"><span>옵션</span><span id="summaryAddonPrice">0원</span></div>
                    <hr>
                    <div style="display:flex; justify-content:space-between; font-weight:bold; font-size:20px;"><span>합계</span><span id="summaryTotal">0원</span></div>
                    <button id="btnGoCheckout" class="btn-round primary" style="margin-top:20px; width:100%;">💳 결제하기</button>
                    <button id="btnPrintQuote" class="btn-round btn-secondary" style="margin-top:10px; width:100%;"><i class="fa-solid fa-file-invoice"></i> 견적서 출력</button>
                </div>
            </div>

        </div>
    </div>
</div>
<div id="calendarModal" class="modal-bg" style="z-index: 12500;"><div class="modal-box"><h3>📅 배송요청 [제작기간 3일]</h3><div style="display:flex; justify-content:space-between; margin-bottom:10px;"><button id="btnPrevMonth" class="btn-round" style="width:30px;">&lt;</button><span id="currentMonthYear" style="font-weight:bold;"></span><button id="btnNextMonth" class="btn-round" style="width:30px;">&gt;</button></div><div id="calendarGrid" class="calendar-grid"></div><button onclick="document.getElementById('calendarModal').style.display='none'" class="btn-round" style="margin-top:15px;">닫기</button></div></div>
<div id="deliveryInfoModal" class="modal-bg" style="z-index: 12600;"><div class="modal-box" style="text-align:left;"><h3 style="text-align:center;">📝 배송 정보 입력</h3><p>담당자명</p><input id="inputManagerName" class="ai-input-pretty"><p>연락처</p><input id="inputManagerPhone" class="ai-input-pretty"><p>주소</p><input id="inputAddress" class="ai-input-pretty"><p>요청사항</p><textarea id="inputRequest" class="ai-input-pretty"></textarea><button id="btnSubmitOrderInfo" class="btn-round primary" style="margin-top:10px;">주문서 생성 및 결제</button><button onclick="document.getElementById('deliveryInfoModal').style.display='none'" class="btn-round" style="margin-top:5px;">취소</button></div></div>
<div id="checkoutModal" class="modal-bg" style="z-index: 13000;"><div class="modal-box" style="text-align:left;"><h3 style="text-align:center;">확인</h3><input id="orderName" class="ai-input-pretty" readonly><input id="orderPhone" class="ai-input-pretty" readonly><input id="orderAddr" class="ai-input-pretty" readonly><textarea id="orderMemo" class="ai-input-pretty" readonly></textarea><button id="btnRealPayment" class="btn-round primary">최종 결제</button><button onclick="document.getElementById('checkoutModal').style.display='none'" class="btn-round" style="margin-top:5px;">취소</button></div></div>
<div id="successModal" class="modal-bg" style="z-index: 14000;"><div class="modal-box"><h2>🎉 주문 완료!</h2><button id="btnDownOrderSheet" class="btn-round">📄 작업지시서 다운로드</button><button id="btnDownQuotation" class="btn-round" style="margin-top:5px;">📑 견적서 다운로드</button><button onclick="window.closeSuccessModal()" class="btn-round primary" style="margin-top:15px;">확인</button></div></div>
<div id="sellModal" class="modal-bg" style="z-index: 10002;"><div class="modal-box"><h3>💎 디자인 등록</h3><input id="sellKw" class="ai-input-pretty" placeholder="#키워드"><button id="btnSellConfirm" class="btn-round primary">등록하기</button><button onclick="document.getElementById('sellModal').style.display='none'" class="btn-round" style="margin-top:5px;">취소</button></div></div>
<div id="fontModal" class="modal-bg" style="z-index: 10002;"><div class="modal-box"><h3>폰트 선택</h3><div id="fontList" style="max-height:300px; overflow-y:auto;"></div><button onclick="document.getElementById('fontModal').style.display='none'" class="btn-round" style="margin-top:10px;">닫기</button></div></div>
<div id="choiceModal" class="modal-bg" style="z-index: 15000;">
    <div class="modal-box" style="width: 900px; max-width: 95%;">
        
        <div class="choice-layout">
            <div class="choice-left">
                <h3 style="margin-top:0;">🎨 작업 방식을 선택해주세요</h3>
                <p style="color:#666; font-size:14px; margin-bottom:30px; line-height:1.5;">
                    선택하신 <span id="choiceProdName" style="color:#6366f1; font-weight:bold;">상품</span>으로 디자인을 시작하거나,<br>
                    이미 완성된 파일이 있다면 바로 주문할 수 있습니다.
                </p>

                <div style="display:flex; gap:15px; margin-bottom:20px;">
                    <button onclick="window.confirmChoice('editor')" class="btn-round primary" style="flex:1; height:120px; flex-direction:column; justify-content:center; gap:10px;">
                        <i class="fa-solid fa-palette" style="font-size:32px;"></i>
                        <span style="font-size:16px;">직접 디자인하기</span>
                        <span style="font-size:12px; font-weight:normal; opacity:0.8;">에디터에서 꾸미기</span>
                    </button>

                    <button onclick="window.confirmChoice('file')" class="btn-round" style="flex:1; height:120px; flex-direction:column; justify-content:center; gap:10px; background:#f1f5f9; color:#334155; border:1px solid #cbd5e1;">
                        <i class="fa-solid fa-cloud-arrow-up" style="font-size:32px;"></i>
                        <span style="font-size:16px;">내 파일로 주문</span>
                        <span style="font-size:12px; font-weight:normal; opacity:0.8;">PDF/이미지 파일 업로드</span>
                    </button>
                </div>

                <input type="file" id="directUploadInput" style="display:none;" accept="image/*,.pdf">
                
                <button onclick="document.getElementById('choiceModal').style.display='none'" class="btn-round" style="margin-top:auto;">닫기</button>
            </div>

            <div class="choice-right">
                <img id="choiceProductImg" src="" alt="상품 이미지">
            </div>
        </div>

    </div>
</div>
<div id="mobileControlDock">
    <button onclick="window.toggleMobilePanel('left')" class="mobile-fab left">
        <i class="fa-solid fa-shapes"></i>
        <span>요소추가</span>
    </button>

    <button onclick="window.toggleMobilePanel('right')" class="mobile-fab right">
        <i class="fa-solid fa-layer-group"></i>
        <span>편집/정렬</span>
    </button>
</div>
<div id="categoryDetailModal" class="modal-bg" style="z-index: 15000;">
    <div class="modal-box" style="width: 800px; max-width: 95%;">
        <h3 id="catModalTitle">📏 사이즈(제품)를 선택해주세요</h3>
        <p style="margin-bottom:20px; color:#666;">원하시는 규격을 선택하시면 디자인이 시작됩니다.</p>
        
        <div id="catProductGrid" class="quick-menu-track" style="grid-template-columns: repeat(4, 1fr);"></div>
        
        <button onclick="document.getElementById('categoryDetailModal').style.display='none'" class="btn-round" style="margin-top:20px;">닫기</button>
    </div>
</div>
<script type="module" src="./config.js"></script>
<script type="module" src="./canvas-core.js"></script>
<script type="module" src="./canvas-size.js"></script>
<script type="module" src="./canvas-guides.js"></script>
<script type="module" src="./canvas-zoom-pan.js"></script>
<script type="module" src="./canvas-objects.js"></script>
<script type="module" src="./canvas-image.js"></script>
<script type="module" src="./canvas-template.js"></script>
<script type="module" src="./canvas-ai.js"></script>
<script type="module" src="./canvas-utils.js"></script>
<script type="module" src="./shortcuts.js"></script>
<script type="module" src="./context-menu.js"></script>
<script type="module" src="./export.js"></script>
<script type="module" src="./order.js"></script>
<script type="module" src="./login.js"></script>
<script type="module" src="./my-design.js"></script>
<script type="module" src="./main.js"></script>

<script type="module">
    import { canvas } from './canvas-core.js';
    import { openProductDetail, startDesignFromProduct } from './order.js';
    import { applySize } from './canvas-size.js';
    import { sb, PRODUCT_DB, cartData, currentUser } from './config.js'; // cartData 추가 import

    window.canvas = canvas;
    window.openProductDetail = openProductDetail;
    window.startDesignFromProduct = startDesignFromProduct;
    window.applySize = applySize;
    
    // 현재 선택된 제품 키 저장
    window.currentProductKey = 'A4';
    let selectedProductForChoice = null; // 선택된 상품 정보 저장용

    // ============================================================
    // [1] 아이콘 매핑 (DB 코드에 맞는 아이콘 설정)
    // ============================================================

    const CATEGORY_ICONS = {
        'honeycomb': 'https://cdn-icons-png.flaticon.com/512/9425/9425781.png',   // 허니콤 (박스/가벽 느낌)
        'fabric': 'https://cdn-icons-png.flaticon.com/512/9069/9069036.png',      // 패브릭 (천/현수막)
        'board': 'https://cdn-icons-png.flaticon.com/512/2665/2665873.png',       // 폼보드 (단단한 판)
        'pet': 'https://cdn-icons-png.flaticon.com/512/2680/2680932.png',         // 배너 (돌돌 말린 것)
        'default': 'https://cdn-icons-png.flaticon.com/512/3159/3159310.png'      // 기본값 (디자인 도구)
    };

    // ============================================================
    // [2] 시작 화면: 카테고리 목록 (4가지 그룹으로 정밀 분류)
    // ============================================================
    // ============================================================
    // [2] 시작 화면: 카테고리 목록 (V3: 귀여운 3D 아이콘 + 정밀 분류)
    // ============================================================
    // ============================================================
    // [2] 시작 화면: 카테고리 목록 (Icons8 귀여운 3D 아이콘 적용)
    // ============================================================
    async function renderQuickMenu() {
        const container = document.getElementById('quickMenuContainer');
        if (!container) return;

        container.innerHTML = '<div style="grid-column:1/-1; text-align:center;">카테고리 로딩 중...</div>';
        
        const { data: categories, error } = await sb.from('admin_categories')
            .select('*')
            .order('sort_order', { ascending: true });

        container.innerHTML = '';

        if (!categories || categories.length === 0) {
            container.innerHTML = '<div style="grid-column:1/-1; text-align:center;">등록된 카테고리가 없습니다.</div>';
            return;
        }

        categories.forEach(cat => {
            const n = cat.name; 
            // 기본값 (연필/도구)
            let iconUrl = 'https://th.bing.com/th/id/OIP.Jj5QUnowN2oCX56cVuo45wHaHa?w=197&h=197&c=7&r=0&o=7&pid=1.7&rm=3'; 

            // ---------------------------------------------------------
            // [그룹 1] 허니콤보드/판넬 (귀여운 나무 간판/보드 느낌)
            // ---------------------------------------------------------
            if (n.includes('허니콤') || n.includes('가벽') || n.includes('등신대') || n.includes('스카시') || n.includes('박스') || n.includes('판넬') || n.includes('테이블')) {
                iconUrl = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAxlBMVEX///8AAADL5VjR7FvO6FnS7VuHh4fOzs6srKzJycnv7+/19fUsLCw1NTWPj48YGBgkJCTI4lfm5uayyU3B2lRBQUG+vr681FHa2tp9jTakuUfz8/OoqKi4uLiysrK3zk/f39+DlDlsbGwfHx91dXVQUFCXl5dYWFhhYWFsei+swkuenp4LCwt9fX0xNxVcaCgbHwwoLRGarkM/RxuRpD9qeC5MViEPEQc7Ozt1hDOLnTwSFAhfbCkiJw84PxhGTx5KVCAZHAvtw7qMAAAUTklEQVR4nO1da1viOhA+0FZFvBUQhFUBFVAEVEQUFFz//586tNCZybVpoZR9HufTrhSSt5nMPZP//tsu5Qvly5P787PTXqZ3envcunu83s9veQ7JUeGq38rI6PjuqpD25Nan/b1zKbqAWpeHaU9xHdrvn2rhLenmIu15xqRC+8wA3nIh/0WM+zem8Jbr+K9tyLJ+88noMe05R6Gro8j4FtT6Z0RO+ViN4vNlMJ/PB8/yT3NpT92ILuSqL/PyNBkV6xXXte2sW6rUh9WnT+Ghg7Rnb0B3MnTvD8NS1rLsBWWXtPiXZbn1Kr+YO78ZryXw5tOKYwXIWLItp/vEPn2SNgQtFToivGrdseXwViCdytc/s4qXAr6nblaxesxCduf0S1dp41DRH2EBJ6VweKtNOaHf21H7JsfB+6m6hvg8cmrv+NXTnfSqTjiA1ZJlDM8jq/6CX75PG41IeY5D3yrR8HmcWvrZ4a3Y6DH45gvxGRWgB5Hoxh2z38oMvvdphP3HQCzij9yljYkhVkk8RWfQgKzhbsrTPQbgKOYC+uSg7u+kDQuJsUNfK058fAuyZ/BT+2kDC4hx5Cda+8wEYQ1+q5U2shXdU4DD9RbQh4h2+G7sRApwVo8tYgjC+m6JU8qir+6aHLokFDa9HdCJVMh8ZTcCkC5i+v4+NUXfNsChS3LGO6MwHgnAapiMsf2oheWFaJbkuYX+H/ilJ+I05Qhq2Qygh8yxSvXisDl5+xp/z1+ePZoNXv8+vU2mtWIl61gMTNSJl6kCbFCAChZdYHMqteFkPJ9llPQ+GFdrdRLIscAbTpVN8yThMpGs4GLl7NKwOf5RQ2Po+W1YspYo7S78NU2ExB984wF64IrNL1NwQPNm3Y/quIPgLykGiNs4ryeWRW3H7VbH7zIEBvTarDg2qsR2agBJTObVZQA6tW9FwN6UxjUHnKjUbFOyCZ9ZS8aqrgfPp0E1CBn00kJIrNEiA5B66RuhlKzvK5zBiN2E1kQ92YDen18W9NwLfzKTlqj5g5P74hSh9aWa6st40hzV6i6lUndhBXxrEaYjatChGPBaULKGs9eHUdd1nIVKt3gLzbd3HLs7fXoRvrekmzQAEjlaFGxKZh/OPGPFdgRgPC1g2sXpWMa3qQhTzF9LrFGrGXDlw7BSCgdHltMqjcYCwrMU4vvoUQxk1qhV+36fLSwwkSXDybJKVd5UONu6NM3j4F0pBNvfclHBBV+27OGcw7htBwODow8b83kZEjFuN15TgHHfS5uJWohk20O2guH8zxYR9mHYaTJL6EOsZTja3mY8hDFnSa3gglxRO27NtsHY0zC5JbTeBIDbSyjCgIPkllDkUZ+utwLwYAtLaJcQFVMct5Xo6Ucw2osbPtW49AqYbvPtLUO8gMGaiS0h9U7KjKPm/z9hQm1fSgqgQ2IEvqbfpxCTNlLzsC2e1s+iycmaIpzb5agFgjDpRcTXubJIl4F6PzZPqw7XANgkcAItX7jd2k4EZdhzlp5rvTYcTauTh4dJczoa1upZz+heI41PWZQY3AWIeyW9hlD4W7VKw+q3zGGdjSfTouvGcZ2ydpa6h30y8GEwVMIAcUM8vWa09DKeDOtuBPfXI6s4ID/B+vYrRk3aOpXVxupg/p3UKsZMa9tMoPWIGzvf7rROEs+19VVYNDR7mnZtK3QxLavGGNtn6eS3TU73SGk+GVVcNUzbcjmf9yilBH5cgD49L7ZmseTFNyhQTyS73QcuuXicEsAL+dQjwRyMq8Na0Que+uQWh82/Qu70PK3y2bJsznHpczZ7ViTg0quieRTmctu677cPcj5dHbT79y3NURlTSrHChFUW53vlhrhd8oVGrn0X/UgX/mxj+8CAMESTaV3rZUG+cH0SC2a6tRdBnezRpWFs7+Kqf2yWQltRP/UK/fJ5pteJZvwe7j/emG3O3t5OHLA8jKOp8oe59k3IYrYOthn0TYb+lC9vFIeC7w92oAhxU1TIXbXvOq3zj6Oj4+Pzhba5zO0Ec/7SL/3SL/3SL/3SL/3SL/3SL/3SL4XSxQFPsgO8+dzV9ZXuZO+fsAfSorwsasgnHg7bQQXA+YE0noZdz1rXqQfcOJI3TGLTf0zHjFMxqJ1njrufbaf4yZT4fiYBkZhj4YP7jO/q0eDbgqVSva4ivqFJQHvwREP88INhRElOa1fOqXu0J07PJ+j1lJflVemxwkPJ57u0iiqEUA4qbyxI8hP30gd2Zy8qEJ4Hn+/LP8eyEdVGTgWNjOQIkcnkK0TaeYm9wZaU/kH1FQHCy30kjGL/wSl3DnJtzNEE6oQUrXUuy+SBc/l42ydAKLdGMDO+3HnYoWD1FjDtutx5N/wDqVMIQiiADWq4QDfmuO8H6uVI/4PbpxCEsA0bqz/Amq02ImzDYMmgXdGuSNMQhIHRCj08QLau1izYeKdB+hD4Or0zziyFIAQAAUKQLKs1DJgSjqiB9jDoD1lo3z0mvl2jIgRIDfa/cRAuy1+SViuREV4wTLoOwpzpg+sRIJSXfooI/7voeOUcwf/WQAhSLNkiKkB4e7agoztuW0gQLoxx4lrER5jHooBE7XTBamNPYEkRUoqPkJhLsfpIFnJmFQQCQrYvZ4IIGa8rOkR/4nvhz0ksb2YRE0TIOs5R9+Kq3tkAooiQKU1LECHX0NdkOZBALYcX8qS3hvzIkYr+wHgMr2FLbx8KUcwop0xB08RAuDVZyg8cpacrappG6LOp6UNJ9OPYANuSQEqdhj8b06YBYzI2Qghjkmrxvv4rSFDQHUWWRrRLg/nHRgh8NiInlExPQ0MkwaBYNi3fArVhpURKV82KVHEbGuRI0vIPYdyBY5GGMWbBcpiEyc5NycfPw6HLqpW1RgjRKPYBY5hs3JTiNHj+uW4zh6NPTfgU4mMmVkJKsTZQ9zP/QDLpMmFioEJM0+Q8YzrxUlSGzWWjRbIVDaKQ8BZNbIRIMe9HMeZNfKAIMW+02FYdZMgB4o/wSUd4VJW3QHctkbwFLiE2U8MTtqE6DrokHT8+Xl7tH+pVRiq5J8wZQ68x0hD0NgyhkJI9vjlR+/tp5A/RMxxj7woiT8Pii/Jjhud7cudk/RzwH8nn2tgS2bqkFRfpiMKfkuZIxTUL6kuEawp5fOSKMe1dQZpualVpWxyOTk347vZrMQiPVdi2m+Bl6Iyx0Ov8jngmj1xPc7tePQ1pFzfhet9i0xCluy+tb+LpOBf+nQ9lTZSi5InWROnw0TV45psAuXBmWqVMSQ8RLd2wk9xqXRuJsA354/2k80tD+uWG8XnP09Q6NBOp9CR2OXKhgbHUdxcADou1YfPhi+9i6FNaN6MRLpN0/MPmqbIbsQqC3uouO+Fn3WJTbLqZzqF5Yh3UJC0o7Ap8LJpuh6JiBnVq245V427wS6X0jMhkeVdKvFVBTGRIbg1l3pLtVLirGLcPkbT9epXhY3rZ8Y6RzMLnZJVtuU3m821fjUZtn7qqTcpP8ASndKjG/Rv8Q+xtaZWYDbndvUizaTVVtziUNez7p13fRrDQEla3HRL02a5EzZN9pL5Mgzj79Mu0IdrUgWekPdmsIu0FtMW6JbKPJJoQCTxhKk2J3eW9neDfr/IuwS5RkNu7iJEYzHPdlUTWQ/AYiRSSrizeRRVW8J9needA2yZh9G3V8pIWVZ/a5r7o66OrT3jUd5ktAKAQWLZLICbfq9Ej2hpHJUZXhJZbI/g2Bvie/beD6yyYtgHEEjY+ut0Gn9LOOEoxuiJU+kGahmiZrv9luxn8f6L6MRqe3ML1xNTLHoV1FUUHI1BmKKNW1+Hg9OWixv8ZojQSb9pBNX1TemUPY3zB9M/5r0NjYMxWqfvMWmimJi1sKMAHSR//UrfL3JnpwNPLACFa62CG2n+FP4nvjVz72kgUIHXq+Ms0PDzNz0ymR/eTA9P3A2ek2SM8hJaPpq084dNEF/GQABxLPMLm8iNy6RvG3PygLIbW8KYKVCnvmk6zDqqMBItYqa02l9zNB0FS1CE23DPk63wI9NHQI97KK7/8YPlDKE+jlSNFIhLJm0lMGUSDbgKGhr24M0ZrKRZUKUp94T2FwiYxnUhstc+K5G3jzVfEEXKDuKlXSgJMOqP8aMMem6kB0osYk/IxiFP3LjVlMDNKhCJalXmiDJvM9zEFoJamNBcSmu2JR9SUke4XslMs2bwaJH7MsgAKXJ2jQhJaiXhRNDEn73GPYpN6eqgLyqhMuUuNcANnZNwPLwJuakpCYVA9obhKw/6WPYB22wHeAyAoPvhtnazRxH02QMRrVUyCJNToQiBvPaKg4e1Z9C8yaoCLx+CulM0f4SFSRrVVcLHmDHDYnXsojPmLqcgW1l0RgPtg47dpkhya9M4lj9DoYBYZhfw9ViwJu80CWfOpBkjZZMN2DXHLn5U+PY7OrJBdCRRiC+r7ZkK8gsga3SLaYBtsWCUSW0a4+AxWAdQ2JyjBJvuA9tXC/XCLuUPMSkjTSV+EefWqCZEcmtrlRVHOCUqwA87+C+TxXGLxoe+gugnXf10/SbAp4dEvdWgU0zCcXQL3tN4iQtkbwjulNDoRjdNNsinyqFLK0IsiPvm3ECA81XEpdQA113UgmxpVUJkRkaO6wBrEbXl1aQef9CDhJI+MYnBb40SBIZ9pbAwh+oSaa8GIQhNkESIEbpDxoYXiVHO3E7Lpxto4Y3D0r04Xv6lnh1wKoVKpRCaxbbWwQcttU/nEPNqjOqMYDUtBnRFJA29Lyg3Ed9DsB0gCbEqaYmBFa05h3YXwHiBgfYZZtTfpbxEv/lUpbPChDR3IhTF17nfWAX095uduV35WH32g3pEJU/Z6MFkodvkQbNfN5ITN7j0jbo2Qe0BF2SLvS87x9PIlpfHkwiMbCddAlbA64p6lEWnR5ELL+4bEg6eKNBMKG0VtwOIZGGwT9/ehY69dQowRiUKQek8oagZyJqQpGFXIBk2DTbApJApfdCkYckGiqMpx3zzSaKKCCUmFeFWVa0P7cH2AGAHW3QFKBITE3kKv1fPLIVTwppAk1jx0SAts/PXZFJlUd/ugg1djS8wtXGCv/A6Vj0K7IscrVSLKo/XZFKqetFfX4RJ+y2q/wGn1NDT6KaqQU7DN1CEpwqZrB6TAjlTlnz1ycBfKhIP7E3zqC3eICYuRDIC4MMF/dE6iA5y8dkAKpq65X5G8UalGgRVeeuXI+HK7xvtFt1gs6SSbvTE2hQCuUjdlmXMHMo2ConQVxcUyc6VOz4bcKUZE25psCnF85etmzGX5zecgSlfn+8r6540IC1TW9PRB8Gl0BUp3uYrGGGNQyYwhA91e0xKy6ZoBKXDn1D43iT3I3QEbPg+cHZIA0fjyeoS499e7oRDetnrHYFBBvoRok2PBPhYrvOgqxoJfkG1KDCCvV5EJZrdS+WJOVBHsx8wTToUUburCBit8xVHNFQtPkXXWuvInCFG/K1UXudBa4Q9BeIkUpJH460R/C65d8iy0dzFKW4LY41qyJijFVyIkx2HlUyW+ApXrJJE10kNcedaCxYHME3JwTE+B3a0yP0jUQZFPQSZlzs3QElqdWwbM+MO/B6Kk1jG/QTnL9yEtNlM5cxDdYGN/tAxaU/yHnrVg+WPcZJ3QMAg9efAP/V5ZeZT/iDJpSy9RVUPUICSvd42SU0iLygxv28Wzvj+KlBvOUAhu0jOCNdVeVHMpDdecxUcIMQeZ8WGRgwIK14MoZiHyl6fn1tQZrZlyAHKEM35YEUxIia4jbq/SXyd+lRgWYw6zqiMWvlHYlPEQvr745TWgml/EbUDifrPwgIqs4wVzrvxJUiXn/0a2OxrK9wCJDsWvG4aIPq8unCGZncqmI0sotR6ZI72DioJTbdUt1OQFZhpxEULtBOdcUFtGuYmItldUTrDn1MNKxsU3iCUqsbM0IGq+mZ1m0RVU2l1YQKQs0mIhvhnY4QyRJEBc2w2lAd2IDEBJHe3qKVRY6jfM9nh46epNOJ6c5vp8ClqLROEdImQyA4WEYLIsGh+OOyr7ILoRWkK7+CxmEgN0PsS8bVKg5RXGKJcQMxDaMrsCe/h8NjS83n45CJEHMYv5sDJ/ZXjazInAZ3XUlryHkEwm13RgXHTMMZIwWNzaaHCCl/vN6dKzcpm6MvBOjPLQLtJ844ivkvk6uuR78RL76Kx27axN8iYeFZUAiSwy8N/2+c4Dk4rpOjJ6K571htxjWfVXOo2ZegXpsA2DQfJCe4y3uiFGi1iP8VYRyy5r7AIOlIULlEVNO52z96h79NQ1w4gnbsxHY6ggDL2kV5V6ZlnZuA70UGz98zJ1DTak7VLRECf0dieM7NGbKvBulb7JY0cRtFRZ0gfkaeiGriTVvJnMefQaFOkiThXGh20zZ6+jlbzkZf2Dnr+GJUefx6B9DDNx8lF9YVSVdWVbXUYWRT40UJB2qfr8nhYdR8OwtNQoE9mXyt0IDSyeLBnn2JY1ZPFFarS7ogtVO7W/1VrJXXhSNhMDX/YKse0a82yEwE1OXD9/DSc1N2stR7NXg7i1B/6xeMc+9lUYFxw7fmsOi/VKyV3IM2/MUqVeHFbfvrnnDLOKjQNtD6fB12RUrNcrlcUg3emD2G7ltBEL4IIuQppHvc8G8/nr6+t8MHuXPmByKc7F3bH0u+Jo8jEWHtM6ucuCqiubGRmoqKvwXwmhtY8IXps0yVJQuDSV3kwWhc42cfKqcWLIRzwZbENZl7jz0M5qSBu7k+ZiT9YiUE+nJsapCKaT83qgmTUf62/01FXhMQq79vbMuIezLW7bkKDuhzUg651s/lRZPnfSMnm5rbbx5qDh6KM7Vm/v76nf6el9Yn05/lwc7HXULHt8096P9GqDjfixty/rQ1bek2jl1l4u8X4O+Ub58rHfOT867fV6md7p2Ufnrn1ZbsSIQuU6vaP+lW7Gh7nrx5O7+06nc9NfDFIwGeR/B7CuVgNv7e0AAAAASUVORK5CYII='; 
            } 
            // ---------------------------------------------------------
            // [그룹 2] 패브릭/광목/백아이 (동그란 분홍 털실)
            // ---------------------------------------------------------
            else if (n.includes('광목') || n.includes('쉬폰') || n.includes('린넨') || n.includes('캔버스') || n.includes('패브릭') || n.includes('텍') || n.includes('화이트') || n.includes('네츄럴') || n.includes('백아이')) {
                iconUrl = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQqWV5d7OPwqIbTMcek_s71sum2bh8Zh7CFGA&s'; 
            }
            // ---------------------------------------------------------
            // [그룹 3] 디스플레이 매대 (귀여운 상점/가판대)
            // ---------------------------------------------------------
            else if (n.includes('매대') || n.includes('거치대') || n.includes('진열') || n.includes('다이') || n.includes('철제') || n.includes('스탠드')) {
                iconUrl = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT6MsafK1Bk4flaRnwnJ6yHsY_HHtS_rZ3lbA&s'; 
            }
            // ---------------------------------------------------------
            // [그룹 4] 인쇄물/현수막 (말려있는 종이/스크롤)
            // ---------------------------------------------------------
            else if (n.includes('현수막') || n.includes('배너') || n.includes('리플렛') || n.includes('포맥스') || n.includes('폼보드') || n.includes('포스터') || n.includes('아크릴')) {
                iconUrl = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ-0q3W2v3GAdaDgS-5NpX3tfxYN_qTmh6cdA&s'; 
            }

            const div = document.createElement('div');
            div.className = 'quick-item';
            
            // 이미지 크기를 조금 키워서(45px) 더 귀엽게 보이게 조정했습니다.
            div.innerHTML = `
                <div class="quick-icon" style="background:#fff; border:1px solid #f1f5f9;">
                    <img src="${iconUrl}" style="width:45px; height:45px; object-fit:contain;">
                </div>
                <div class="quick-text">${cat.name}</div>
            `;
            
            div.onclick = () => showCategoryProducts(cat.code, cat.name);
            container.appendChild(div);
        });
    }
    // ============================================================
    // [3] 제품 선택 모달 (수정됨: 큰 이미지 + 잘림 방지 + 에디터 연결)
    // ============================================================
    // ============================================================
    // [3] 제품 선택 모달 (수정됨: 깔끔한 아이콘 스타일)
    // ============================================================
    window.showCategoryProducts = async function(catKey, catName) {
        const grid = document.getElementById('catProductGrid');
        const modal = document.getElementById('categoryDetailModal');
        const titleEl = document.getElementById('catModalTitle');
        
        if(titleEl) titleEl.innerHTML = `<span style="color:#6366f1;">${catName}</span> 사이즈 선택`;
        
        // ★ [디자인 복구] 한 줄에 4개씩 나오도록 설정
        grid.style.gridTemplateColumns = "repeat(4, 1fr)"; 
        grid.style.gap = "12px";

        grid.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:40px;">로딩 중...</div>';
        modal.style.display = 'flex';

        // DB 조회
        const { data: products, error } = await sb.from('admin_products')
            .select('*')
            .eq('category', catKey)
            .order('sort_order', { ascending: true });

        grid.innerHTML = '';

        if (!products || products.length === 0) {
            grid.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:20px; color:#999;">등록된 상품이 없습니다.</div>';
            return;
        }

        // 카드 생성
        products.forEach(p => {
            // 전역 DB 등록
            if (!window.PRODUCT_DB) window.PRODUCT_DB = {};
            window.PRODUCT_DB[p.code] = {
                name: p.name, w: p.width_mm, h: p.height_mm, price: p.price,
                img: p.img_url, addons: p.addons ? p.addons.split(',') : [], category: p.category
            };

            const div = document.createElement('div');
            // 시작화면 버튼과 똑같은 클래스(.quick-item) 사용 -> 디자인 통일
            div.className = 'quick-item'; 
            
            // 깔끔한 아이콘 + 이름 + (작게 가격 표시)
            div.innerHTML = `
                <div class="quick-icon"><i class="fa-solid fa-cube"></i></div>
                <div class="quick-text">${p.name}</div>
                <div style="font-size:11px; color:#888; margin-top:3px;">
                    ${p.width_mm}x${p.height_mm} / ${p.price.toLocaleString()}원
                </div>
            `;

            // 클릭 시 에디터 연결
            div.onclick = () => {
                modal.style.display = 'none'; // 목록 닫기
                
                window.currentProductKey = p.code;
                window.selectedProductForChoice = window.PRODUCT_DB[p.code];

                if(!p.code) return alert("상품 코드가 없습니다.");

                // 바로 에디터로 진입 (또는 선택 모달)
                if(window.showChoiceModal) {
                    window.showChoiceModal(p.code);
                } else {
                    window.startEditorDirect(p.code);
                }
            };

            grid.appendChild(div);
        });
    };

    // ============================================================
    // [4] 작업 방식 선택 모달 (유지)
    // ============================================================
    window.showChoiceModal = function(key) {
    window.currentProductKey = key;
    window.selectedProductForChoice = window.PRODUCT_DB[key];
    
    if (!window.selectedProductForChoice) return alert("상품 정보를 불러오는 중입니다. 다시 시도해주세요.");
    
    // [추가됨] 상품명 표시
    const nameEl = document.getElementById('choiceProdName');
    if(nameEl) nameEl.innerText = window.selectedProductForChoice.name;

    // [추가됨] 이미지 주소(DB에서 가져온 img_url)를 img 태그에 넣기
    const imgEl = document.getElementById('choiceProductImg');
    if(imgEl) {
        // 이미지가 없으면 기본 플레이스홀더 사용
        imgEl.src = window.selectedProductForChoice.img || 'https://placehold.co/400?text=No+Image';
    }

    document.getElementById('choiceModal').style.display = 'flex';
};

    window.confirmChoice = function(mode) {
        if (!window.selectedProductForChoice) return alert("상품 정보가 없습니다.");

        if (mode === 'editor') {
            document.getElementById('choiceModal').style.display = 'none';
            // ★ 중요: window.startEditorDirect 호출
            window.startEditorDirect(window.selectedProductForChoice.key || window.currentProductKey);
        } else {
            const input = document.getElementById('directUploadInput');
            if(input) input.click();
        }
    };
    // [추가됨] 파일 선택 시 장바구니로 이동하는 로직
    const directUploadInput = document.getElementById("directUploadInput");
    
    if (directUploadInput) {
        // 기존에 혹시 연결된 이벤트가 있다면 덮어씌웁니다.
        directUploadInput.onchange = function(e) {
            const file = e.target.files[0];
            if (!file) return;

            // 선택된 상품 정보 가져오기
            const product = window.selectedProductForChoice;
            if (!product) return alert("상품 정보가 없습니다.");

            // 로딩 표시
            const loading = document.getElementById("loading");
            if (loading) loading.style.display = "flex";

            const reader = new FileReader();
            reader.onload = function(evt) {
                const fileDataURI = evt.target.result;
                
                // 썸네일 처리
                let thumbUrl = 'https://placehold.co/100?text=FILE';
                if (file.type.startsWith('image/')) {
                    thumbUrl = fileDataURI;
                }

                // 장바구니 아이템 생성
                const newItem = {
                    uid: Date.now(),
                    product: product,
                    type: 'file',
                    fileName: file.name,
                    mimeType: file.type,
                    fileData: fileDataURI,
                    thumb: thumbUrl,
                    qty: 1,
                    selectedAddons: {},
                    isOpen: true
                };

                // 전역 장바구니 배열에 추가 (config.js에서 가져온 변수 사용)
                if (typeof cartData !== 'undefined') {
                    cartData.push(newItem);
                    
                    // 로컬 스토리지 저장
                    try {
                        const user = typeof currentUser !== 'undefined' ? currentUser : null;
                        const storageKey = user ? `chameleon_cart_${user.id}` : 'chameleon_cart_guest';
                        localStorage.setItem(storageKey, JSON.stringify(cartData));
                    } catch(err) { console.error(err); }
                }

                // 화면 전환
                if (window.renderCart) window.renderCart();
                document.getElementById('choiceModal').style.display = 'none';
                document.getElementById('cartPage').style.display = 'block';
                
                if (loading) loading.style.display = "none";
                
                // 입력창 초기화 (같은 파일 다시 선택 가능하도록)
                directUploadInput.value = ''; 
            };
            
            reader.readAsDataURL(file);
        };
    }

    // ==========================================================
    // [3번 수정 - 수정됨] 템플릿 및 에디터 진입 로직
    // ==========================================================

    window.pendingTemplate = null; 

    // 1. 에디터 진입 함수
    window.startEditorDirect = async function(key) {
        if (!key) return alert("상품 코드가 올바르지 않습니다.");

        window.currentProductKey = key;
        if(canvas) canvas.currentProductKey = key;
        
        const product = window.PRODUCT_DB ? window.PRODUCT_DB[key] : null;
        const width = product ? product.w : 210; 
        const height = product ? product.h : 297;
        const mode = (typeof key === 'string' && key.includes('Wall')) ? 'wall' : 'standard';
        
        // 캔버스 사이즈 적용
        if (window.applySize) {
            window.applySize(width, height, key, mode, 'replace');
        }
        
        // 화면 전환
        document.getElementById("startScreen").style.display = "none";
        document.getElementById("mainEditor").style.display = "flex";
        window.dispatchEvent(new Event('resize'));

        // ★ [수정 포인트] window. 을 제거했습니다.
        if (window.pendingTemplate) {
            setTimeout(async () => {
                // 여기서 window.applyTemplateDirectly -> applyTemplateDirectly 로 변경
                if (typeof applyTemplateDirectly === 'function') {
                    await applyTemplateDirectly(window.pendingTemplate);
                } else {
                    console.error("템플릿 적용 함수를 찾을 수 없습니다.");
                }
                window.pendingTemplate = null; 
            }, 300); // 딜레이를 100ms -> 300ms로 조금 늘려 안정성을 확보했습니다.
        }
    };

    // 2. 템플릿 클릭 핸들러
    window.onTemplateClick = async function(tpl) {
        const startScreen = document.getElementById('startScreen');
        const isEditorOpen = startScreen && window.getComputedStyle(startScreen).display === 'none';

        if (isEditorOpen) {
            // 에디터 상태: 바로 적용
            if(!confirm("현재 캔버스에 템플릿을 적용하시겠습니까?\n(기존 디자인 위에 추가됩니다)")) return;
            // 여기도 window. 없이 호출
            await applyTemplateDirectly(tpl);
        } else {
            // 시작 화면: 선택 모달 띄우기
            window.pendingTemplate = tpl; 
            showCategorySelectionModal(); 
        }
    };

    // 3. "무엇을 만들까요?" 모달
    async function showCategorySelectionModal() {
        const modal = document.getElementById('categoryDetailModal');
        const grid = document.getElementById('catProductGrid');
        const titleEl = document.getElementById('catModalTitle');
        
        if(titleEl) titleEl.innerHTML = `<span style="color:#6366f1;">Q. 무엇을 만들까요?</span> <span style="font-size:14px; color:#888; font-weight:normal;">(사이즈 선택)</span>`;
        
        modal.style.display = 'flex';
        grid.innerHTML = '<div style="grid-column:1/-1; text-align:center;">불러오는 중...</div>';
        
        const { data: categories, error } = await sb.from('admin_categories')
            .select('*').order('sort_order', { ascending: true });

        if (!categories || categories.length === 0) return;

        grid.innerHTML = '';
        
        categories.forEach(cat => {
            let iconUrl = 'https://cdn-icons-png.flaticon.com/512/3159/3159310.png';
            const n = cat.name;
            if (n.includes('허니콤') || n.includes('등신대')) iconUrl = 'data:image/png;base64,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'; 
            else if (n.includes('패브릭') || n.includes('광목')) iconUrl = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQqWV5d7OPwqIbTMcek_s71sum2bh8Zh7CFGA&s';
            else if (n.includes('매대') || n.includes('거치대')) iconUrl = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT6MsafK1Bk4flaRnwnJ6yHsY_HHtS_rZ3lbA&s';
            else if (n.includes('배너') || n.includes('현수막')) iconUrl = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ-0q3W2v3GAdaDgS-5NpX3tfxYN_qTmh6cdA&s';

            const div = document.createElement('div');
            div.className = 'quick-item';
            div.innerHTML = `
                <div class="quick-icon" style="background:#fff; border:1px solid #f1f5f9;">
                    <img src="${iconUrl}" style="width:45px; height:45px; object-fit:contain;">
                </div>
                <div class="quick-text">${cat.name}</div>
            `;
            
            div.onclick = () => window.showCategoryProducts(cat.code, cat.name);
            grid.appendChild(div);
        });
    }

    async function applyTemplateDirectly(tpl) {
        document.getElementById("loading").style.display = "flex";
        document.getElementById('templateOverlay').style.display = 'none';
        try {
            const { data: doc, error } = await sb.from('library').select('data_url').eq('id', tpl.id).single();
            if (error || !doc) return alert("데이터 로드 실패");
            await window.applyTemplateToCanvas(doc.data_url);
        } catch (e) {
            console.error(e);
        } finally {
            document.getElementById("loading").style.display = "none";
        }
    }

    window.applyTemplateToCanvas = async function(inputData) {
        if (!canvas) return;
        document.getElementById("loading").style.display = "flex";
        try {
            let jsonData = inputData;
            if (typeof inputData === 'string') {
                if (inputData.startsWith('http')) {
                    const res = await fetch(inputData);
                    jsonData = await res.json();
                } else if (inputData.trim().startsWith('{')) {
                    jsonData = JSON.parse(inputData);
                }
            }

            let board = canvas.getObjects().find(o => o.isBoard);
            let boardSize = board ? { w: board.width * board.scaleX, h: board.height * board.scaleY } : { w: canvas.width, h: canvas.height };
            let center = board ? { x: board.left + boardSize.w/2, y: board.top + boardSize.h/2 } : { x: canvas.width/2, y: canvas.height/2 };

            const onLoad = (objects, options) => {
                if(!objects || objects.length===0) return finishLoading();
                objects.forEach(o => { 
                    o.set({ selectable: true, evented: true, lockMovementX: false, lockMovementY: false });
                    if(o.type==='i-text'||o.type==='text') delete o.textBaseline; 
                });
                let group;
                if(options) group = fabric.util.groupSVGElements(objects, options);
                else group = new fabric.Group(objects);
                group.set({ originX: 'center', originY: 'center' });

                const scaleX = boardSize.w / group.width;
                const scaleY = boardSize.h / group.height;
                const scale = Math.max(scaleX, scaleY);

                group.set({ scaleX: scale, scaleY: scale, left: center.x, top: center.y });
                canvas.add(group);
                group.toActiveSelection();
                canvas.requestRenderAll();
                finishLoading();
            };

            if (typeof jsonData === 'string' && (jsonData.includes('<svg') || jsonData.includes('data:image/svg'))) {
                fabric.loadSVGFromString(jsonData, onLoad);
            } else if (typeof jsonData === 'object' && jsonData.objects) {
                const objs = jsonData.objects.filter(o => !o.isBoard);
                fabric.util.enlivenObjects(objs, (enlivened) => onLoad(enlivened, null));
            } else {
                fabric.Image.fromURL(inputData, (img) => {
                    if(img) onLoad([img], null); else finishLoading();
                });
            }
        } catch(e) { console.error(e); finishLoading(); }
    };

    function finishLoading() {
        document.getElementById("loading").style.display = "none";
        document.getElementById('templateOverlay').style.display = 'none';
    }

    window.addEventListener('load', async () => {
        await new Promise(r => setTimeout(r, 500));
        renderQuickMenu();
        loadTemplates('startTemplateGrid', false);
        window.preloadKoreanFont();
    });

    async function loadTemplates(containerId, isModal = false) {
        const grid = document.getElementById(containerId);
        if (!grid) return;
        grid.innerHTML = 'Loading...';
        if (!sb) await new Promise(r => setTimeout(r, 500)); 
        const { data } = await sb.from('library').select('id, thumb_url, category').order('created_at', { ascending: false }).limit(50);
        if (!data) { grid.innerHTML = 'No Data'; return; }
        grid.innerHTML = '';
        data.forEach(tpl => {
            const card = document.createElement('div');
            card.className = isModal ? 'tpl-item' : 'tpl-card-start';
            let imgSrc = tpl.thumb_url || 'https://via.placeholder.com/300';
            card.innerHTML = isModal ? `<img src="${imgSrc}" class="tpl-item-img">` : `<img src="${imgSrc}" class="tpl-card-img"><div class="tpl-card-overlay"></div>`;
            card.onclick = () => { if(window.onTemplateClick) window.onTemplateClick(tpl); };
            grid.appendChild(card);
        });
    }

    // 기타 유틸
    window.toggleLockSelection = function() { if(!canvas)return; const a=canvas.getActiveObject(); if(!a)return alert("선택필요"); const l=!a.lockMovementX; a.set({lockMovementX:l,lockMovementY:l,lockRotation:l,lockScalingX:l,lockScalingY:l,hasControls:!l,selectable:true}); canvas.discardActiveObject(); canvas.requestRenderAll(); };
    window.setAsBackground = function() { if(!canvas)return; const a=canvas.getActiveObject(); if(!a)return alert("선택필요"); const b=canvas.getObjects().find(o=>o.isBoard); if(!b)return; const s=Math.max((b.width*b.scaleX)/a.width,(b.height*b.scaleY)/a.height); a.set({scaleX:s,scaleY:s,left:b.left+(b.width*b.scaleX)/2,top:b.top+(b.height*b.scaleY)/2,originX:'center',originY:'center',angle:0}); canvas.sendToBack(a); canvas.sendToBack(b); canvas.requestRenderAll(); };
    window.alignObject = function(d) { if(!canvas)return; const a=canvas.getActiveObject(); if(!a)return; const b=canvas.getObjects().find(o=>o.isBoard); const r=b?b.getBoundingRect():{left:0,top:0,width:canvas.width,height:canvas.height}; const w=a.getScaledWidth(); const h=a.getScaledHeight(); if(d=='left') a.left=r.left+w/2; if(d=='centerH') a.left=r.left+r.width/2; if(d=='right') a.left=r.left+r.width-w/2; if(d=='top') a.top=r.top+h/2; if(d=='centerV') a.top=r.top+r.height/2; if(d=='bottom') a.top=r.top+r.height-h/2; if(d=='center') { a.left=r.left+r.width/2; a.top=r.top+r.height/2; } a.setCoords(); canvas.requestRenderAll(); };

    if (window.pdfjsLib) window.pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    window.koreanFontCache = null;
    window.preloadKoreanFont = async function() { try { const r = await fetch('https://cdn.jsdelivr.net/gh/google/fonts@main/ofl/nanumgothic/NanumGothic-Regular.ttf'); if(r.ok) { const b = await r.blob(); const rd = new FileReader(); rd.onloadend = function() { window.koreanFontCache = rd.result.split(',')[1]; }; rd.readAsDataURL(b); } } catch(e) {} };
    window.loadKoreanFontForPDF = async function(doc) { if(window.koreanFontCache) { try { doc.addFileToVFS('NanumGothic.ttf', window.koreanFontCache); doc.addFont('NanumGothic.ttf', 'NanumGothic', 'normal'); doc.addFont('NanumGothic.ttf', 'NanumGothic', 'bold'); doc.setFont('NanumGothic'); } catch(e) {} } };
</script>
<script>
    document.addEventListener('click', function(e) {
        const card = e.target.closest('.size-card');
        if (card) {
            const onclickCode = card.getAttribute('onclick');
            if (onclickCode) {
                try { eval(onclickCode); } catch(err) { console.error("판형 클릭 오류:", err); }
            }
        }
    });
    
    window.closeSuccessModal = function() {
        const modal = document.getElementById('successModal');
        if (modal) {
            modal.style.display = 'none';
        }
    };

    document.addEventListener('DOMContentLoaded', () => {
        const confirmBtn = document.querySelector('#successModal .btn-round.primary');
        if(confirmBtn) {
            confirmBtn.onclick = window.closeSuccessModal;
        }
    });
    
    // 입력창 오류 해결
    window.addEventListener('keydown', function(e) {
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
            if (e.code === 'Space' || e.key === ' ') {
                e.stopPropagation(); 
            }
        }
    }, true);
</script>
<script src="https://js.tosspayments.com/v1"></script>
<button id="btnPayTest" style="display:none; position:fixed; bottom:20px; right:20px; z-index:999999;">결제테스트</button>
<script>
  (function(){var w=window;if(w.ChannelIO){return w.console.error("ChannelIO script included twice.");}var ch=function(){ch.c(arguments);};ch.q=[];ch.c=function(args){ch.q.push(args);};w.ChannelIO=ch;function l(){if(w.ChannelIOInitialized){return;}w.ChannelIOInitialized=true;var s=document.createElement("script");s.type="text/javascript";s.async=true;s.src="https://cdn.channel.io/plugin/ch-plugin-web.js";var x=document.getElementsByTagName("script")[0];if(x.parentNode){x.parentNode.insertBefore(s,x);}}if(document.readyState==="complete"){l();}else{w.addEventListener("DOMContentLoaded",l);w.addEventListener("load",l);}})();
  ChannelIO('boot', { "pluginKey": "752ba9ff-a447-4e10-9813-715e051995cd" });
</script>
<script>
window.addToCartAndGo = async function() {
    // 1. 캔버스 확인
    if (!canvas) return alert("오류: 캔버스가 로드되지 않았습니다.");
    
    // 로딩 표시
    const loading = document.getElementById("loading");
    if(loading) loading.style.display = "flex";

    try {
        // 2. 현재 디자인 썸네일 & 데이터 생성
        // 배경(보드)만 따로 찾아서 그 크기만큼만 이미지를 뜹니다.
        const board = canvas.getObjects().find(o => o.isBoard);
        let thumbUrl = "";
        
        // 썸네일 생성 (화면 캡쳐)
        if (board) {
            // 잠시 뷰포트 초기화해서 정확히 캡쳐
            const vpt = canvas.viewportTransform;
            canvas.setViewportTransform([1, 0, 0, 1, 0, 0]);
            thumbUrl = canvas.toDataURL({
                format: 'png',
                multiplier: 0.5, // 용량 최적화를 위해 반으로 축소
                quality: 0.8,
                left: board.left,
                top: board.top,
                width: board.width * board.scaleX,
                height: board.height * board.scaleY
            });
            // 뷰포트 원상복구
            canvas.setViewportTransform(vpt);
        } else {
            thumbUrl = canvas.toDataURL({ format: 'png', multiplier: 0.5 });
        }

        // 3. 장바구니 아이템 만들기
        const currentProduct = window.PRODUCT_DB ? window.PRODUCT_DB[window.currentProductKey] : null;
        
        const newItem = {
            uid: Date.now(), // 고유 ID
            productName: currentProduct ? currentProduct.name : '나만의 디자인',
            type: 'design', // 유형: 디자인
            price: currentProduct ? currentProduct.price : 0, // 가격
            qty: 1,
            thumb: thumbUrl, // 방금 캡쳐한 이미지
            // ★ 핵심: 현재 캔버스 상태를 통째로 저장 (나중에 불러오기 가능)
            designData: JSON.stringify(canvas.toJSON(['id', 'isBoard', 'selectable', 'evented'])), 
            options: {} 
        };

        // 4. 전역 장바구니 배열에 추가
        if (typeof cartData !== 'undefined') {
            cartData.push(newItem);
            // 로컬 스토리지 저장 (새로고침 해도 유지되게)
            localStorage.setItem("chameleon_cart", JSON.stringify(cartData));
        }

        // 5. 장바구니 화면 열기
        if (window.renderCart) window.renderCart(); // 목록 새로고침
        document.getElementById('cartPage').style.display = 'block';
        
        // (선택) 알림 메시지
        // alert("현재 디자인이 장바구니에 담겼습니다.");

    } catch (e) {
        console.error(e);
        alert("장바구니 담기 중 오류가 발생했습니다: " + e.message);
    } finally {
        if(loading) loading.style.display = "none";
    }
};
</script>
</body>
</html>