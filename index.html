<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ì¹´ë©œë ˆì˜¨ ìº”ë°” : Expert Studio (Full Version)</title>
<title>ì¹´ë©œë ˆì˜¨ ìº”ë°” : Expert Studio</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/svg2pdf.js@2.2.4/dist/svg2pdf.umd.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/plugins/svg.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/potrace@2.1.8/potrace.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/opentype.js@latest/dist/opentype.min.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/GmarketSans/build/GmarketSans.css">
<link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700;800&family=Nanum+Myeongjo:wght@400;700;800&family=Do+Hyeon&family=Jua&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
    :root { 
        --primary: #6366f1; --primary-dark: #4f46e5;
        --text-main: #111827; --text-sub: #4b5563;
        --bg-sidebar: #ffffff; 
        --bg-stage: #2b2b2b; /* í¬í† ìƒµ ìŠ¤íƒ€ì¼ ì§„í•œ íšŒìƒ‰ ë°°ê²½ */
        --border: #e5e7eb;
    }
    * { box-sizing: border-box; outline: none; user-select: none; -webkit-tap-highlight-color: transparent; }
    
    body { 
        margin: 0; height: 100vh; height: 100dvh; overflow: hidden; 
        background: var(--bg-sidebar); 
        font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, 'Nanum Gothic', sans-serif; 
        color: var(--text-main);
    }
    
    button, input, textarea, select { font-family: inherit; }
    .canvas-container { margin: auto !important; }

    #loading { position:fixed; inset:0; background:rgba(255,255,255,0.95); z-index:20000; display:none; justify-content:center; align-items:center; flex-direction:column; backdrop-filter: blur(5px); }
    .loading-spin { width:50px; height:50px; border:5px solid #e5e7eb; border-top:5px solid var(--primary); border-radius:50%; animation:spin 1s infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    /* =========================================
       [ì‹œì‘ í™”ë©´ ìŠ¤íƒ€ì¼]
       ========================================= */
    #startScreen { 
        position: fixed; inset: 0; 
        background: #fff; 
        z-index: 9999; 
        display: flex; flex-direction: column; align-items: center; justify-content: flex-start; 
        overflow-y: auto; 
        padding-bottom: 80px;
    }
    /* =========================================
    [ìš°í´ë¦­ ë©”ë‰´ ìŠ¤íƒ€ì¼ ì¶”ê°€]
    ========================================= */
#contextMenu {
    display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
    position: fixed;
    z-index: 99999;
    background: #fff;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.15);
    padding: 6px 0;
    width: 160px;
    font-size: 13px;
    color: #333;
}
.ctx-item {
    padding: 8px 15px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: background 0.1s;
}
.ctx-item:hover {
    background: #f3f4f6;
    color: var(--primary);
}
.ctx-divider {
    height: 1px;
    background: #e5e7eb;
    margin: 5px 0;
}
    /* 1. íˆì–´ë¡œ ì„¹ì…˜ */
    .hero-section {
        width: 100%;
        padding: 50px 20px 30px;
        text-align: center;
        background: #fff;
        margin-bottom: 10px;
    }
    .hero-title { 
        font-size: 54px; 
        font-weight: 900; color: #111; 
        letter-spacing: -0.04em; line-height: 1.1; margin-bottom: 15px; 
    }
    .hero-title span { 
        background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }
    .hero-desc { 
        font-size: 18px; color: #6b7280; font-weight: 500; 
        background: #f3f4f6; padding: 10px 24px; border-radius: 30px; display: inline-block; 
    }

    /* 2. ì œí’ˆ ì„ íƒ (Quick Menu) - 8ì—´ (2ì¤„) */
    .quick-menu-wrapper {
        width: 98%;
        max-width: 1200px;
        margin-bottom: 40px;
        padding: 0 10px;
    }
    .quick-menu-label {
        font-size: 15px; font-weight: 800; color: #374151;
        margin-bottom: 15px; text-align: center; text-transform: uppercase; letter-spacing: 0.05em;
    }
    
    .quick-menu-track {
        display: grid;
        grid-template-columns: repeat(8, 1fr); 
        gap: 12px; 
        justify-content: center;
    }

    .quick-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%; 
        cursor: pointer;
        transition: transform 0.2s;
        margin-bottom: 5px;
        background: #f9fafb;
        border-radius: 16px;
        padding: 12px 5px; 
        border: 1px solid transparent;
    }
    .quick-item:hover { 
        transform: translateY(-5px); 
        background: #fff; 
        border-color: var(--primary);
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);
    }
    
    .quick-icon {
        width: 60px; height: 60px; 
        background: #1f2937; 
        border-radius: 18px; 
        display: flex; align-items: center; justify-content: center;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        font-size: 26px; 
        color: white;
        margin-bottom: 8px;
        transition: all 0.2s;
    }
    .quick-item:hover .quick-icon {
        background: var(--primary);
        box-shadow: 0 8px 16px rgba(99, 102, 241, 0.4);
    }
    .quick-text {
        font-size: 13px; 
        color: #374151;
        font-weight: 700;
        text-align: center;
        letter-spacing: -0.02em;
        white-space: nowrap;
    }

    /* 3. í…œí”Œë¦¿ ê°¤ëŸ¬ë¦¬ */
    .gallery-section { width: 96%; max-width: 1600px; margin-top: 10px; }
    .gallery-header { 
        text-align: center; margin-bottom: 30px; 
        font-size: 22px; font-weight: 800; color: #111; 
        display: flex; align-items: center; justify-content: center; gap: 15px;
    }
    .gallery-header::before, .gallery-header::after { content: ''; height: 2px; width: 40px; background: #e5e7eb; }
    
    .template-grid-start {
        column-count: 5; 
        column-gap: 20px;
        width: 100%;
    }
    .tpl-card-start {
        display: inline-block; 
        width: 100%;
        background: #fff;
        border-radius: 16px;
        overflow: hidden;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        margin-bottom: 15px; 
        break-inside: avoid; 
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        border: 1px solid #e5e7eb;
    }
    .tpl-card-start:hover { 
        transform: translateY(-5px); 
        box-shadow: 0 15px 30px rgba(0,0,0,0.1); 
        border-color: var(--primary);
        z-index: 10;
    }
    .tpl-card-img { 
        width: 100%; 
        height: auto; 
        display: block; 
        background: #f9fafb;
    }
    .tpl-card-overlay {
        position: absolute; inset: 0;
        background: rgba(0,0,0,0.05);
        opacity: 0; transition: 0.2s;
        pointer-events: none;
    }
    .tpl-card-start:hover .tpl-card-overlay { opacity: 1; }

    /* ë©”ì¸ ì—ë””í„° ë ˆì´ì•„ì›ƒ */
    #mainEditor { display: none; width: 100vw; height: 100vh; height: 100dvh; flex-direction: column; }
    .topbar { height: 60px; display: flex; align-items: center; padding: 0 25px; background: #fff; border-bottom: 1px solid var(--border); gap: 10px; z-index: 100; justify-content: space-between; overflow-x: auto; white-space: nowrap; }
    .topbar::-webkit-scrollbar { display: none; }
    .brand { font-weight: 800; font-size: 22px; color: var(--primary); cursor: pointer; flex-shrink: 0; }
    .template-tabs { display: flex; gap: 5px; }
    .tpl-tab { padding: 8px 16px; border-radius: 8px; background: #f8fafc; color: var(--text-sub); font-size: 13px; font-weight: 600; cursor: pointer; border: 1px solid transparent; transition: 0.2s; white-space: nowrap; }
    .tpl-tab:hover { background: #eff6ff; color: var(--primary); }
    #btnMobileTemplateOpen { display: none; padding: 8px 12px; border-radius: 8px; background: #eff6ff; color: var(--primary); font-size: 13px; font-weight: 700; border: 1px solid var(--primary); cursor: pointer; }

    .btn { padding: 9px 18px; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; transition: 0.2s; border: 1px solid transparent; white-space: nowrap; flex-shrink: 0; }
    .btn.primary { background: var(--primary); color: white; box-shadow: 0 4px 6px rgba(99, 102, 241, 0.2); }
    .btn:hover:not(.primary) { background: #f1f5f9; }
    .btn-save-top { background: #741e9c; color: white; display: flex; align-items: center; gap: 6px; }
    #btnOpenSaveModal { background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); color: white; border: none; font-weight: 800; box-shadow: 0 4px 10px rgba(99, 102, 241, 0.3); }

    .editor-wrap { display: grid; grid-template-columns: 280px 1fr; height: calc(100vh - 60px); width: 100vw; overflow: hidden; }
    .side { background: #fff; border-right: 1px solid var(--border); padding: 20px; overflow-y: auto; z-index: 20; display: flex; flex-direction: column; gap: 15px; }
    .stage { background: var(--bg-stage); width: 100%; height: 100%; position: relative; overflow: hidden; display: flex; justify-content: center; align-items: center; touch-action: none; }

    #wallHeightControls { position: absolute; top: 85px; left: 50%; transform: translateX(-50%); background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(8px); padding: 8px 15px; border-radius: 50px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.12); display: none; align-items: center; gap: 12px; z-index: 40; border: 1px solid rgba(0,0,0,0.1); white-space: nowrap; }
    .wall-label { font-size: 13px; font-weight: 700; color: #475569; display: flex; align-items: center; gap: 6px; }
    .height-btn { padding: 6px 16px; border-radius: 20px; border: 1px solid #e2e8f0; background: #fff; color: #64748b; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s; white-space: nowrap; }
    .height-btn.active { background: var(--primary); color: #fff; border-color: var(--primary); }

    .section-title { font-size: 13px; font-weight: 700; color: #333; margin-top: 10px; text-transform: uppercase; letter-spacing: 0.05em; }
    .btn-round { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid var(--border); background: #fff; font-weight: 600; cursor: pointer; font-size: 13px; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; color: var(--text-main); }
    .btn-round.primary { background: var(--primary); color: #fff; border: none; }
    .btn-round.ai-red { background: linear-gradient(135deg, #f43f5e 0%, #fb7185 100%); color: white; border: none; }
    .shape-panel { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
    .shape-btn { height: 40px; border: 1px solid var(--border); border-radius: 8px; cursor: pointer; background: #fff; font-size: 16px; color: #64748b; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
    .shape-btn:hover { border-color: var(--primary); color: var(--primary); background: #eff6ff; }
    .upload-box { border: 2px dashed #cbd5e1; border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; background: #f8fafc; color: #64748b; font-size: 13px; display: flex; flex-direction: column; align-items: center; transition: 0.2s; }
    .upload-box:hover { border-color: var(--primary); background: #eff6ff; color: var(--primary); }

    .right-stack { position: absolute; right: 20px; top: 20px; bottom: 20px; width: 260px; display: flex; flex-direction: column; gap: 15px; overflow-y: auto; z-index: 50; pointer-events: auto; }
    .right-stack::-webkit-scrollbar { width: 6px; }
    .right-stack::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 3px; }
    .panel-box { background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); border-radius: 16px; padding: 15px; box-shadow: var(--shadow); border: 2px solid transparent; flex-shrink: 0; }
    .tool-btn { flex: 1; min-width: 0; padding: 8px; margin-top: 5px; border-radius: 8px; border: 1px solid #eee; background: #fff; color: #333; font-size: 12px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; }
    .tool-btn:hover { border-color: var(--primary); color: var(--primary); background: #f8fafc; }
    .ai-tool-stack { display: flex; flex-direction: column; gap: 5px; width: 100%; }
    #btnCutout { background: #fff9c4; color: #5d4037; border: 1px solid #fbc02d; }
    #btnCutout:hover { background: #fff59d; transform: translateY(-1px); }
    .align-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; margin-top: 10px; }
    .align-btn { padding: 8px 0; border: 1px solid #eee; border-radius: 8px; background: #fff; cursor: pointer; color: #555; display: flex; align-items: center; justify-content: center; transition: 0.2s; font-size: 14px; }
    .align-btn:hover { background: #f8fafc; color: var(--primary); border-color: var(--primary); }
    .color-group { display: flex; align-items: center; justify-content: space-between; margin-top: 5px; border: 1px solid #e2e8f0; padding: 5px 10px; border-radius: 8px; font-size: 12px; color: #666; }
    .color-picker { -webkit-appearance: none; appearance: none; width: 32px; height: 32px; border: 1px solid #e2e8f0; background: none; cursor: pointer; padding: 0; border-radius: 50%; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: transform 0.2s; box-sizing: border-box; }
    .color-picker::-webkit-color-swatch-wrapper { padding: 0; border: none; }
    .color-picker::-webkit-color-swatch { border: none; border-radius: 50%; padding: 0; }
    .color-picker:hover { transform: scale(1.1); }
    .bottom-dock { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); background: #fff; padding: 8px 20px; border-radius: 50px; box-shadow: var(--shadow); display: flex; align-items: center; gap: 15px; z-index: 100; white-space: nowrap; }
    .zoom-btn { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px; cursor: pointer; color: #555; background: #f1f5f9; border:none; }
    .zoom-btn:hover { background: #e2e8f0; color: #000; }
    .divider { width: 1px; height: 16px; background: #ddd; }
    #guideToggle.active { background: var(--primary); color: white; }
    .help-text { font-size: 12px; color: #666; margin-left: 10px; font-weight: 500; white-space: nowrap; }

    /* ëª¨ë‹¬ ë° ê¸°íƒ€ */
    .modal-bg { position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); display: none; justify-content: center; align-items: center; z-index: 10000; }
    .modal-box { background: #fff; padding: 30px; border-radius: 20px; width: 400px; text-align: center; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); max-height: 90vh; overflow-y: auto; }
    .ai-input-pretty { width: 100%; padding: 12px 15px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 14px; background: #f9f9f9; margin-bottom: 10px; outline: none; }
    .ai-input-pretty:focus { border-color: var(--primary); background: #fff; }
    .ai-drawer { position: fixed; top: 60px; right: 0; width: 360px; height: calc(100vh - 60px); background: #fff; border-left: 1px solid #e2e8f0; padding: 25px; z-index: 9000; transform: translateX(100%); transition: 0.3s; box-shadow: -5px 0 15px rgba(0,0,0,0.05); overflow-y: auto; }
    .ai-drawer.open { transform: translateX(0); }
    #templateOverlay { position: fixed; inset: 0; background: rgba(255,255,255,0.6); backdrop-filter: blur(15px); z-index: 9999; display: none; justify-content: center; align-items: center; }
    .tpl-modal-box { width: 90%; max-width: 1200px; height: 85%; background: #fff; border-radius: 24px; box-shadow: 0 20px 60px rgba(0,0,0,0.15); border: 1px solid rgba(255,255,255,0.5); display: flex; overflow: hidden; }
    .tpl-sidebar { width: 240px; background: #f8fafc; border-right: 1px solid #e2e8f0; padding: 30px 20px; display: flex; flex-direction: column; gap: 10px; }
    .tpl-cate-btn { text-align: left; padding: 12px 16px; border-radius: 12px; font-size: 14px; font-weight: 600; color: #64748b; cursor: pointer; transition: 0.2s; border: none; background: transparent; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
    .tpl-cate-btn:hover { background: #e2e8f0; color: var(--text-main); }
    .tpl-cate-btn.active { background: #fff; color: var(--primary); box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
    .tpl-content { flex: 1; display: flex; flex-direction: column; background: #fff; }
    .tpl-grid { display: block !important; column-count: 3 !important; column-gap: 20px; width: 100%; padding: 20px; box-sizing: border-box; height: auto !important; flex: 1; overflow-y: auto !important; overflow-x: hidden; scrollbar-width: thin; background-color: #f1f5f9; }
    .tpl-item { position: relative; background-color: #ffffff; border-radius: 16px; overflow: hidden; cursor: pointer; border: none !important; padding: 0 !important; margin-bottom: 20px; break-inside: avoid; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
    .tpl-item-img { width: 100%; height: auto !important; object-fit: contain; display: block; background-color: #fff; margin: 0 !important; padding: 0 !important; }
    .tpl-item.selected { box-shadow: 0 0 0 3px var(--primary); }
    .tpl-item div:not(:has(img)) { display: none !important; }
    #cartPage { z-index: 120000; padding-top: 40px; }
    #cartListArea { overflow-y: auto; max-height: 70vh; }
    .cart-item { margin-bottom: 15px; }
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-top: 15px; width: 100%; }
    .cal-day-header { font-weight: 800; text-align: center; padding: 5px 0; color: var(--primary); font-size: 14px; }
    .cal-day { height: 45px; display: flex; align-items: center; justify-content: center; font-size: 14px; cursor: pointer; border-radius: 8px; background: #f8fafc; transition: 0.2s; }
    .cal-day:hover:not(.disabled) { background: #eff6ff; color: var(--primary); font-weight: bold; }
    .cal-day.disabled { color: #cbd5e1; cursor: not-allowed; background: #fff; }
    .cal-day.selected { background: var(--primary); color: white; font-weight: bold; box-shadow: 0 4px 10px rgba(99,102,241,0.3); }


    /* =========================================
       [í‘¸í„°/íšŒì‚¬ì •ë³´ ìŠ¤íƒ€ì¼ ì¶”ê°€]
       ========================================= */
    .footer-wrap {
        width: 100%;
        background: #f9fafb;
        border-top: 1px solid #e5e7eb;
        padding: 40px 20px;
        margin-top: 50px;
        color: #4b5563;
        font-size: 13px;
    }
    .footer-inner {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        flex-wrap: wrap;
        gap: 30px;
        justify-content: space-between;
    }
    .foot-menu ul {
        list-style: none; padding: 0; margin: 0 0 20px 0; display: flex; gap: 20px;
    }
    .foot-menu a { text-decoration: none; color: #374151; font-weight: 600; }
    .foot-menu a:hover { color: var(--primary); }
    
    .foot-info dl { display: flex; flex-wrap: wrap; margin: 5px 0; gap: 5px; }
    .foot-info dt { font-weight: 700; color: #111; }
    .foot-info dd { color: #666; margin: 0; margin-right: 10px; }
    .copyright { margin-top: 15px; color: #9ca3af; font-size: 12px; }
    
    .cs-center h3 { margin: 0 0 10px 0; font-size: 16px; color: #111; }
    .cs-center strong { font-size: 24px; color: var(--primary); display: block; margin-bottom: 5px; }
    .cs-center p { margin: 0; line-height: 1.5; color: #666; }

    @media (max-width: 768px) {
        .footer-inner { flex-direction: column; gap: 20px; }
        .foot-menu ul { flex-wrap: wrap; gap: 10px; }
    }
    /* =========================================
   [ì…ë ¥ì°½ í„°ì¹˜/ì„ íƒ ì˜¤ë¥˜ ë°©ì§€]
   ========================================= */
input, textarea, select {
    user-select: text !important;        /* í…ìŠ¤íŠ¸ ì„ íƒ í—ˆìš© */
    -webkit-user-select: text !important; /* ì‚¬íŒŒë¦¬/í¬ë¡¬ í˜¸í™˜ */
    touch-action: manipulation !important; /* í„°ì¹˜ ë™ì‘ ìµœì í™” */
}
/* =========================================
   [ëª¨ë°”ì¼ ìµœì í™” ìµœì¢… ì™„ì„±ë³¸ (V3)]
   ê¸°ì¡´ media query ì „ì²´ë¥¼ ì´ ì½”ë“œë¡œ ë®ì–´ì”Œìš°ì„¸ìš”.
   ========================================= */
@media (max-width: 768px) {

    /* [1] ìƒë‹¨ ë©”ë‰´ë°” (Topbar) - ë²„íŠ¼ ë³µêµ¬ ë° ê°€ë¡œ ìŠ¤í¬ë¡¤ */
    .topbar {
        display: flex !important;
        align-items: center !important;
        justify-content: flex-start !important; /* ì™¼ìª½ë¶€í„° ì •ë ¬ */
        gap: 8px !important;
        padding: 0 10px !important;
        overflow-x: auto !important; /* ë²„íŠ¼ ë§ìœ¼ë©´ ìŠ¤í¬ë¡¤ */
        white-space: nowrap !important;
        height: 50px !important;
        background: #fff !important;
    }
    .topbar::-webkit-scrollbar { display: none; } /* ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¹€ */

    /* 1. ë¡œê³  */
    .brand { 
        order: 1 !important; 
        margin-right: 5px !important; 
        flex-shrink: 0 !important;
    }

    /* 2. ì¥ë°”êµ¬ë‹ˆ (ì•„ì´ì½˜ë§Œ í‘œì‹œ) */
    #btnViewCart {
        order: 2 !important;
        display: inline-flex !important;
        font-size: 0 !important;
        padding: 0 10px !important;
        flex-shrink: 0 !important;
        width: 40px !important; /* í„°ì¹˜ ì˜ì—­ í™•ë³´ */
        justify-content: center !important;
    }
    #btnViewCart::before {
        content: 'ğŸ›’';
        font-size: 18px !important;
    }

    /* 3. ë¡œê·¸ì¸ ë²„íŠ¼ */
    #btnLoginBtn { 
        order: 3 !important; 
        flex-shrink: 0 !important; 
        padding: 8px 12px !important;
    }

    /* 4. [í•´ê²°] í…œí”Œë¦¿ ë²„íŠ¼ (ì»¨í…Œì´ë„ˆ ë° ë²„íŠ¼ ê°•ì œ í‘œì‹œ) */
    .template-tabs {
        order: 4 !important;
        display: flex !important;
        flex-shrink: 0 !important;
        margin: 0 5px !important;
        opacity: 1 !important;
        visibility: visible !important;
    }
    /* ëª¨ë°”ì¼ìš© í…œí”Œë¦¿ ë²„íŠ¼ ë””ìì¸ */
    #btnMobileTemplateOpen {
        display: flex !important;
        align-items: center !important;
        height: 34px !important;
        padding: 0 12px !important;
        background: #eff6ff !important;
        color: #6366f1 !important;
        border: 1px solid #6366f1 !important;
        border-radius: 8px !important;
        font-weight: 700 !important;
        font-size: 13px !important;
        white-space: nowrap !important;
    }
    .tpl-tab { display: none !important; } /* PCìš© íƒ­ ìˆ¨ê¹€ */

    /* 5. ì£¼ë¬¸í•˜ê¸° & ì €ì¥í•˜ê¸° */
    #btnOrderTop { order: 5 !important; flex-shrink: 0 !important; }
    .btn-save-top { order: 6 !important; flex-shrink: 0 !important; }

    /* ë¹ˆ ê³µê°„ ì±„ìš°ê¸°ìš© div ìˆ¨ê¹€ */
    .topbar > div[style*="flex:1"] { display: none !important; }


    /* [2] ì—ë””í„° í™”ë©´ (ì¢Œìš° íŒ¨ë„ ì •ë¦¬) */
    .editor-wrap {
        display: flex !important;
        flex-direction: column !important;
        width: 100vw !important;
        height: calc(100vh - 50px) !important;
        overflow: hidden !important;
    }
    .stage {
        order: 1 !important;
        width: 100% !important;
        height: 50% !important;
        border-bottom: 2px solid #ddd;
        position: relative !important;
    }
    .right-stack { display: none !important; } 
    .side {
        order: 2 !important;
        width: 100% !important;
        height: 50% !important;
        padding: 15px !important;
        overflow-y: auto !important;
        background: #fff !important;
        border-right: none !important;
    }

    /* [3] í…œí”Œë¦¿ í™”ë©´ (ì¹´í…Œê³ ë¦¬ ì˜ë¦¼ í•´ê²°) */
    .tpl-modal-box {
        width: 100% !important; height: 100% !important;
        border-radius: 0 !important; flex-direction: column !important;
        display: flex !important; overflow: hidden !important;
    }
    .tpl-sidebar {
        flex-direction: row !important; height: auto !important;
        padding: 10px 10px 10px 15px !important; 
        padding-right: 40px !important; /* ìš°ì¸¡ ì—¬ë°± */
        overflow-x: auto !important; white-space: nowrap !important;
        border-right: none !important; border-bottom: 1px solid #eee;
        flex-shrink: 0 !important; width: 100% !important;
        box-sizing: border-box !important;
    }
    .tpl-cate-btn {
        margin-right: 10px !important; flex: 0 0 auto !important;
        background: #f1f5f9; padding: 8px 15px !important; border-radius: 20px !important;
    }
    .tpl-content { display: flex !important; flex-direction: column !important; height: 100% !important; overflow: hidden !important; }
    .tpl-content > div:first-child { display: flex !important; align-items: center !important; padding: 10px 15px !important; flex-shrink: 0 !important; }
    #tplSearchInput { width: auto !important; flex: 1 !important; margin-bottom: 0 !important; }
    .tpl-grid { flex: 1 !important; overflow-y: auto !important; column-count: 2 !important; padding: 10px !important; }
    .tpl-content > div:last-child { flex-shrink: 0 !important; padding: 15px !important; background: #fff; border-top: 1px solid #e2e8f0; z-index: 20 !important; }
    #btnUseTpl { width: 100% !important; height: 50px !important; font-size: 16px !important; font-weight: bold !important; }

    /* [4] ì¥ë°”êµ¬ë‹ˆ í™”ë©´ (ê°€ê²© í…ìŠ¤íŠ¸ ìœ„ì¹˜ ì¡°ì •) */
    #cartPage { padding-top: 50px !important; background: #f1f5f9 !important; }
    #cartPage > div { display: flex !important; flex-direction: column !important; padding: 0 !important; height: 100% !important; }
    #cartPage > div > div { display: block !important; height: 100% !important; }
    #cartListArea { height: auto !important; max-height: none !important; padding: 15px 15px 280px 15px !important; overflow-y: auto !important; }

    .cart-item {
        display: flex !important; flex-direction: column !important;
        padding: 20px !important; background: #fff !important;
        border-radius: 16px !important; margin-bottom: 20px !important;
        position: relative !important;
    }
    .cart-item > div:nth-child(2) { order: 1 !important; margin-bottom: 20px !important; width: 100% !important; }
    .cart-item > div:nth-child(2) > div:first-child { display: block !important; width: 100% !important; margin-bottom: 10px !important; text-align: left !important; }
    
    .cart-item > div:first-child {
        order: 2 !important; margin-bottom: 15px !important;
        padding-top: 15px !important; border-top: 1px solid #f3f4f6;
        display: flex !important; align-items: flex-start !important;
    }
    .cart-item > div:first-child > div { display: flex !important; flex-direction: column !important; justify-content: flex-start !important; padding-left: 5px !important; }
    .cart-item > div:first-child > div > div:last-child { margin-top: 15px !important; font-size: 16px !important; display: block !important; }
    
    .cart-item > div:last-child { order: 3 !important; width: 100% !important; }
    #cartPage > div > div > div:last-child { position: fixed !important; bottom: 0 !important; left: 0 !important; width: 100% !important; background: #fff !important; padding: 20px !important; z-index: 12500 !important; border-radius: 20px 20px 0 0 !important; box-shadow: 0 -5px 10px rgba(0,0,0,0.05) !important; }

    
    /* ê¸°íƒ€ */
    .hero-title { font-size: 26px !important; word-break: keep-all; }
    .quick-menu-track { grid-template-columns: repeat(2, 1fr) !important; }
    .template-grid-start { column-count: 2 !important; }
    #startScreen { padding-top: 20px !important; }
    .bottom-dock { display: none !important; }
}
/* =========================================
   [ëª¨ë°”ì¼ í…ìŠ¤íŠ¸ ì—ë””í„° ìŠ¤íƒ€ì¼]
   ========================================= */
#mobileTextEditor {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 140px; /* í‚¤ë³´ë“œ ìœ„ ê³µê°„ í™•ë³´ */
    background: #fff;
    z-index: 999999; /* ìµœìƒìœ„ ë…¸ì¶œ */
    padding: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
    gap: 10px;
}
.m-text-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: bold;
    color: #333;
}
#mobileTextInput {
    width: 100%;
    flex: 1;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 10px;
    font-size: 16px;
    outline: none;
    resize: none;
    font-family: inherit;
}
#mobileTextInput:focus {
    border-color: #6366f1;
}
</style>
</head>
<script>
    // [ì¥ë°”êµ¬ë‹ˆ ë Œë”ë§ í•¨ìˆ˜]
    // ì´ í•¨ìˆ˜ê°€ ìˆì–´ì•¼ ì¥ë°”êµ¬ë‹ˆ ë‚´ìš©ê³¼ ì˜µì…˜ì°½ì´ ì˜¬ë°”ë¥´ê²Œ ë³´ì…ë‹ˆë‹¤.
    window.renderCartList = function() {
        const cartArea = document.getElementById('cartListArea');
        if(!cartArea) return;
        
        // ì¥ë°”êµ¬ë‹ˆ ë°ì´í„° (ì—†ìœ¼ë©´ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì‚¬ìš©)
        const items = window.cartItems || [
            {productName: 'A3 ê¸°ë³¸ í¬ìŠ¤í„° (ì˜ˆì‹œ)', price: 15000, qty: 1, thumb: 'https://via.placeholder.com/150'}
        ]; 
        
        cartArea.innerHTML = ''; // ì´ˆê¸°í™”

        // 1. ì¥ë°”êµ¬ë‹ˆ ë¹„ì—ˆì„ ë•Œ
        if (items.length === 0) {
            cartArea.innerHTML = `
                <div style="text-align:center; padding:50px; color:#999;">
                    <i class="fa-solid fa-cart-shopping" style="font-size:48px; margin-bottom:15px;"></i>
                    <p>ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</p>
                </div>`;
            updateSummary(0);
            return;
        }

        let total = 0;

        // 2. ì•„ì´í…œ ë°˜ë³µ ìƒì„±
        items.forEach((item, index) => {
            const itemPrice = (item.price || 0) * (item.qty || 1);
            total += itemPrice;

            const div = document.createElement('div');
            div.className = 'cart-item';
            // ëª¨ë°”ì¼ì—ì„œ ì˜ ë³´ì´ë„ë¡ ìŠ¤íƒ€ì¼(Flex Column) ì ìš©
            div.innerHTML = `
                <div style="display:flex; gap:15px; align-items:center;">
                    <img src="${item.thumb}" style="width:80px; height:80px; object-fit:cover; border-radius:8px; border:1px solid #eee;">
                    <div style="flex:1;">
                        <div style="font-weight:bold; font-size:16px;">${item.productName}</div>
                        <div style="color:#6366f1; font-weight:bold; margin-top:4px;">${itemPrice.toLocaleString()}ì›</div>
                    </div>
                </div>
                
                <div style="background:#f8fafc; padding:10px; border-radius:8px; margin-top:10px; border:1px solid #eee;">
                    <div style="font-size:13px; color:#ef4444; font-weight:bold; margin-bottom:5px;">
                        <i class="fa-solid fa-check"></i> í•„ìˆ˜ ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”
                    </div>
                    <select style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; margin-bottom:5px; background:#fff;">
                        <option>ê¸°ë³¸ ì†Œì¬</option>
                        <option>ê³ ê¸‰ í¬ë§¥ìŠ¤ (+5,000ì›)</option>
                    </select>
                    <select style="width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; background:#fff;">
                        <option>í›„ê°€ê³µ ì—†ìŒ</option>
                        <option>ì½”íŒ… ì¶”ê°€ (+2,000ì›)</option>
                    </select>
                </div>

                <div style="display:flex; justify-content:space-between; align-items:center; margin-top:10px;">
                    <div style="display:flex; align-items:center; border:1px solid #ddd; border-radius:6px; background:#fff;">
                        <button onclick="updateQty(${index}, -1)" style="padding:5px 12px; border:none; background:none;">-</button>
                        <span style="font-weight:bold; padding:0 5px;">${item.qty}</span>
                        <button onclick="updateQty(${index}, 1)" style="padding:5px 12px; border:none; background:none;">+</button>
                    </div>
                    <button onclick="removeCartItem(${index})" style="padding:6px 12px; border:1px solid #ef4444; color:#ef4444; background:#fff; border-radius:6px; font-size:12px;">ì‚­ì œ</button>
                </div>
            `;
            cartArea.appendChild(div);
        });

        updateSummary(total);
    };

    function updateSummary(total) {
        const totalElem = document.getElementById('summaryTotal');
        if(totalElem) totalElem.innerText = total.toLocaleString() + 'ì›';
        
        const countElem = document.getElementById('cartCount');
        if(countElem) countElem.innerText = window.cartItems ? window.cartItems.length : 0;
    }

    // ë”ë¯¸ í•¨ìˆ˜ë“¤ (ì‹¤ì œ ë¡œì§ ì—°ê²° í•„ìš”)
    window.updateQty = (i, d) => { console.log('ìˆ˜ëŸ‰ë³€ê²½', i, d); };
    window.removeCartItem = (i) => { console.log('ì‚­ì œ', i); document.getElementById('cartPage').style.display='none'; };
</script>
<body>
<div id="loading"><div class="loading-spin"></div><p style="margin-top:15px; font-weight:600;">ë¡œë”© ì¤‘ì…ë‹ˆë‹¤...</p></div>

<div id="contextMenu">
    <div class="ctx-item" id="ctxUndo"><i class="fa-solid fa-rotate-left"></i> ì‹¤í–‰ ì·¨ì†Œ</div>
    <div class="ctx-item" id="ctxRedo"><i class="fa-solid fa-rotate-right"></i> ë‹¤ì‹œ ì‹¤í–‰</div>
    <div class="ctx-divider"></div>
    <div class="ctx-item" id="ctxCopy"><i class="fa-regular fa-copy"></i> ë³µì‚¬í•˜ê¸°</div>
    <div class="ctx-item" id="ctxPaste"><i class="fa-regular fa-paste"></i> ë¶™ì—¬ë„£ê¸°</div>
    <div class="ctx-item" id="ctxDelete" style="color:#ef4444;"><i class="fa-solid fa-trash"></i> ì‚­ì œí•˜ê¸°</div>
    <div class="ctx-divider"></div>
    <div class="ctx-item" id="ctxFront"><i class="fa-solid fa-arrow-up-from-bracket"></i> ë§¨ ì•ìœ¼ë¡œ</div>
    <div class="ctx-item" id="ctxBack"><i class="fa-solid fa-arrow-down-from-bracket"></i> ë§¨ ë’¤ë¡œ</div>
    <div class="ctx-divider"></div>
    <div class="ctx-item" id="ctxLock"><i class="fa-solid fa-lock"></i> ì ê¸ˆ (Lock)</div>
</div>

<div id="startScreen">
    <div class="hero-section">
        <h1 class="hero-title">í–‰ì‚¬ ì¤€ë¹„í•˜ì„¸ìš”? <br><span>ì¹´ë©œë ˆì˜¨</span>ê³¼ í•¨ê»˜í•´ìš”.</h1>
        <p class="hero-desc">í–‰ì‚¬ íŒì—…ìŠ¤í† ì–´ ê¸°íšìë¥¼ ìœ„í•œ ë„ë§¤ ì‡¼í•‘ëª°, ê°•ë ¥í•œ ë¬´ë£Œì—ë””í„°, í—ˆë‹ˆì½¤ë³´ë“œ íŒë§¤ 1ìœ„.</p>
    </div>

    <div class="quick-menu-wrapper">
        <div class="quick-menu-label">ë§ì¶¤í˜• ë””ìì¸ ì‹œì‘í•˜ê¸°</div>
        <div class="quick-menu-track" id="quickMenuContainer">
            </div>
    </div>
    
    <div class="gallery-section">
        <div class="gallery-header">âœ¨ ì¸ê¸° í…œí”Œë¦¿ ì‚´í´ë³´ê¸°</div>
        <div id="startTemplateGrid" class="template-grid-start"></div>
    </div>
    <div class="footer-wrap">
        <div class="footer-inner">
            <div class="foot-left">
                <div class="foot-menu">
                    <ul>
                        <li><a href="#">íšŒì‚¬ì†Œê°œ</a></li>
                        <li><a href="#">ê³µì§€ì‚¬í•­</a></li>
                        <li><a href="#">ì´ìš©ì•½ê´€</a></li>
                        <li><a href="#"><strong>ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</strong></a></li>
                    </ul>
                </div>
                <div class="foot-info">
                    <dl>
                        <dt>ìƒí˜¸ëª… :</dt><dd>(ì£¼)ì¹´ë©œë ˆì˜¨í”„ë¦°íŒ…</dd>
                        <dt>ëŒ€í‘œ :</dt><dd>ì¡°ì¬í˜¸</dd>
                    </dl>
                    <dl>
                        <dt>ì£¼ì†Œ :</dt><dd>ê²½ê¸°ë„ í™”ì„±ì‹œ ìš°ì •ì í•œë§ê¸¸ 72-2</dd>
                    </dl>
                    <dl>
                        <dt>ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ :</dt><dd>470-81-02808</dd>
                        <dt>í†µì‹ íŒë§¤ì—…ì‹ ê³ ë²ˆí˜¸ :</dt><dd>2025-í™”ì„±ìš°ì •-0033</dd>
                    </dl>
                    <dl>
                        <dt>ê°œì¸ì •ë³´ê´€ë¦¬ì :</dt><dd>ë³€ì§€ì›…</dd>
                    </dl>
                    <p class="copyright">Copyright Â© <strong>Chameleon Canvas</strong>. all rights reserved.</p>
                </div>
            </div>

            <div class="cs-center">
                <h3>ê³ ê°ì„¼í„° (CS CENTER)</h3>
                <strong>031-366-1984</strong>
                <p>
                    í‰ì¼ 09:00 ~ 18:00 <br>
                    ì ì‹¬ 12:00 ~ 13:00 <br>
                    <span>* ì£¼ë§ ë° ê³µíœ´ì¼ íœ´ë¬´</span>
                </p>
            </div>
        </div>
    </div>
    </div>
</div>

<div id="mainEditor">
    <div class="topbar">
        <div class="brand" onclick="location.reload()"><i class="fa-solid fa-palette"></i> Chameleon</div>
        <div class="template-tabs">
            <button id="btnMobileTemplateOpen" onclick="document.getElementById('templateOverlay').style.display='flex'">ğŸ¨ í…œí”Œë¦¿</button>
            <!-- <button class="tpl-tab" data-tpl="text">í—ˆë‹ˆì½¤ë³´ë“œì „ìš©</button> -->
            <button class="tpl-tab" data-tpl="vector">ì‹¬í”Œë°±í„°ë°°ê²½</button>
            <button class="tpl-tab" data-tpl="graphic">ë°±í„°íƒ¬í”Œë¦¿</button>
            <button class="tpl-tab" data-tpl="photo-bg">ì‚¬ì§„í…œí”Œë¦¿[A2ì´í•˜ê¹Œì§€]</button>
            <button class="tpl-tab" data-tpl="transparent-graphic">íŒ¨ë¸Œë¦­íŒ¨í„´</button>
        </div> 
        <div style="flex:1;"></div>
        <button class="btn" id="btnViewCart" onclick="document.getElementById('cartPage').style.display='block'" style="margin-right:5px;">ğŸ›’ ì¥ë°”êµ¬ë‹ˆ</button>
        <button class="btn" id="btnMyLibrary" style="display:none; margin-right:5px;">ğŸ“‚ ë³´ê´€í•¨</button>
        <button class="btn primary" id="btnOrderTop">ğŸš€ ì£¼ë¬¸í•˜ê¸°</button>
        <button class="btn btn-save-top" id="btnPNG"><i class="fa-solid fa-download"></i> <span>ì´ë¯¸ì§€ ì €ì¥</span></button>
        <button class="btn" id="btnLoginBtn">ë¡œê·¸ì¸</button>
    </div>

    <div id="wallHeightControls">
        <div class="wall-label"><i class="fa-solid fa-ruler-vertical"></i> ë²½ ë†’ì´</div>
        <button class="height-btn active" onclick="window.setWallHeight(2200, this)">220cm</button>
        <button class="height-btn" onclick="window.setWallHeight(2400, this)">240cm</button>
        <button class="height-btn" onclick="window.setWallHeight(3000, this)">300cm</button>
    </div>

    <div class="editor-wrap">
        <div class="side" id="toolsPanel">
            <div style="display:flex; gap:5px; margin-bottom:10px;">
                <button id="btnChangeSize" class="btn-round" style="flex:1;"><i class="fa-solid fa-ruler-combined"></i> ì‚¬ì´ì¦ˆ ë³€ê²½</button>
                <button id="btnRotateCanvas" class="btn-round" style="flex:1;"><i class="fa-solid fa-rotate"></i> ìº”ë²„ìŠ¤ íšŒì „</button>
            </div>
            <div id="sizeTogglePanel" style="display:none; grid-template-columns: 1fr; gap:5px; margin-bottom:15px; padding:10px; background:#f8fafc; border-radius:10px; border:1px solid #e2e8f0;"></div>
            
            <div class="section-title">CANVAS TOOLS</div>
            <div style="display:flex; gap:5px; margin-bottom:10px;">
                <button id="btnFitScreen" class="btn-round" title="í™”ë©´ì— ë§ì¶”ê¸°"><i class="fa-solid fa-compress"></i> í™”ë©´ ë§ì¶¤</button>
                <button id="btnLockSelection" class="btn-round" onclick="window.toggleLockSelection()"><i class="fa-solid fa-lock"></i> ì„ íƒ ì ê¸ˆ</button>
            </div>

            <div class="section-title">AI TOOLS</div>
            <button class="btn-round ai-red" id="btnAIBox"><i class="fa-solid fa-wand-magic-sparkles"></i> AI ì´ë¯¸ì§€ ìƒì„±</button>
            <button class="btn-round primary" id="btnRegisterTemplate" style="margin-top:5px; display:none;">ğŸ‘‘ ë””ìì¸ ë“±ë¡</button>
            <button class="btn-round" id="btnOpenSaveModal" style="margin-top:5px;">ğŸ’¾ ë””ìì¸ ì €ì¥</button>
            
            <div class="section-title">BASIC TOOLS</div>
            <button class="btn-round" id="btnAddText">+ í…ìŠ¤íŠ¸ ì¶”ê°€</button>
            <button class="btn-round" id="btnFontSelect" style="margin-top:5px;">ğŸ…°ï¸ í°íŠ¸ ë³€ê²½</button>
            <div class="color-group"><span>ë©´ ìƒ‰ìƒ</span><input id="fillColor" type="color" class="color-picker" value="#000000"></div>
            <div class="color-group" style="margin-top:5px;"><span>ì„  ìƒ‰ìƒ</span><input id="strokeColor" type="color" class="color-picker" value="#000000"></div>
            
            <div class="section-title">SHAPES</div>
            <div class="shape-panel">
                <button class="shape-btn" data-shape="rect">â– </button>
                <button class="shape-btn" data-shape="circle">â—</button>
                <button class="shape-btn" data-shape="triangle">â–²</button>
                <button class="shape-btn" data-shape="star">â˜…</button>
                <button class="shape-btn" data-shape="heart">â™¥</button>
                <button class="shape-btn" data-shape="arrow">â¡</button>
                <button class="shape-btn" data-shape="round">â–¢</button>
                <button class="shape-btn" data-shape="line">â”</button>
            </div>
            
            <div class="section-title">UPLOAD</div>
            <label class="upload-box" for="imgUpload"><span style="font-size:24px; margin-bottom:5px;"><i class="fa-solid fa-cloud-arrow-up"></i></span>ì´ë¯¸ì§€ / PDF ì—…ë¡œë“œ</label>
            <input id="imgUpload" type="file" accept="image/*,.svg,.pdf" style="display:none;">
        </div>
        
        <div class="stage" id="stage">
            <div class="bottom-dock">
                <button id="btnZoomOut" class="zoom-btn"><i class="fa-solid fa-minus"></i></button>
                <button id="btnZoomIn" class="zoom-btn"><i class="fa-solid fa-plus"></i></button>
                <div class="divider"></div>
                <button id="guideToggle" class="zoom-btn" style="width:auto; padding:0 15px; border-radius:20px; font-size:12px;">ê°€ì´ë“œ ì¼œê¸°</button>
                <span class="help-text">Space: í™”ë©´ì´ë™ / íœ : í¬ê¸°ì¡°ì ˆ / ë°©í–¥í‚¤: ë¯¸ì„¸ì´ë™</span>
            </div>
            
            <div class="right-stack" id="rightStackPanel">
                <div class="panel-box" id="panelEdit">
                    <div class="section-title" style="margin-top:0;">í¸ì§‘ & ë ˆì´ì–´</div>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px; margin-bottom:5px;">
                        <button class="tool-btn" id="btnUndo"><i class="fa-solid fa-rotate-left"></i> ì‹¤í–‰ì·¨ì†Œ</button>
                        <button class="tool-btn" id="btnRedo"><i class="fa-solid fa-rotate-right"></i> ë‹¤ì‹œì‹¤í–‰</button>
                        <button class="tool-btn" id="btnCopy"><i class="fa-regular fa-copy"></i> ë³µì‚¬</button>
                        <button class="tool-btn" id="btnPaste"><i class="fa-regular fa-paste"></i> ë¶™ì—¬ë„£ê¸°</button>
                    </div>
                    
                    <div style="display:flex; gap:5px; margin-bottom:5px;">
                        <button class="tool-btn" id="btnRotateLeft15"><i class="fa-solid fa-rotate-left"></i> -15Â°</button>
                        <button class="tool-btn" id="btnRotateRight15"><i class="fa-solid fa-rotate-right"></i> +15Â°</button>
                    </div>

                    <div style="display:flex; gap:5px; margin-bottom:5px;">
                        <button class="tool-btn" id="btnFront">ë§¨ì•</button>
                        <button class="tool-btn" id="btnBack">ë§¨ë’¤</button>
                        <button class="tool-btn" id="btnDel" style="color:red;">ì‚­ì œ</button>
                    </div>
                    
                    <div class="section-title" style="margin-top:10px;">ê°ì²´ ì •ë ¬</div>
                    <div class="align-grid">
                        <button class="align-btn" id="btnAlignLeft"><i class="fa-solid fa-align-left"></i></button>
                        <button class="align-btn" id="btnAlignCenterH"><i class="fa-solid fa-arrows-left-right-to-line"></i></button>
                        <button class="align-btn" id="btnAlignRight"><i class="fa-solid fa-align-right"></i></button>
                        <button class="align-btn" id="btnAlignTop"><i class="fa-solid fa-align-left" style="transform:rotate(90deg)"></i></button>
                        <button class="align-btn" id="btnAlignMiddle"><i class="fa-solid fa-arrows-up-down-left-right"></i></button>
                        <button class="align-btn" id="btnAlignBottom"><i class="fa-solid fa-align-right" style="transform:rotate(90deg)"></i></button>
                    </div>
                    <button class="btn-round" id="btnCenterObject" onclick="window.alignObject('center')" style="margin-top:5px;">ğŸ¯ ì •ì¤‘ì•™ ì •ë ¬</button>
                    <button class="btn-round" onclick="window.setAsBackground()" style="margin-top:5px;">ğŸ–¼ ë°°ê²½ìœ¼ë¡œ ê½‰ ì±„ìš°ê¸°</button>
                </div>
                
                <div class="panel-box" id="panelText">
                    <div class="section-title" style="margin-top:0;">í…ìŠ¤íŠ¸ ì„¤ì •</div>
                    <div style="display:flex; gap:5px; margin-bottom:10px;">
                        <button class="tool-btn" id="btnAlignLeftText"><i class="fa-solid fa-align-left"></i></button>
                        <button class="tool-btn" id="btnAlignCenterText"><i class="fa-solid fa-align-center"></i></button>
                        <button class="tool-btn" id="btnAlignRightText"><i class="fa-solid fa-align-right"></i></button>
                    </div>
                    <div style="display:grid; grid-template-columns: 35px 1fr; gap:10px; align-items:center; margin-bottom:5px;">
                        <span style="font-size:12px; color:#666;">í¬ê¸°</span><input type="range" id="textSize" min="10" max="200" value="50" style="width:100%;">
                    </div>
                    <div style="display:grid; grid-template-columns: 35px 1fr; gap:10px; align-items:center; margin-bottom:5px;">
                        <span style="font-size:12px; color:#666;">ìê°„</span><input type="range" id="textCharSpacing" min="-100" max="500" value="50" style="width:100%;">
                    </div>
                    <div style="display:grid; grid-template-columns: 35px 1fr; gap:10px; align-items:center;">
                        <span style="font-size:12px; color:#666;">í–‰ê°„</span><input type="range" id="textLineHeight" min="0.5" max="3.0" step="0.1" value="1.2" style="width:100%;">
                    </div>
                </div>
                
                <div class="panel-box">
                    <div class="section-title" style="margin-top:0; color:#333;">AI ì´ë¯¸ì§€ ë„êµ¬</div>
                    <div class="ai-tool-stack">
                        <button class="tool-btn" id="btnCutout">âœ‚ï¸ ë°°ê²½ ì œê±°</button>
                        <button class="tool-btn" id="btnEnhance">âœ¨ ë°ê²Œ ë³´ì •</button>
                        <button class="tool-btn" id="btnOutline">ğŸ”² ê¸€ì í…Œë‘ë¦¬</button>
                    </div>
                    <div class="section-title">ì„  ì„¤ì •</div>
                    <input type="range" id="globalStroke" min="0" max="30" value="2" style="width:100%;">
                    
                    <div style="display:flex; gap:5px; margin-top:5px;">
                        <button class="tool-btn" id="btnStrokeMiter" title="ê°ì§€ê²Œ"><i class="fa-solid fa-square"></i> ê°ì§€ê²Œ</button>
                        <button class="tool-btn" id="btnStrokeRound" title="ë¶€ë“œëŸ½ê²Œ"><i class="fa-solid fa-circle"></i> ë‘¥ê¸€ê²Œ</button>
                    </div>

                    <div class="section-title">íˆ¬ëª…ë„</div><input type="range" id="opacitySlider" min="0" max="100" value="100" style="width:100%;">
                </div>
            </div>
            <canvas id="designCanvas"></canvas>
        </div>
    </div>
</div>
<div id="sizeSelectModal" class="modal-bg" style="z-index: 15000;">
    <div class="modal-box" style="width: 800px; max-width: 95%;">
        <h3>ğŸ“ ì–´ë–¤ í¬ê¸°ë¡œ ë§Œë“œì‹œê² ìŠµë‹ˆê¹Œ?</h3>
        <p style="margin-bottom:20px; color:#666;">ì„ íƒí•œ ì œí’ˆ í¬ê¸°ì— ë§ì¶° í…œí”Œë¦¿ì´ ìë™ìœ¼ë¡œ ì¡°ì ˆë©ë‹ˆë‹¤.</p>
        
        <div id="productSelectGrid" class="quick-menu-track" style="grid-template-columns: repeat(4, 1fr);"></div>
        
        <button onclick="document.getElementById('sizeSelectModal').style.display='none'" class="btn-round" style="margin-top:20px;">ì·¨ì†Œ</button>
    </div>
</div>
<div id="aiDrawer" class="ai-drawer"><h3>âœ¨ AI ì´ë¯¸ì§€ ìƒì„±</h3><p class="label">ì„¤ëª… (Prompt)</p><textarea id="aiPrompt" class="ai-input-pretty" placeholder="ì˜ˆ: ìˆ²ì†ì— ì•‰ì•„ìˆëŠ” ê·€ì—¬ìš´ ê°ˆìƒ‰ í† ë¼" style="height:100px;"></textarea><button id="aiGenerateBtn" class="btn-round primary" style="margin-top:10px;">ìƒì„±í•˜ê¸°</button><div id="aiResultArea" style="min-height:200px; background:#f9f9f9; margin-top:20px; display:flex; justify-content:center; align-items:center;"><span style="color:#ccc;">ê²°ê³¼ ëŒ€ê¸° ì¤‘</span></div><button id="aiUseBtn" class="btn-round" style="display:none; margin-top:10px;">ìº”ë²„ìŠ¤ì— ë„£ê¸°</button><button onclick="document.getElementById('aiDrawer').classList.remove('open')" class="btn-round" style="margin-top:10px;">ë‹«ê¸°</button></div>
<div id="templateOverlay">
    <div class="tpl-modal-box">
        <div class="tpl-sidebar">
            <div class="tpl-cate-title">CATEGORIES</div>
            <button class="tpl-cate-btn active" onclick="window.filterTpl('all', this)"><span>ì „ì²´ ë³´ê¸°</span></button>
            <button class="tpl-cate-btn" onclick="window.filterTpl('vector', this)"><span>ì‹¬í”Œë°±í„°ë°°ê²½</span></button>
            <button class="tpl-cate-btn" onclick="window.filterTpl('photo-bg', this)"><span>ì‚¬ì§„í…œí”Œë¦¿</span></button>
            
            <button class="tpl-cate-btn" onclick="window.filterTpl('text', this)" style="display:none;"><span>ì¤€ë¹„ì¤‘ì…ë‹ˆë‹¤.</span></button>
            
            <button class="tpl-cate-btn" onclick="window.filterTpl('graphic', this)"><span>ë°±í„°í…œí”Œë¦¿</span></button>
            
            <button class="tpl-cate-btn" onclick="window.filterTpl('transparent-graphic', this)"><span>íŒ¨ë¸Œë¦­íŒ¨í„´</span></button>
        </div>
        <div class="tpl-content">
            <div style="padding: 20px 30px; border-bottom: 1px solid #f1f5f9; display: flex; align-items: center; justify-content: space-between;">
                <h2 style="margin:0;">í…œí”Œë¦¿ íƒìƒ‰</h2>
                <input type="text" id="tplSearchInput" class="ai-input-pretty" style="width:300px; margin-bottom:0;" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥...">
                <button onclick="document.getElementById('templateOverlay').style.display='none'" style="border:none; background:none; cursor:pointer;">
                    <i class="fa-solid fa-xmark fa-2x"></i>
                </button>
            </div>
            <div id="tplGrid" class="tpl-grid"></div>
            <div style="padding:15px; text-align:right; border-top:1px solid #eee;">
                <button id="btnUseTpl" class="btn primary">ì„ íƒí•œ í…œí”Œë¦¿ ì ìš©</button>
            </div>
        </div>
    </div>
</div>
<div id="libraryModal" class="modal-bg" style="z-index: 11000;"><div class="modal-box" style="width: 800px; max-width: 90%; height: 80%; display: flex; flex-direction: column;"><div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;"><h3 style="margin:0;">ğŸ“‚ ë‚´ ë””ìì¸ ë³´ê´€í•¨</h3><button onclick="document.getElementById('libraryModal').style.display='none'" style="border:none; background:none; cursor:pointer; font-size:20px;">âœ•</button></div><div id="myDesignGrid" style="flex:1; overflow-y:auto; display:grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap:20px; padding:10px;"></div></div></div>
<div id="saveDesignModal" class="modal-bg" style="z-index: 11001;"><div class="modal-box"><h3>ğŸ’¾ ë””ìì¸ ì €ì¥í•˜ê¸°</h3><p style="font-size:13px; color:#666;">ë³´ê´€í•¨ì— ì €ì¥í•˜ì—¬ ë‚˜ì¤‘ì— ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><input id="saveDesignTitle" class="ai-input-pretty" placeholder="ë””ìì¸ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì—¬ë¦„ ì´ë²¤íŠ¸ ë°°ë„ˆ)"><div style="display:flex; gap:10px; margin-top:20px;"><button id="btnConfirmSave" class="btn-round primary">ì €ì¥í•˜ê¸°</button><button onclick="document.getElementById('saveDesignModal').style.display='none'" class="btn-round">ì·¨ì†Œ</button></div></div></div>
<div id="loadModeModal" class="modal-bg" style="z-index: 10001;"><div class="modal-box" style="width: 450px;"><h3>ğŸ¨ í…œí”Œë¦¿ ë¶ˆëŸ¬ì˜¤ê¸°</h3><p style="color:#666; font-size:14px; margin-bottom:20px;">í˜„ì¬ ìº”ë²„ìŠ¤ ë‚´ìš©ì´ ìˆìŠµë‹ˆë‹¤.</p><div style="display:flex; gap:10px;"><button id="btnLoadReplace" class="btn-round ai-red" style="height:100px;">ìƒˆ ì‘ì—…ìœ¼ë¡œ<br>(ê¸°ì¡´ ì‚­ì œ)</button><button id="btnLoadAdd" class="btn-round primary" style="height:100px;">í˜„ì¬ ì‘ì—…ì—<br>ì¶”ê°€í•˜ê¸°</button></div><button onclick="document.getElementById('loadModeModal').style.display='none'" class="btn-round" style="margin-top:15px;">ì·¨ì†Œ</button></div></div>
<div id="loginModal" class="modal-bg" style="z-index: 10002;"><div class="modal-box" style="width: 400px;"><h3 id="authTitle" style="margin-top:0;">ë¡œê·¸ì¸</h3><div style="display:flex; flex-direction:column; gap:10px; margin-bottom:15px;"><input id="loginId" class="ai-input-pretty" placeholder="ì´ë©”ì¼ ì£¼ì†Œ" style="margin:0;"><input id="loginPw" class="ai-input-pretty" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸" style="margin:0;"><input id="loginPwConfirm" class="ai-input-pretty" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" style="margin:0; display:none;"></div><button class="btn-round primary" id="btnAuthAction" style="width:100%; justify-content:center; height:45px; font-size:15px;">ë¡œê·¸ì¸</button><div style="margin-top:15px; font-size:13px; color:#666;"><span id="authSwitchText">ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”?</span><span id="btnSwitchAuthMode" style="color:var(--primary); font-weight:bold; cursor:pointer; margin-left:5px; text-decoration:underline;">íšŒì›ê°€ì…</span></div><hr style="margin:20px 0; border:0; border-top:1px solid #eee;"><div style="display:flex; flex-direction:column; gap:8px;"><button id="btnGoogleLogin" class="btn-round" style="border-color:#ddd; justify-content:center;"><i class="fa-brands fa-google" style="color:#DB4437; margin-right:8px;"></i> Googleë¡œ ì‹œì‘í•˜ê¸°</button><button id="btnKakaoLogin" class="btn-round" style="border-color:#FEE500; background:#FEE500; color:#3C1E1E; justify-content:center;"><i class="fa-solid fa-comment" style="margin-right:8px;"></i> ì¹´ì¹´ì˜¤ë¡œ ì‹œì‘í•˜ê¸°</button></div><button onclick="document.getElementById('loginModal').style.display='none'" class="btn-round" style="margin-top:15px; border:none; color:#888; width:100%;">ë‹«ê¸°</button></div></div>
<div id="productDetailModal" class="modal-bg" style="z-index: 11000;"><div class="modal-box" style="width: 900px; max-width: 95%; display: flex; text-align: left; padding:0; overflow:hidden;"><div style="width: 45%; background: #f8fafc; display: flex; align-items: center; justify-content: center; padding: 20px;"><img id="pdpImage" src="" style="max-width: 100%; max-height: 300px; object-fit: contain;"></div><div style="width: 55%; padding: 40px; display: flex; flex-direction: column;"><h2 id="pdpTitle" style="margin: 0 0 10px 0;">ìƒí’ˆëª…</h2><h3 id="pdpPrice" style="color: var(--primary); margin: 0 0 20px 0;">0ì›</h3><button id="btnActionDesign" class="btn-round primary" style="height: 50px;">ğŸ¨ ì§ì ‘ ë””ìì¸í•˜ê¸°</button><div style="margin-top:10px;"><input type="file" id="pdpFileUpload" style="display: none;"><button onclick="document.getElementById('pdpFileUpload').click()" class="btn-round">ğŸ“‚ íŒŒì¼ ì—…ë¡œë“œ ì£¼ë¬¸</button></div><button onclick="document.getElementById('productDetailModal').style.display='none'" style="margin-top: auto; border:none; background:none; cursor:pointer;">ë‹«ê¸°</button></div></div></div>
<div id="cartPage" style="display:none; position:fixed; inset:0; background:#f1f5f9; z-index: 12000; overflow-y:auto; padding-top: 40px;"><div style="max-width: 1000px; margin: 0 auto; padding-bottom: 60px;"><div style="display:flex; justify-content:space-between; align-items:center; padding:0 20px;"><h1>ğŸ›’ ì¥ë°”êµ¬ë‹ˆ <span id="cartCount">(0)</span></h1><button onclick="document.getElementById('cartPage').style.display='none'" class="btn-round" style="width:auto;">ë‹«ê¸°</button></div><div style="display: grid; grid-template-columns: 1fr 300px; gap: 30px; padding: 0 20px;"><div id="cartListArea"></div><div><div style="background:white; padding:20px; border-radius:12px;"><h3>ê²°ì œ ê¸ˆì•¡</h3><div style="display:flex; justify-content:space-between;"><span>ìƒí’ˆ</span><span id="summaryItemPrice">0ì›</span></div><div style="display:flex; justify-content:space-between;"><span>ì˜µì…˜</span><span id="summaryAddonPrice">0ì›</span></div><hr><div style="display:flex; justify-content:space-between; font-weight:bold; font-size:20px;"><span>í•©ê³„</span><span id="summaryTotal">0ì›</span></div><button id="btnGoCheckout" class="btn-round primary" style="margin-top:20px; width:100%;">ğŸ’³ ê²°ì œí•˜ê¸°</button><button id="btnPrintQuote" class="btn-round btn-secondary" style="margin-top:10px; width:100%;"><i class="fa-solid fa-file-invoice"></i> ê²¬ì ì„œ ì¶œë ¥</button></div></div></div></div></div>
<div id="calendarModal" class="modal-bg" style="z-index: 12500;"><div class="modal-box"><h3>ğŸ“… ë°°ì†¡ìš”ì²­ [ì œì‘ê¸°ê°„ 3ì¼]</h3><div style="display:flex; justify-content:space-between; margin-bottom:10px;"><button id="btnPrevMonth" class="btn-round" style="width:30px;">&lt;</button><span id="currentMonthYear" style="font-weight:bold;"></span><button id="btnNextMonth" class="btn-round" style="width:30px;">&gt;</button></div><div id="calendarGrid" class="calendar-grid"></div><button onclick="document.getElementById('calendarModal').style.display='none'" class="btn-round" style="margin-top:15px;">ë‹«ê¸°</button></div></div>
<div id="deliveryInfoModal" class="modal-bg" style="z-index: 12600;"><div class="modal-box" style="text-align:left;"><h3 style="text-align:center;">ğŸ“ ë°°ì†¡ ì •ë³´ ì…ë ¥</h3><p>ë‹´ë‹¹ìëª…</p><input id="inputManagerName" class="ai-input-pretty"><p>ì—°ë½ì²˜</p><input id="inputManagerPhone" class="ai-input-pretty"><p>ì£¼ì†Œ</p><input id="inputAddress" class="ai-input-pretty"><p>ìš”ì²­ì‚¬í•­</p><textarea id="inputRequest" class="ai-input-pretty"></textarea><button id="btnSubmitOrderInfo" class="btn-round primary" style="margin-top:10px;">ì£¼ë¬¸ì„œ ìƒì„± ë° ê²°ì œ</button><button onclick="document.getElementById('deliveryInfoModal').style.display='none'" class="btn-round" style="margin-top:5px;">ì·¨ì†Œ</button></div></div>
<div id="checkoutModal" class="modal-bg" style="z-index: 13000;"><div class="modal-box" style="text-align:left;"><h3 style="text-align:center;">í™•ì¸</h3><input id="orderName" class="ai-input-pretty" readonly><input id="orderPhone" class="ai-input-pretty" readonly><input id="orderAddr" class="ai-input-pretty" readonly><textarea id="orderMemo" class="ai-input-pretty" readonly></textarea><button id="btnRealPayment" class="btn-round primary">ìµœì¢… ê²°ì œ</button><button onclick="document.getElementById('checkoutModal').style.display='none'" class="btn-round" style="margin-top:5px;">ì·¨ì†Œ</button></div></div>
<div id="successModal" class="modal-bg" style="z-index: 14000;"><div class="modal-box"><h2>ğŸ‰ ì£¼ë¬¸ ì™„ë£Œ!</h2><button id="btnDownOrderSheet" class="btn-round">ğŸ“„ ì‘ì—…ì§€ì‹œì„œ ë‹¤ìš´ë¡œë“œ</button><button id="btnDownQuotation" class="btn-round" style="margin-top:5px;">ğŸ“‘ ê²¬ì ì„œ ë‹¤ìš´ë¡œë“œ</button><button onclick="window.closeSuccessModal()" class="btn-round primary" style="margin-top:15px;">í™•ì¸</button></div></div>
<div id="sellModal" class="modal-bg" style="z-index: 10002;"><div class="modal-box"><h3>ğŸ’ ë””ìì¸ ë“±ë¡</h3><input id="sellKw" class="ai-input-pretty" placeholder="#í‚¤ì›Œë“œ"><button id="btnSellConfirm" class="btn-round primary">ë“±ë¡í•˜ê¸°</button><button onclick="document.getElementById('sellModal').style.display='none'" class="btn-round" style="margin-top:5px;">ì·¨ì†Œ</button></div></div>
<div id="fontModal" class="modal-bg" style="z-index: 10002;"><div class="modal-box"><h3>í°íŠ¸ ì„ íƒ</h3><div id="fontList" style="max-height:300px; overflow-y:auto;"></div><button onclick="document.getElementById('fontModal').style.display='none'" class="btn-round" style="margin-top:10px;">ë‹«ê¸°</button></div></div>

<script type="module" src="./config.js"></script>
<script type="module" src="./canvas-core.js"></script>
<script type="module" src="./canvas-size.js"></script>
<script type="module" src="./canvas-guides.js"></script>
<script type="module" src="./canvas-zoom-pan.js"></script>
<script type="module" src="./canvas-objects.js"></script>
<script type="module" src="./canvas-image.js"></script>
<script type="module" src="./canvas-template.js"></script>
<script type="module" src="./canvas-ai.js"></script>
<script type="module" src="./canvas-utils.js"></script>
<script type="module" src="./shortcuts.js"></script>
<script type="module" src="./context-menu.js"></script>
<script type="module" src="./export.js"></script>
<script type="module" src="./order.js"></script>
<script type="module" src="./login.js"></script>
<script type="module" src="./my-design.js"></script>
<script type="module" src="./main.js"></script>

<script type="module">
    import { canvas } from './canvas-core.js';
    import { openProductDetail, startDesignFromProduct } from './order.js';
    import { applySize } from './canvas-size.js';
    import { sb, PRODUCT_DB } from './config.js'; 

    window.canvas = canvas;
    window.openProductDetail = openProductDetail;
    window.startDesignFromProduct = startDesignFromProduct;
    window.applySize = applySize;
    
    // [ì¤‘ìš”] í˜„ì¬ ì„ íƒëœ ì œí’ˆ í‚¤ë¥¼ ì €ì¥í•˜ëŠ” ì „ì—­ ë³€ìˆ˜
    window.currentProductKey = 'A4'; // ê¸°ë³¸ê°’

    // [1] í…œí”Œë¦¿ í´ë¦­ -> ì‚¬ì´ì¦ˆ ì„ íƒ ëª¨ë‹¬ ì—´ê¸°
    window.onTemplateClick = function(tplData) {
        window.pendingTemplate = tplData;
        const grid = document.getElementById('productSelectGrid');
        if(grid) {
            grid.innerHTML = '';
            const getIcon = (name) => {
                if(name.includes('A4')||name.includes('A3')) return 'fa-solid fa-file';
                if(name.includes('ë°°ë„ˆ')) return 'fa-solid fa-flag';
                if(name.includes('ê°€ë²½')) return 'fa-solid fa-door-closed';
                if(name.includes('ë³´ë“œ')) return 'fa-solid fa-chalkboard';
                return 'fa-solid fa-layer-group';
            };
            Object.keys(PRODUCT_DB).forEach(key => {
                const item = PRODUCT_DB[key];
                const div = document.createElement('div');
                div.className = 'quick-item';
                div.innerHTML = `<div class="quick-icon"><i class="${getIcon(item.name)}"></i></div><div class="quick-text">${item.name}</div>`;
                div.onclick = () => checkAndLoad(key, item.name);
                grid.appendChild(div);
            });
            document.getElementById('sizeSelectModal').style.display = 'flex';
        }
    };

    // [2] ì œí’ˆ ì„ íƒ í›„ ë¡œë“œ
    function checkAndLoad(productKey, productName) {
        if (!window.pendingTemplate) return;
        
        // [í•µì‹¬] ì„ íƒí•œ ì œí’ˆ í‚¤ ì €ì¥
        window.currentProductKey = productKey;

        const isLarge = productName.includes('ê°€ë²½') || productName.includes('Wall');
        const isVector = ['vector', 'graphic', 'transparent-graphic', 'vector_bg', 'vector_obj'].includes(window.pendingTemplate.category);

        if (isLarge && !isVector) {
            if(!confirm("âš ï¸ ê²½ê³ : ì´ë¯¸ì§€ í…œí”Œë¦¿ì€ ëŒ€í˜• ì¶œë ¥ ì‹œ ê¹¨ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
        }

        document.getElementById('sizeSelectModal').style.display = 'none';
        document.getElementById('startScreen').style.display = 'none';
        document.getElementById('mainEditor').style.display = 'flex';
        window.dispatchEvent(new Event('resize'));

        startDesignWithTemplate(productKey, window.pendingTemplate);
    }

    async function startDesignWithTemplate(productKey, tpl) {
        document.getElementById("loading").style.display = "flex";
        
        // [í•µì‹¬] ì—¬ê¸°ì„œë„ ì €ì¥ (ì•ˆì „ì¥ì¹˜)
        window.currentProductKey = productKey;

        const sizeMap = { 
            'A4': [595, 842], 'A3': [842, 1191], 'A2': [1191, 1684], 'A1': [1684, 2384], 
            'Std_1200_600': [3401, 1700], 'Std_2400_1200': [6803, 3401], 
            'Wall_1': [1200, 2200], 'Wall_2': [2200, 2200], 'Wall_3': [3200, 2200], 
            'Wall_4': [4200, 2200], 'Wall_5': [5200, 2200], 
            'Banner_X': [600, 1800], 'Award_Board': [800, 570], 
            'PhotoZone_Text': [2400, 1200], 'Fabric_Wide': [1350, 900], 'Paper_Disp_4': [585, 1130] 
        };
        const size = sizeMap[productKey] || [1000, 1000];
        
        await new Promise(r => setTimeout(r, 300));
        applySize(size[0], size[1], productKey, productKey.includes('Wall') ? 'wall' : 'standard', 'replace');

        const { data: doc, error } = await sb.from('library').select('data_url').eq('id', tpl.id).single();
        if (error || !doc) {
            alert("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨");
            document.getElementById("loading").style.display = "none";
            return;
        }
        window.applyTemplateToCanvas(doc.data_url);
    }

    // [ê¸°ì¡´ í•¨ìˆ˜ ìœ ì§€] applyTemplateToCanvas, setAsBackground, loadTemplates ë“±ì€ ê·¸ëŒ€ë¡œ ë‘¡ë‹ˆë‹¤.
    // (ë„ˆë¬´ ê¸¸ì–´ì„œ ìƒëµ, ìœ„ì—ì„œ ë“œë¦° ì½”ë“œ ê·¸ëŒ€ë¡œ ì“°ì‹œë©´ ë©ë‹ˆë‹¤)
    // ... (applyTemplateToCanvas í•¨ìˆ˜) ...
    // ... (setAsBackground í•¨ìˆ˜) ...
    // ... (loadTemplates í•¨ìˆ˜) ...
    
    window.applyTemplateToCanvas = async function(inputData) {
        // ... (ê¸°ì¡´ê³¼ ë™ì¼) ...
        if (!canvas) return;
        document.getElementById("loading").style.display = "flex";
        try {
            let jsonData = inputData;
            if (typeof inputData === 'string') {
                if (inputData.startsWith('http')) {
                    const res = await fetch(inputData);
                    const ct = res.headers.get("content-type");
                    jsonData = (ct && ct.includes("svg")) ? await res.text() : await res.json();
                } else if (inputData.trim().startsWith('{')) {
                    jsonData = JSON.parse(inputData);
                }
            }
            let board = canvas.getObjects().find(o => o.isBoard);
            let boardSize = board ? { w: board.width * board.scaleX, h: board.height * board.scaleY } : { w: canvas.width, h: canvas.height };
            let center = board ? { x: board.left + boardSize.w/2, y: board.top + boardSize.h/2 } : { x: canvas.width/2, y: canvas.height/2 };

            const onLoad = (objects, options) => {
                if(!objects || objects.length===0) return finishLoading();
                objects.forEach(o => { 
                    o.set({ selectable: true, evented: true, lockMovementX: false, lockMovementY: false });
                    if(o.type==='i-text'||o.type==='text') delete o.textBaseline; 
                });
                let group;
                if(options) group = fabric.util.groupSVGElements(objects, options);
                else group = new fabric.Group(objects);
                group.set({ originX: 'center', originY: 'center' });
                const scale = Math.min((boardSize.w * 0.9) / group.width, (boardSize.h * 0.9) / group.height);
                group.set({ scaleX: scale, scaleY: scale, left: center.x, top: center.y });
                canvas.add(group);
                group.toActiveSelection();
                canvas.requestRenderAll();
                finishLoading();
            };
            if (typeof jsonData === 'string' && (jsonData.includes('<svg') || jsonData.includes('data:image/svg'))) {
                fabric.loadSVGFromString(jsonData, onLoad);
            } else if (typeof jsonData === 'object' && jsonData.objects) {
                const objs = jsonData.objects.filter(o => !o.isBoard);
                fabric.util.enlivenObjects(objs, (enlivened) => onLoad(enlivened, null));
            } else {
                fabric.Image.fromURL(inputData, (img) => {
                    if(img) onLoad([img], null); else finishLoading();
                });
            }
        } catch(e) { console.error(e); alert("ì˜¤ë¥˜"); finishLoading(); }
    };

    function finishLoading() {
        document.getElementById("loading").style.display = "none";
        document.getElementById('templateOverlay').style.display = 'none';
    }

    async function loadTemplates(containerId, isModal = false) {
        const grid = document.getElementById(containerId);
        if (!grid) return;
        grid.innerHTML = 'Loading...';
        if (!sb) await new Promise(r => setTimeout(r, 500)); 
        const { data } = await sb.from('library').select('id, thumb_url, category').order('created_at', { ascending: false }).limit(50);
        if (!data) { grid.innerHTML = 'No Data'; return; }
        grid.innerHTML = '';
        data.forEach(tpl => {
            const card = document.createElement('div');
            card.className = isModal ? 'tpl-item' : 'tpl-card-start';
            let imgSrc = tpl.thumb_url;
            if (imgSrc && !imgSrc.startsWith('http') && !imgSrc.startsWith('data:')) imgSrc = 'data:image/jpeg;base64,' + imgSrc;
            if (!imgSrc) imgSrc = 'https://via.placeholder.com/300';
            card.innerHTML = isModal ? `<img src="${imgSrc}" class="tpl-item-img">` : `<img src="${imgSrc}" class="tpl-card-img"><div class="tpl-card-overlay"></div>`;
            card.onclick = () => { if(window.onTemplateClick) window.onTemplateClick(tpl); };
            grid.appendChild(card);
        });
    }

    // [ì¤‘ìš”] ì´ˆê¸° ì‹¤í–‰ ì‹œ 'A4'ê°€ ì•„ë‹Œ, í˜„ì¬ ì„ íƒëœ ê°’ìœ¼ë¡œ ì„¤ì •ë˜ë„ë¡ ìˆ˜ì •
    window.addEventListener('load', () => {
        renderQuickMenu();
        loadTemplates('startTemplateGrid', false);
        window.preloadKoreanFont();
    });
    
    document.getElementById('btnMobileTemplateOpen').onclick = () => { document.getElementById('templateOverlay').style.display='flex'; loadTemplates('tplGrid', true); };
    document.querySelectorAll('.tpl-tab').forEach(b => b.onclick = () => { document.getElementById('templateOverlay').style.display='flex'; loadTemplates('tplGrid', true); });

    function renderQuickMenu() {
        const c = document.getElementById('quickMenuContainer');
        if (!c) return; c.innerHTML = '';
        const icons = {'A4':'fa-file','ë°°ë„ˆ':'fa-flag','ê°€ë²½':'fa-door-closed','ë³´ë“œ':'fa-chalkboard','ì›ë‹¨':'fa-scroll','í¬í† ':'fa-camera'};
        Object.keys(PRODUCT_DB).forEach(k => {
            const n = PRODUCT_DB[k].name;
            let icon = 'fa-layer-group';
            for(let i in icons) if(n.includes(i)) icon = 'fa-solid '+icons[i];
            const d = document.createElement('div');
            d.className = 'quick-item';
            d.innerHTML = `<div class="quick-icon"><i class="${icon}"></i></div><div class="quick-text">${n}</div>`;
            d.onclick = () => startEditorDirect(k);
            c.appendChild(d);
        });
    }
    
    function startEditorDirect(key) {
        // [í•µì‹¬] ì§ì ‘ ì‹œì‘í•  ë•Œë„ ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
        window.currentProductKey = key;

        const sizeMap = { 'A4': [595, 842], 'A3': [842, 1191], 'A2': [1191, 1684], 'A1': [1684, 2384], 'Std_1200_600': [3401, 1700], 'Std_2400_1200': [6803, 3401], 'Wall_1': [1200, 2200], 'Wall_2': [2200, 2200], 'Wall_3': [3200, 2200], 'Wall_4': [4200, 2200], 'Wall_5': [5200, 2200], 'Banner_X': [600, 1800], 'Award_Board': [800, 570], 'PhotoZone_Text': [2400, 1200], 'Fabric_Wide': [1350, 900], 'Paper_Disp_4': [585, 1130] };
        const size = sizeMap[key] || [1000, 1000];
        applySize(size[0], size[1], key, key.includes('Wall') ? 'wall' : 'standard', 'replace');
        document.getElementById("startScreen").style.display = "none";
        document.getElementById("mainEditor").style.display = "flex";
        window.dispatchEvent(new Event('resize'));
    }
    
    // ê¸°íƒ€ ìœ í‹¸ í•¨ìˆ˜ë“¤...
    window.toggleLockSelection = function() { if(!canvas)return; const a=canvas.getActiveObject(); if(!a)return alert("ì„ íƒí•„ìš”"); const l=!a.lockMovementX; a.set({lockMovementX:l,lockMovementY:l,lockRotation:l,lockScalingX:l,lockScalingY:l,hasControls:!l,selectable:true}); canvas.discardActiveObject(); canvas.requestRenderAll(); };
    window.setAsBackground = function() { if(!canvas)return; const a=canvas.getActiveObject(); if(!a)return alert("ì„ íƒí•„ìš”"); const b=canvas.getObjects().find(o=>o.isBoard); if(!b)return; const s=Math.max((b.width*b.scaleX)/a.width,(b.height*b.scaleY)/a.height); a.set({scaleX:s,scaleY:s,left:b.left+(b.width*b.scaleX)/2,top:b.top+(b.height*b.scaleY)/2,originX:'center',originY:'center',angle:0}); canvas.sendToBack(a); canvas.sendToBack(b); canvas.requestRenderAll(); };
    window.alignObject = function(d) { if(!canvas)return; const a=canvas.getActiveObject(); if(!a)return; const b=canvas.getObjects().find(o=>o.isBoard); const r=b?b.getBoundingRect():{left:0,top:0,width:canvas.width,height:canvas.height}; const w=a.getScaledWidth(); const h=a.getScaledHeight(); if(d=='left') a.left=r.left+w/2; if(d=='centerH') a.left=r.left+r.width/2; if(d=='right') a.left=r.left+r.width-w/2; if(d=='top') a.top=r.top+h/2; if(d=='centerV') a.top=r.top+r.height/2; if(d=='bottom') a.top=r.top+r.height-h/2; if(d=='center') { a.left=r.left+r.width/2; a.top=r.top+r.height/2; } a.setCoords(); canvas.requestRenderAll(); };

    if (window.pdfjsLib) window.pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    window.koreanFontCache = null;
    window.preloadKoreanFont = async function() { try { const r = await fetch('https://cdn.jsdelivr.net/gh/google/fonts@main/ofl/nanumgothic/NanumGothic-Regular.ttf'); if(r.ok) { const b = await r.blob(); const rd = new FileReader(); rd.onloadend = function() { window.koreanFontCache = rd.result.split(',')[1]; }; rd.readAsDataURL(b); } } catch(e) {} };
    window.loadKoreanFontForPDF = async function(doc) { if(window.koreanFontCache) { try { doc.addFileToVFS('NanumGothic.ttf', window.koreanFontCache); doc.addFont('NanumGothic.ttf', 'NanumGothic', 'normal'); doc.addFont('NanumGothic.ttf', 'NanumGothic', 'bold'); doc.setFont('NanumGothic'); } catch(e) {} } };
</script>
<script>
    document.addEventListener('click', function(e) {
        const card = e.target.closest('.size-card');
        if (card) {
            const onclickCode = card.getAttribute('onclick');
            if (onclickCode) {
                try { eval(onclickCode); } catch(err) { console.error("íŒí˜• í´ë¦­ ì˜¤ë¥˜:", err); }
            }
        }
    });
    
    // [ìˆ˜ì •] í™•ì¸ ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ë‹«ê¸° ë° ì´ˆê¸°í™”
    window.closeSuccessModal = function() {
        const modal = document.getElementById('successModal');
        if (modal) {
            modal.style.display = 'none';
        }
        // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ì´ˆê¸°í™” (ì„ íƒì‚¬í•­)
        // location.reload(); 
    };

    // [ì¶”ê°€] ë²„íŠ¼ì— ì§ì ‘ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²° (HTML onclick ì†ì„± ëŒ€ì‹ )
    document.addEventListener('DOMContentLoaded', () => {
        const confirmBtn = document.querySelector('#successModal .btn-round.primary');
        if(confirmBtn) {
            confirmBtn.onclick = window.closeSuccessModal;
        }
    });
</script>
<script src="https://js.tosspayments.com/v1"></script>

<button id="btnPayTest" 
    style="position: fixed; bottom: 20px; right: 20px; z-index: 999999; padding: 15px 25px; background: #3182f6; color: white; border: none; border-radius: 10px; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.3); cursor: pointer;">
    ğŸ’³ í…ŒìŠ¤íŠ¸ ê²°ì œ ì‹¤í–‰
</button>

<script>
document.getElementById("btnPayTest").onclick = function () {
    console.log("ê²°ì œ ë²„íŠ¼ í´ë¦­ë¨"); // í´ë¦­ í™•ì¸ìš© ë¡œê·¸

    // 1. í´ë¼ì´ì–¸íŠ¸ í‚¤ ì„¤ì • (ë°˜ë“œì‹œ ë³¸ì¸ì˜ í…ŒìŠ¤íŠ¸ í‚¤ë¡œ ë³€ê²½í•´ì•¼ í•¨)
    // ê°œë°œìì„¼í„° > API í‚¤ > í´ë¼ì´ì–¸íŠ¸ í‚¤ (í…ŒìŠ¤íŠ¸ìš©) ë³µì‚¬í•´ì„œ ë¶™ì—¬ë„£ê¸°
    const clientKey = "test_ck_D5GePWvyJnrK0W0k6q8gLzN97Eoq"; 
    
    // SDK ì´ˆê¸°í™” í™•ì¸
    if (typeof TossPayments === 'undefined') {
        alert("í† ìŠ¤í˜ì´ë¨¼ì¸  SDKê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
        return;
    }

    const tossPayments = TossPayments(clientKey);
    const orderId = "order_" + new Date().getTime(); // ê³ ìœ  ì£¼ë¬¸ë²ˆí˜¸ ìƒì„±

    // 2. ê²°ì œ ìš”ì²­
    tossPayments.requestPayment("ì¹´ë“œ", {
        amount: 1000,
        orderId: orderId,
        orderName: "í…ŒìŠ¤íŠ¸ ì£¼ë¬¸",
        customerName: "í™ê¸¸ë™",
        successUrl: window.location.origin + "/success.html", // ì„±ê³µ ì‹œ ì´ë™í•  í˜ì´ì§€ (ë¡œì»¬ ì„œë²„ í•„ìš”)
        failUrl: window.location.origin + "/fail.html",       // ì‹¤íŒ¨ ì‹œ ì´ë™í•  í˜ì´ì§€
    })
    .catch(function (error) {
        // 3. ì—ëŸ¬ ë°œìƒ ì‹œ ì²˜ë¦¬ (ì¤‘ìš”)
        if (error.code === "USER_CANCEL") {
            alert("ì‚¬ìš©ìê°€ ê²°ì œë¥¼ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.");
        } else {
            console.error(error);
            alert("ê²°ì œ ì—°ë™ ì—ëŸ¬: " + error.message);
        }
    });
};
</script>
<script>
    // [ì…ë ¥ì°½ ì˜¤ë¥˜ í•´ê²°] í…ìŠ¤íŠ¸ ì…ë ¥ ì¤‘ ìŠ¤í˜ì´ìŠ¤ë°”(ë‹¨ì¶•í‚¤) ì‘ë™ ë°©ì§€
    window.addEventListener('keydown', function(e) {
        // í˜„ì¬ í¬ì»¤ìŠ¤ê°€ ì…ë ¥ì°½(input, textarea)ì— ìˆë‹¤ë©´
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
            // ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼ ëˆŒë €ì„ ë•Œ
            if (e.code === 'Space' || e.key === ' ') {
                e.stopPropagation(); // ìº”ë²„ìŠ¤ ì´ë™(ë‹¨ì¶•í‚¤) ì´ë²¤íŠ¸ë¥¼ ë§‰ê³ , ê³µë°±ë§Œ ì…ë ¥ë˜ê²Œ í•¨
            }
        }
    }, true); // true: ìº¡ì²˜ë§ ëª¨ë“œë¡œ ì„¤ì •í•˜ì—¬ ë‹¤ë¥¸ ìŠ¤í¬ë¦½íŠ¸ë³´ë‹¤ ë¨¼ì € ê°ì§€
</script>
<div id="mobileTextEditor" style="display:none;">
    <div class="m-text-header">
        <span>âœï¸ í…ìŠ¤íŠ¸ ìˆ˜ì •</span>
        <button id="btnFinishText" class="btn-round primary" style="width:auto; padding:5px 15px; font-size:12px;">ì™„ë£Œ</button>
    </div>
    <textarea id="mobileTextInput" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
</div>
<script>
  (function(){var w=window;if(w.ChannelIO){return w.console.error("ChannelIO script included twice.");}var ch=function(){ch.c(arguments);};ch.q=[];ch.c=function(args){ch.q.push(args);};w.ChannelIO=ch;function l(){if(w.ChannelIOInitialized){return;}w.ChannelIOInitialized=true;var s=document.createElement("script");s.type="text/javascript";s.async=true;s.src="https://cdn.channel.io/plugin/ch-plugin-web.js";var x=document.getElementsByTagName("script")[0];if(x.parentNode){x.parentNode.insertBefore(s,x);}}if(document.readyState==="complete"){l();}else{w.addEventListener("DOMContentLoaded",l);w.addEventListener("load",l);}})();

  ChannelIO('boot', {
    "pluginKey": "752ba9ff-a447-4e10-9813-715e051995cd"
  });
</script>
</body>
</html>